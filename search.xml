<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>快速排序</title>
      <link href="/2022/11/12/QuickSort/"/>
      <url>/2022/11/12/QuickSort/</url>
      
        <content type="html"><![CDATA[<!-- toc --><h1 id="1-算法思想"><a href="#1-算法思想" class="headerlink" title="1. 算法思想"></a>1. 算法思想</h1><p>快速排序整体采用分治的算法思想，先根据一个枢轴（pivot）元素把数组分成三部分，使得小于枢轴的元素在左边，等于枢轴的元素在中间，大于枢轴的元素在数组右边，这样划分相当于对数组进行了一次<strong>预排序</strong>，这是因为，等于枢轴的部分的位置在后续的排序过程中不会再动了，他们已经在了最终的位置。我们只需要对小于枢轴和大于枢轴的部分进行排序即可。</p><p>且小于枢轴的部分的元素在排序的时候，它们的位置调整仅限于小于区域内，大于枢轴的部分也是一样，相较于归并排序，我们在解决了这两个子问题以后，就不需要把两个子问题的结果进行合并。</p><h1 id="2-算法描述"><a href="#2-算法描述" class="headerlink" title="2. 算法描述"></a>2. 算法描述</h1><p>只要待排序部分的长度大于1，那么进行下面的步骤：</p><ol><li>在待排序部分中选取一个枢轴元素pivot，按照枢轴元素，把待排序部分整理成小于枢轴的部分，等于枢轴的部分，和大于枢轴的部分</li><li>递归的对小于枢轴的部分，大于枢轴的部分进行排序。</li></ol><h2 id="2-1-枢轴元素的选取"><a href="#2-1-枢轴元素的选取" class="headerlink" title="2.1. 枢轴元素的选取"></a>2.1. 枢轴元素的选取</h2><p>枢轴元素影响了快排的时间复杂度，我们不能使用选取固定位置的元素作为枢轴（例如只选取第一个元素或者最后一个元素），这样在极端情况下（数组已经有序）会使得时间复杂度达到$O(N^2)$。比较好的方法上随机选取枢轴，或者使用三数取中法，这里我们使用三数取中法选取枢轴。</p><h2 id="2-2-荷兰国旗问题"><a href="#2-2-荷兰国旗问题" class="headerlink" title="2.2. 荷兰国旗问题"></a>2.2. 荷兰国旗问题</h2><p>荷兰国旗问题是这样描述的：</p><p>给定一段数组arr的起始位置，开始位置是s，结束位置是e，以及一个数pivot，如何把数组调整成小于pivot的部分放左边，等于pivot的放中间，大于pivot的放右边。</p><p>这里直接给出解决算法：</p><p>设置两个指针l &#x3D; s-1， r &#x3D; e+1, i &#x3D; s。</p><p>只要i&lt;r，进行下面的步骤：</p><ol><li>如果arr[i] &lt; pivot，那么把arr[i]和arr[l+1]交换，l++，i++</li><li>如果arr[i] &#x3D;&#x3D; pivot，i++；</li><li>如果arr[i] &gt; pivot，那么把arr[i]和arr[r-1]交换，r--,</li></ol><p>代码如下：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">NetherlandsFlag</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">partition</span><span class="params">(<span class="type">int</span>[] arr, <span class="type">int</span> s, <span class="type">int</span> e, <span class="type">int</span> pivot)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">l</span> <span class="operator">=</span> s - <span class="number">1</span>, r = e + <span class="number">1</span>, i = s;</span><br><span class="line">        <span class="keyword">while</span>(i &lt; r) &#123;</span><br><span class="line">            <span class="keyword">if</span>(arr[i] &lt; pivot) swap(arr, ++l, i++);</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span>(arr[i] &gt; pivot) swap(arr, --r, i);</span><br><span class="line">            <span class="keyword">else</span> ++i;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">swap</span><span class="params">(<span class="type">int</span>[] arr, <span class="type">int</span> i, <span class="type">int</span> j)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(i != j &amp;&amp; arr[i] != arr[j]) &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">t</span> <span class="operator">=</span> arr[i];</span><br><span class="line">            arr[i] = arr[j];</span><br><span class="line">            arr[j] = t;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>时间复杂度$O(N)$，空间复杂度$O(1)$。</p><h1 id="3-代码"><a href="#3-代码" class="headerlink" title="3. 代码"></a>3. 代码</h1><h2 id="3-1-递归写法"><a href="#3-1-递归写法" class="headerlink" title="3.1. 递归写法"></a>3.1. 递归写法</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">QuickSortRecursively</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">sort</span><span class="params">(<span class="type">int</span>[] arr)</span> &#123;</span><br><span class="line">        sort(arr, <span class="number">0</span>, arr.length - <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">sort</span><span class="params">(<span class="type">int</span>[] arr, <span class="type">int</span> s, <span class="type">int</span> e)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(s &gt;= e) <span class="keyword">return</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">len</span> <span class="operator">=</span> e - s + <span class="number">1</span>, pivotIndex;</span><br><span class="line">        <span class="keyword">if</span>(len == <span class="number">2</span>) pivotIndex = s;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">m</span> <span class="operator">=</span> (s + e) &gt;&gt;&gt; <span class="number">1</span>;</span><br><span class="line">            pivotIndex = arr[s] &gt;= arr[m] ? (arr[m] &gt;= arr[e] ? m : (arr[s] &gt;= arr[e] ? e : s)) : (arr[s] &gt;= arr[e] ? s : (arr[m] &gt;= arr[e] ? e : m));<span class="comment">// 三数取中法</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 荷兰国旗问题</span></span><br><span class="line">        swap(arr, pivotIndex, e);</span><br><span class="line">        <span class="type">int</span> <span class="variable">pivotValue</span> <span class="operator">=</span> arr[e];</span><br><span class="line">        <span class="type">int</span> <span class="variable">l</span> <span class="operator">=</span> s - <span class="number">1</span>, r = e, i = s;</span><br><span class="line">        <span class="keyword">while</span>(i &lt; r) &#123; </span><br><span class="line">            <span class="keyword">if</span>(arr[i] &lt; pivotValue) swap(arr, ++l, i++);</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span>(arr[i] &gt; pivotValue) swap(arr, --r, i);</span><br><span class="line">            <span class="keyword">else</span> ++i;</span><br><span class="line">        &#125;</span><br><span class="line">        swap(arr, r, e);</span><br><span class="line">        <span class="comment">// 荷兰国旗问题</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">/*小于部分arr[s..l]，等于部分arr[l + 1..r], 大于部分arr[r + 1..e]*/</span></span><br><span class="line">        sort(arr, s, l);</span><br><span class="line">        sort(arr, r + <span class="number">1</span>, e);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">swap</span><span class="params">(<span class="type">int</span>[] arr, <span class="type">int</span> i, <span class="type">int</span> j)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(i != j &amp;&amp; arr[i] != arr[j]) &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">t</span> <span class="operator">=</span> arr[i];</span><br><span class="line">            arr[i] = arr[j];</span><br><span class="line">            arr[j] = t;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>时间复杂度$O(N\log_2N)$，空间复杂度$O(N\log_2N)$。</p><h2 id="3-2-迭代写法"><a href="#3-2-迭代写法" class="headerlink" title="3.2. 迭代写法"></a>3.2. 迭代写法</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.Stack;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">QuickSortIteratively</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">sort</span><span class="params">(<span class="type">int</span>[] arr)</span> &#123;</span><br><span class="line">        sort(arr, <span class="number">0</span>, arr.length - <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">sort</span><span class="params">(<span class="type">int</span>[] arr, <span class="type">int</span> s, <span class="type">int</span> e)</span> &#123;</span><br><span class="line">        Stack&lt;Task&gt; st = <span class="keyword">new</span> <span class="title class_">Stack</span>&lt;Task&gt;();</span><br><span class="line">        st.push(<span class="keyword">new</span> <span class="title class_">Task</span>(s, e));<span class="comment">// 栈中放入初始任务</span></span><br><span class="line">        <span class="keyword">while</span>(!st.isEmpty()) &#123;</span><br><span class="line">            <span class="type">Task</span> <span class="variable">curTask</span> <span class="operator">=</span> st.pop();</span><br><span class="line">            s = curTask.start;</span><br><span class="line">            e = curTask.end;</span><br><span class="line">            <span class="keyword">if</span>(s &gt;= e) <span class="keyword">continue</span>;</span><br><span class="line">            <span class="type">int</span> <span class="variable">len</span> <span class="operator">=</span> e - s + <span class="number">1</span>, pivotIndex;</span><br><span class="line">            <span class="keyword">if</span>(len == <span class="number">2</span>) pivotIndex = s;</span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="type">int</span> <span class="variable">m</span> <span class="operator">=</span> (s + e) &gt;&gt;&gt; <span class="number">1</span>;</span><br><span class="line">                pivotIndex = arr[s] &gt;= arr[m] ? (arr[m] &gt;= arr[e] ? m : (arr[s] &gt;= arr[e] ? e : s)) : (arr[s] &gt;= arr[e] ? s : (arr[m] &gt;= arr[e] ? e : m));<span class="comment">// 三数取中法</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 荷兰国旗问题</span></span><br><span class="line">            swap(arr, pivotIndex, e);</span><br><span class="line">            <span class="type">int</span> <span class="variable">pivotValue</span> <span class="operator">=</span> arr[e];</span><br><span class="line">            <span class="type">int</span> <span class="variable">l</span> <span class="operator">=</span> s - <span class="number">1</span>, r = e, i = s;</span><br><span class="line">            <span class="keyword">while</span>(i &lt; r) &#123; </span><br><span class="line">            <span class="keyword">if</span>(arr[i] &lt; pivotValue) swap(arr, ++l, i++);</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span>(arr[i] &gt; pivotValue) swap(arr, --r, i);</span><br><span class="line">            <span class="keyword">else</span> ++i;</span><br><span class="line">        &#125;</span><br><span class="line">            swap(arr, r, e);</span><br><span class="line">            <span class="comment">// 荷兰国旗问题</span></span><br><span class="line">            st.push(<span class="keyword">new</span> <span class="title class_">Task</span>(s, l)); <span class="comment">// 子任务压栈</span></span><br><span class="line">            st.push(<span class="keyword">new</span> <span class="title class_">Task</span>(r + <span class="number">1</span>, e)); <span class="comment">// 子任务压栈</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">swap</span><span class="params">(<span class="type">int</span>[] arr, <span class="type">int</span> i, <span class="type">int</span> j)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(i != j &amp;&amp; arr[i] != arr[j]) &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">t</span> <span class="operator">=</span> arr[i];</span><br><span class="line">            arr[i] = arr[j];</span><br><span class="line">            arr[j] = t;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Task</span> &#123;</span><br><span class="line">        <span class="type">int</span> start, end;</span><br><span class="line">        Task(<span class="type">int</span> s, <span class="type">int</span> e) &#123;</span><br><span class="line">            start = s;</span><br><span class="line">            end = e;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>时间复杂度$O(N\log_2N)$，空间复杂度$O(N\log_2N)$。</p><h1 id="4-测试程序"><a href="#4-测试程序" class="headerlink" title="4. 测试程序"></a>4. 测试程序</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.Random;</span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">QuickSortTest</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">time</span> <span class="operator">=</span> <span class="number">100_0000</span>, maxArraySize = <span class="number">10</span>;</span><br><span class="line">        <span class="keyword">while</span>(time-- &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="type">Random</span> <span class="variable">r</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Random</span>();</span><br><span class="line">            <span class="type">int</span> <span class="variable">size</span> <span class="operator">=</span> r.nextInt(maxArraySize) + <span class="number">1</span>;</span><br><span class="line">            <span class="type">int</span>[] array1 = <span class="keyword">new</span> <span class="title class_">int</span>[size], array2 = <span class="keyword">new</span> <span class="title class_">int</span>[size], array3 = <span class="keyword">new</span> <span class="title class_">int</span>[size];</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; size; ++i) array1[i] = array2[i] = array3[i] = r.nextInt(<span class="number">201</span>) - <span class="number">100</span>;</span><br><span class="line">            QuickSortRecursively.sort(array1);</span><br><span class="line">            Arrays.sort(array2);</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; size; ++i) &#123;</span><br><span class="line">                <span class="keyword">if</span>(array1[i] != array2[i]) &#123;</span><br><span class="line">                    System.out.println(<span class="string">&quot;Oops! wrong answer&quot;</span>);</span><br><span class="line">                    System.out.println(Arrays.toString(array1));</span><br><span class="line">                    System.out.println(Arrays.toString(array2));</span><br><span class="line">                    System.out.println(<span class="string">&quot;Origin array:&quot;</span>);</span><br><span class="line">                    System.out.println(Arrays.toString(array3));</span><br><span class="line">                    <span class="keyword">return</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println(<span class="string">&quot;Testcase:&quot;</span> + time + <span class="string">&quot; done!&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">&quot;Done successfully!!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 算法 </category>
          
          <category> 排序 </category>
          
          <category> 快速排序 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 快速排序 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>范围上的子数组累加和问题</title>
      <link href="/2022/11/07/SumOfArrayOnRange/"/>
      <url>/2022/11/07/SumOfArrayOnRange/</url>
      
        <content type="html"><![CDATA[<!-- toc --><h1 id="1-问题描述"><a href="#1-问题描述" class="headerlink" title="1. 问题描述"></a>1. 问题描述</h1><p>给定一个数组array，和两个整数low，hi（$low&lt;&#x3D;hi$）,计算array中有几个子数组的累加和在范围$[low,hi]$上，返回满足条件的子数组的个数。</p><p>例如：array&#x3D;[1,3,5]，low&#x3D;3，hi&#x3D;6，那么累加和在$[3,6]$上的子数组有</p><ul><li>[3]</li><li>[5]</li><li>[1,3]</li><li>[1,5]</li></ul><p>所以返回4</p><p>数组长度len的范围$[1,100000]$，数组元素的范围$[-100,100]$</p><p>测评链接：<a href="https://leetcode-cn.com/problems/count-of-range-sum/">https://leetcode-cn.com/problems/count-of-range-sum/</a></p><h1 id="2-暴力解法"><a href="#2-暴力解法" class="headerlink" title="2. 暴力解法"></a>2. 暴力解法</h1><p>找出所有子数组，求出其累加和，然后判断是否在范围内。代码如下：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SumOfArrayOnRange</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">sumOfArrayOnRange</span><span class="params">(<span class="type">int</span>[] array, <span class="type">int</span> low, <span class="type">int</span> hi)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">ans</span> <span class="operator">=</span> <span class="number">0</span>, t, len = array.length;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; len; ++i) &#123; <span class="comment">// 枚举子数组的开头下标</span></span><br><span class="line">            t = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> i; j &lt; len; ++j) &#123;<span class="comment">// 枚举子数组的结尾下标</span></span><br><span class="line">                t += array[j];</span><br><span class="line">                <span class="keyword">if</span>(t &gt;= low &amp;&amp; t &lt;= hi) ++ans;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ans;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>时间复杂度$O(N^2)$，空间复杂度$O(1)$。</p><h1 id="3-最优解"><a href="#3-最优解" class="headerlink" title="3. 最优解"></a>3. 最优解</h1><h2 id="3-1-算法分析"><a href="#3-1-算法分析" class="headerlink" title="3.1. 算法分析"></a>3.1. 算法分析</h2><ol><li><p>使用前缀和数组加速子数组累加和的求解。</p><p>我们生成一个前缀和数组presum，presum[i]表示原数组中下标在$[0,i]$范围内的元素之和。这样当我们想求以i位置作为开头，以j位置作为结尾的子数组的累加和的时候，就可以这样求解：</p><p>当i&#x3D;&#x3D;0的时候，子数组array[i..j]的累加和就是presum[j]。</p><p>当i&gt;0的时候，子数组array[i..j]的累加和就是presum[j]-presum[i-1]。</p></li><li><p>核心思路</p><p>现在我们考虑以array[j]为结尾的子数组中有几个是满足题意的。</p><p>其开头位置设为i，那么一定有$low&lt;&#x3D;presum[j]-presum[i-1]&lt;&#x3D;hi$成立，那么可以得到presum[i-1]的范围，即$presum[j]-hi&lt;&#x3D;presum[i-1]&lt;&#x3D;presum[j]-low$，这个意思是说，只要j左边的数满足这个条件，那么我们就可以找到一个以j为结尾的子数组的累加和满足题意，特别的我们需要单独验证presum[j]是不是满足题意。</p><p>如果我们能找出以任何一个位置j作为结尾的子数组中，有几个满足题意，那么所有的结果相加就是原问题的解。</p><p>如何在一个数组中，找出一个元素左边有几个元素在范围$[presum[j]-hi,presum[j]-low]$上呢？我们可以借助merge sort的merge过程来实现。</p><p>在merge的过程中，对于右组中的任何一个数y，我们都需要找出左组有几个数x在范围$[y-hi,y-low]$上，假设我们已经求得这个答案是ans，那么我们在求解右组中下一个数$y_{next}$的答案的时候，根据右组已经有序，那么$y_{next}&gt;&#x3D;y$，那么我们知道，左组中在$[y_{next}-hi,y_{next}-low]$范围上的数不会在$y-hi$左边，那么我们在遍历左组求解答案的时候，就可以不用回退了。因为当右组中的y不断变大的时候，这个范围也是在向右平移的。</p></li></ol><h2 id="3-2-代码"><a href="#3-2-代码" class="headerlink" title="3.2. 代码"></a>3.2. 代码</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SumOfArrayOnRange2</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">sumOfArrayOnRange</span><span class="params">(<span class="type">int</span>[] array, <span class="type">int</span> low, <span class="type">int</span> hi)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">ans</span> <span class="operator">=</span> <span class="number">0</span>, len = array.length, i, g = <span class="number">1</span>, l, r, m;</span><br><span class="line">        <span class="type">int</span>[] presum = <span class="keyword">new</span> <span class="title class_">int</span>[len], help = <span class="keyword">new</span> <span class="title class_">int</span>[len];</span><br><span class="line">        presum[<span class="number">0</span>] = array[<span class="number">0</span>];</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 单独的累加和特殊处理，因为在后续的merge过程不方便处理单个的累加和数组元素</span></span><br><span class="line">        ans += array[<span class="number">0</span>] &gt;= low &amp;&amp; array[<span class="number">0</span>] &lt;= hi ? <span class="number">1</span> : <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(i = <span class="number">1</span>; i &lt; len; ++i) &#123;</span><br><span class="line">            presum[i] = presum[i - <span class="number">1</span>] + array[i];</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 单独的累加和特殊处理，因为在后续的merge过程不方便处理单个的累加和数组元素</span></span><br><span class="line">            ans += presum[i] &gt;= low &amp;&amp; presum[i] &lt;= hi ? <span class="number">1</span> : <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">while</span>(g &lt; len) &#123;</span><br><span class="line">            l = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">while</span>(l &lt; len - <span class="number">1</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span>((m = l + g - <span class="number">1</span>) &gt;= len - <span class="number">1</span>) <span class="keyword">break</span>;</span><br><span class="line">                r = Math.min(len - <span class="number">1</span>, m + g);</span><br><span class="line">                ans += merge(presum, l, m, r, help, low, hi);</span><br><span class="line">                l = r + <span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(g &gt; (len &gt;&gt; <span class="number">1</span>)) <span class="keyword">break</span>;</span><br><span class="line">            g &lt;&lt;= <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ans;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">merge</span><span class="params">(<span class="type">int</span>[] array, <span class="type">int</span> l, <span class="type">int</span> m, <span class="type">int</span> r, <span class="type">int</span>[] h, <span class="type">int</span> low, <span class="type">int</span> hi)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> l, j = m + <span class="number">1</span>, ans = <span class="number">0</span>, k = <span class="number">0</span>, winL = l, winR = l;</span><br><span class="line">        <span class="keyword">while</span>(j &lt;= r) &#123;<span class="comment">// 对于右组的每一个位置j都要求一个答案</span></span><br><span class="line">            <span class="keyword">while</span>(winR &lt;= m &amp;&amp; array[winR] &lt;= array[j] - low) ++winR;<span class="comment">// winR 左边的，都是不超过array[j] - low的</span></span><br><span class="line">            <span class="keyword">while</span>(winL &lt;= m &amp;&amp; array[winL] &lt; array[j] - hi) ++winL;<span class="comment">// winL 左边的，都是小于array[j] - hi的</span></span><br><span class="line">            ans += winR - winL;<span class="comment">// 当计算下一个array[j]的时候，这个窗口不回退。</span></span><br><span class="line">            ++j;</span><br><span class="line">        &#125;</span><br><span class="line">        j = m + <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span>(i &lt;= m &amp;&amp; j &lt;= r) h[k++] = array[i] &lt;= array[j] ? array[i++] : array[j++];</span><br><span class="line">        <span class="keyword">while</span>(i &lt;= m) h[k++] = array[i++];</span><br><span class="line">        <span class="keyword">while</span>(j &lt;= r) h[k++] = array[j++];</span><br><span class="line">        System.arraycopy(h, <span class="number">0</span>, array, l, k);</span><br><span class="line">        <span class="keyword">return</span> ans;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>时间复杂度$O(N\log_2N)$，空间复杂度$O(N)$。</p><h1 id="4-测试程序"><a href="#4-测试程序" class="headerlink" title="4. 测试程序"></a>4. 测试程序</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.Random;</span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SumOfArrayOnRangeTest</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">time</span> <span class="operator">=</span> <span class="number">100_0000</span>, maxArraySize = <span class="number">10000</span>;</span><br><span class="line">        <span class="keyword">while</span>(time -- &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="type">Random</span> <span class="variable">r</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Random</span>();</span><br><span class="line">            <span class="type">int</span> <span class="variable">size</span> <span class="operator">=</span> r.nextInt(maxArraySize) + <span class="number">1</span>;</span><br><span class="line">            <span class="type">int</span>[] array1 = <span class="keyword">new</span> <span class="title class_">int</span>[size], array2 = <span class="keyword">new</span> <span class="title class_">int</span>[size], array3 = <span class="keyword">new</span> <span class="title class_">int</span>[size];</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; size; ++i) array1[i] = array2[i] = array3[i] = r.nextInt(<span class="number">201</span>) - <span class="number">100</span>;</span><br><span class="line">            <span class="type">int</span> <span class="variable">lo</span> <span class="operator">=</span> r.nextInt(<span class="number">1001</span>), hi = r.nextInt(<span class="number">1001</span>) + <span class="number">1000</span>;</span><br><span class="line">            <span class="type">int</span> <span class="variable">ans1</span> <span class="operator">=</span> SumOfArrayOnRange.sumOfArrayOnRange(array1, lo, hi), ans2 = SumOfArrayOnRange2.sumOfArrayOnRange(array2, lo, hi);</span><br><span class="line">            <span class="keyword">if</span>(ans1 != ans2) &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;Oops!, ans1 = &quot;</span> + ans1 + <span class="string">&quot;, ans2 = &quot;</span> + ans2);</span><br><span class="line">                System.out.println(<span class="string">&quot;lo = &quot;</span> + lo + <span class="string">&quot;, hi = &quot;</span> + hi + <span class="string">&quot;, size = &quot;</span> + size);</span><br><span class="line">                System.out.println(<span class="string">&quot;Arrays: &quot;</span>);</span><br><span class="line">                System.out.println(Arrays.toString(array3));</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println(<span class="string">&quot;Testcase: &quot;</span> + time + <span class="string">&quot; finish!&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">&quot;Done successfully!!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 算法 </category>
          
          <category> 问题 </category>
          
          <category> 归并排序相关 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 归并排序 </tag>
            
            <tag> 有序表 </tag>
            
            <tag> leetcode </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>数组逆序对个数问题【2】</title>
      <link href="/2022/10/26/ReversePairCount2/"/>
      <url>/2022/10/26/ReversePairCount2/</url>
      
        <content type="html"><![CDATA[<!-- toc --><h1 id="1-问题描述"><a href="#1-问题描述" class="headerlink" title="1. 问题描述"></a>1. 问题描述</h1><p>给定一个数组array，和一个正整数p，数组的长度len是$2^p$，再给定一个数组reverseGroup，他的数组元素的范围是$[0,p]$。我们需要返回一个答案数组ans，ans[i]表示把原数组按照$2^{reverseGroup[i]}$个元素为一组反转后，数组中逆序对的个数。</p><p>p的范围$[1,10]$，reverseGroup[i]的范围$[1,100]$。</p><p>例如：</p><p>array&#x3D;[1,2,3,4,5,6,7,8], reverseGroup &#x3D; [0,1,2], p &#x3D; 3;</p><ol><li>首先把原数组按照$2^0 &#x3D; 1$个元素一组反转，此时相当于没有反转，逆序对个数0，因此ans[0] &#x3D; 0;</li><li>然后把数组按照$2^1 &#x3D; 2$个元素为一组进行反转，反转后的数组array&#x3D;[2,1,4,3,6,5,8,7]，逆序对个数是4，ans[1] &#x3D;4，</li><li>然后把数组按照$2^2 &#x3D; 4$个元素为一组进行反转，反转后的数组array&#x3D;[3,4,1,2,7,8,5,6]，逆序对的个数是4，ans[2] &#x3D; 4,</li></ol><p>于是返回ans&#x3D;[0,4,4]；</p><h1 id="2-暴力解法"><a href="#2-暴力解法" class="headerlink" title="2. 暴力解法"></a>2. 暴力解法</h1><p>直接模拟即可，代码如下：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ReversePairCount2</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span>[] count(<span class="type">int</span>[] array, <span class="type">int</span>[] reverseGroup, <span class="type">int</span> p) &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">rLen</span> <span class="operator">=</span> reverseGroup.length, pre = -<span class="number">1</span>;</span><br><span class="line">        <span class="type">int</span>[] ans = <span class="keyword">new</span> <span class="title class_">int</span>[rLen];</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; rLen; ++i) &#123;</span><br><span class="line">            <span class="keyword">if</span>(reverseGroup[i] == <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span>(pre == -<span class="number">1</span>) pre = getReversePairCount(array);</span><br><span class="line">            &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">                reverseByGroup(array, <span class="number">1</span> &lt;&lt; reverseGroup[i]);</span><br><span class="line">                pre = getReversePairCount(array);</span><br><span class="line">            &#125;</span><br><span class="line">            ans[i] = pre;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ans;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">getReversePairCount</span><span class="params">(<span class="type">int</span>[] array)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">len</span> <span class="operator">=</span> array.length, ans = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; len; ++i) &#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> i + <span class="number">1</span>; j &lt; len; ++j) &#123;</span><br><span class="line">                <span class="keyword">if</span>(array[i] &gt; array[j]) ++ans;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ans;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">reverseByGroup</span><span class="params">(<span class="type">int</span>[] array, <span class="type">int</span> group)</span> &#123;<span class="comment">// group个元素为一组，反转数组。</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>, len = array.length, j;</span><br><span class="line">        <span class="keyword">while</span>(i &lt; len) &#123;</span><br><span class="line">            j = i + group - <span class="number">1</span>;</span><br><span class="line">            reverseRange(array, i, j);</span><br><span class="line">            i = j + <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">reverseRange</span><span class="params">(<span class="type">int</span>[] array, <span class="type">int</span> i, <span class="type">int</span> j)</span> &#123;<span class="comment">// 反转一块数组</span></span><br><span class="line">        <span class="keyword">while</span>(i &lt; j) &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">t</span> <span class="operator">=</span> array[i];</span><br><span class="line">            array[i++] = array[j];</span><br><span class="line">            array[j--] = t;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>时间复杂度$O(N^2*rLen)$，空间复杂度$O(1)$。</p><h1 id="3-最优解"><a href="#3-最优解" class="headerlink" title="3. 最优解"></a>3. 最优解</h1><h2 id="3-1-算法分析"><a href="#3-1-算法分析" class="headerlink" title="3.1. 算法分析"></a>3.1. 算法分析</h2><p>使用归并排序的merge过程，先按照两个数为一组求解所有组中的逆序对；然后按照4个数为一组求解所有组的逆序对（求解4个数为一组的逆序对的时候，需要把一组的4个数，分成左右两组，左右两组每组两个数，只考虑左右两组之间能产生多逆序对，而不要考虑左组内部有多少逆序对，右组内部有多少逆序对，这是因为左右两组内部的逆序对在上一步的时候已经求解过了），然后按照8个数为一组求解所有组的逆序对（同样，求解8个数为一组的时候，每一组分成左右两组，左右两组每组4个数，我们只需要求解左右两组之间可以产生多少逆序对），…，一直求解到按照$2^p$个数为一组的时候，逆序对的个数。</p><p>我们把每一步的答案都记录下来，根据数组长度是$2^p$，我们一共可以得到p个答案，因此数组中总的逆序对的个数就是这p个答案的加和。</p><p>为什么要这么做呢？</p><p>这是因为当反转的时候，我们没有必要去真的反转数组，只需要调整我们上面求得的答案，就可以快速获取反转后的答案。当我们要求4个数为一组反转后的答案的时候，可以知道4个数为一组反转后，它不影响我们上面求解的8个数为一组的时候的答案（因0为8个数为一组的答案是左右两组之间形成的逆序对的个数，左右组反转了（实际上左右组内的数据无论被洗牌成什么样，只会影响左右组自己组内的逆序对的个数，而不会影响左右两组之间形成的逆序对的个数），那么反转会使得4个数为一组，2个数为一组的逆序对的个数发生变化，变成了什么呢？其实反转以后，他们的逆序对的个数，就是反转之前正序对的个数，因此我们只需要求得2个数为一组，4个数为一组，…，$2^p$个数为一组的正序对，逆序对的个数就可以了。这样当发生反转的时候，例如$2^i$个数为一组进行反转，我们只需要从$2^1,2^2,…,2^i$，这些组的逆序对个数和正序对个数交换，那么就可以修正原来逆序对的答案数组，每一步的答案就是修正后的逆序对的答案数组的元素加和。</p><p>于是我们有如下算法：</p><p>设置两个答案数组reverseCountByGroup和normalCountByGroup，分别代表数组各个分组的逆序对个数和正序对个数。然后使用归并排序的方法，对数组求解逆序对和正序对的个数，把答案写在数组中。</p><p>设置答案数组ans，然后遍历reverseGroup数组，对每一个反转分组rGroup，进行如下步骤：</p><ol><li>如果rGroup&gt;0，那么对所有的i从0到rGroup-1，把reverseCountByGroup[i] 和 normalCountByGroup[i]，互换。</li><li>i从0到p-1，把reverseCountByGroup[i]累加起来，作为当前这次的答案放入ans中。</li></ol><p>例如，array&#x3D;[1,3,5,7,2,4,6,8], reverseGroup&#x3D;[1,2,0,3],</p><p>array长度len &#x3D; 8; p &#x3D; 3。</p><p>因此reverseCountByGroup和normalCountByGroup的长度是3</p><ol><li>reverseCountByGroup[0]的值是按照两个数为一组的时候，逆序对的总个数，因为两个数一组的时候，没有逆序对，因此reverseCountByGroup[0]&#x3D;0;</li><li>reverseCountByGroup[1]的值是按照4个数为一组的时候，因此第一组[1,3,5,7]，分成左右两组[1,3],[5,7]，这两组之间没有逆序对，同样[2,4,6,8]也没有逆序对。因此reverseCountByGroup[1]&#x3D;0;</li><li>reverseCountByGroup[2]的值是按照8个数为一组的时候，第一祖[1,3,5,7,2,4,6,8]，分成左右两组，左组[1,3,5,7]，右组：[2,4,6,8]，这两组之间可以产生逆序对（3,2），（5,2），（5,4），（7,2），（7,4），（7,6）。因此一共有6个，因此reverseCountByGroup[2]&#x3D;6;</li></ol><p>求解normalCountByGroup是类似的方法。因此</p><p>normalCountByGroup&#x3D;[4,4,10]</p><p>reverseCountByGroup&#x3D;[0,0,6]</p><p>reverseGroup[0] &#x3D; 1, 即两个数一组进行反转，因此我们需要把normalCountByGroup[0]和reverseCountByGroup[0]进行互换，因此normalCountByGroup&#x3D;[0,4,10]，reverseCountByGroup&#x3D;[4,0,6]，于是反转后，逆序对的总个数是4+0+6&#x3D;10</p><p>reverseGroup[1] &#x3D; 2, 即4个数一组进行反转，因此我们需要把normalCountByGroup[0…1]和reverseCountByGroup[0…1]进行互换，因此normalCountByGroup&#x3D;[4,0,10]，reverseCountByGroup&#x3D;[0,4,6]，于是反转后，逆序对的总个数是0+4+6&#x3D;10</p><p>…</p><p>剩下的也是类似的做法。</p><h2 id="3-2-代码"><a href="#3-2-代码" class="headerlink" title="3.2. 代码"></a>3.2. 代码</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ReversePairCount22</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span>[] count(<span class="type">int</span>[] array, <span class="type">int</span>[] reverseGroup, <span class="type">int</span> p) &#123;</span><br><span class="line">        <span class="type">int</span>[] reverseAns = <span class="keyword">new</span> <span class="title class_">int</span>[p], </span><br><span class="line">        normalAns = <span class="keyword">new</span> <span class="title class_">int</span>[p], </span><br><span class="line">        arrayCopy = <span class="keyword">new</span> <span class="title class_">int</span>[array.length], </span><br><span class="line">        h = <span class="keyword">new</span> <span class="title class_">int</span>[array.length], </span><br><span class="line">        ans = <span class="keyword">new</span> <span class="title class_">int</span>[reverseGroup.length];</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; array.length; ++i) arrayCopy[array.length - <span class="number">1</span> - i] = array[i];</span><br><span class="line">        getReversePairCntAns(array, reverseAns, h);</span><br><span class="line">        getReversePairCntAns(arrayCopy, normalAns, h);</span><br><span class="line">        <span class="type">int</span> <span class="variable">pre</span> <span class="operator">=</span> -<span class="number">1</span>;<span class="comment">// 因为当reverseGroup[i]==0的时候，此时的答案可以采用上一步的答案，因此pre代表上一步的答案。当pre==-1的时候，代表上一步的答案无效。</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; reverseGroup.length; ++i) &#123;</span><br><span class="line">            <span class="keyword">if</span>(reverseGroup[i] &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; j &lt; reverseGroup[i]; ++j) &#123;<span class="comment">// 如果翻转了，那么就需要下标从范围[0,reverseGroup[i] - 1]，reverseAns 和 normalAns 互换，这是因为反转了以后，正序对的个数就变成逆序对的个数。 </span></span><br><span class="line">                    <span class="type">int</span> <span class="variable">t</span> <span class="operator">=</span> reverseAns[j];</span><br><span class="line">                    reverseAns[j] = normalAns[j];</span><br><span class="line">                    normalAns[j] = t;</span><br><span class="line">                &#125;</span><br><span class="line">                pre = -<span class="number">1</span>;<span class="comment">// 此时发生了反转，令上一步答案失效</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(pre == -<span class="number">1</span>) &#123;<span class="comment">// 如果上一步答案失效，那么需要重新计算答案。</span></span><br><span class="line">                pre = <span class="number">0</span>;</span><br><span class="line">                <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; j &lt; p; ++j) pre += reverseAns[j];</span><br><span class="line">            &#125;</span><br><span class="line">            ans[i] = pre;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ans;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">getReversePairCntAns</span><span class="params">(<span class="type">int</span>[] array, <span class="type">int</span>[] ans, <span class="type">int</span>[] h)</span> &#123;</span><br><span class="line">        <span class="type">int</span> l, m, r, i = <span class="number">0</span>, g = <span class="number">1</span>, len = array.length, t;</span><br><span class="line">        <span class="keyword">while</span>(g &lt; len) &#123;</span><br><span class="line">            l = <span class="number">0</span>;</span><br><span class="line">            t = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">while</span>(l &lt; len - <span class="number">1</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span>((m = l + g - <span class="number">1</span>) &gt;= len - <span class="number">1</span>) <span class="keyword">break</span>;</span><br><span class="line">                r = Math.min(len - <span class="number">1</span>, m + g);</span><br><span class="line">                t += merge(array, l, m, r, h);</span><br><span class="line">                l = r + <span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            ans[i++] = t;</span><br><span class="line">            <span class="keyword">if</span>(g &gt; (len &gt;&gt; <span class="number">1</span>)) <span class="keyword">break</span>;</span><br><span class="line">            g &lt;&lt;= <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">merge</span><span class="params">(<span class="type">int</span>[] array, <span class="type">int</span> l, <span class="type">int</span> m, <span class="type">int</span> r, <span class="type">int</span>[] h)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> l, j = m + <span class="number">1</span>, k = <span class="number">0</span>, ans = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span>(i &lt;= m) &#123;</span><br><span class="line">            <span class="keyword">while</span>(j &lt;= r &amp;&amp; array[i] &gt; array[j]) ++j;</span><br><span class="line">            ans += j - m - <span class="number">1</span>;</span><br><span class="line">            ++i;</span><br><span class="line">        &#125;</span><br><span class="line">        i = l;</span><br><span class="line">        j = m + <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span>(i &lt;= m &amp;&amp; j &lt;= r) h[k++] = array[i] &lt;= array[j] ? array[i++] : array[j++];</span><br><span class="line">        <span class="keyword">while</span>(i &lt;= m) h[k++] = array[i++];</span><br><span class="line">        <span class="keyword">while</span>(j &lt;= r) h[k++] = array[j++];</span><br><span class="line">        System.arraycopy(h, <span class="number">0</span>, array, l, k);</span><br><span class="line">        <span class="keyword">return</span> ans;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>数组array长度N，reverseGroup数组长度是R，那么时间复杂度$O(max{p*R,N\log_2N})$，空间复杂度$O(N)$。</p><h1 id="4-测试程序"><a href="#4-测试程序" class="headerlink" title="4. 测试程序"></a>4. 测试程序</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ReversePairCount2Test</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">time</span> <span class="operator">=</span> <span class="number">100_0000</span>, maxP = <span class="number">6</span>, maxReverseGroupSize = <span class="number">10</span>;</span><br><span class="line">        <span class="keyword">while</span>(time-- &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="type">Random</span> <span class="variable">r</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Random</span>();</span><br><span class="line">            <span class="type">int</span> <span class="variable">p</span> <span class="operator">=</span> r.nextInt(maxP) + <span class="number">1</span>, size = <span class="number">1</span> &lt;&lt; p, groupSize = r.nextInt(maxReverseGroupSize) + <span class="number">1</span>;</span><br><span class="line">            <span class="type">int</span>[] array1 = <span class="keyword">new</span> <span class="title class_">int</span>[size], array2 = <span class="keyword">new</span> <span class="title class_">int</span>[size], array3 = <span class="keyword">new</span> <span class="title class_">int</span>[size],</span><br><span class="line">            group1 = <span class="keyword">new</span> <span class="title class_">int</span>[groupSize], group2 = <span class="keyword">new</span> <span class="title class_">int</span>[groupSize], group3 = <span class="keyword">new</span> <span class="title class_">int</span>[groupSize];</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; size; ++i) array1[i] = array2[i] = array3[i] = r.nextInt(<span class="number">201</span>) - <span class="number">100</span>;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; groupSize; ++i) group1[i] = group2[i] = group3[i] = r.nextInt(p + <span class="number">1</span>);</span><br><span class="line">            <span class="type">int</span>[] ans1 = ReversePairCount2.count(array1, group1, p), ans2 = ReversePairCount22.count(array2, group2, p);</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; groupSize; ++i) &#123;</span><br><span class="line">                <span class="keyword">if</span>(ans1[i] != ans2[i]) &#123;</span><br><span class="line">                    System.out.println(<span class="string">&quot;Oops! answer incorrect!!, ans1[&quot;</span> + i + <span class="string">&quot;] = &quot;</span> + ans1[i] + <span class="string">&quot;, ans2[&quot;</span> + i + <span class="string">&quot;] = &quot;</span> + ans2[i]);</span><br><span class="line">                    System.out.println(Arrays.toString(ans1));</span><br><span class="line">                    System.out.println(Arrays.toString(ans2));</span><br><span class="line">                    System.out.println(Arrays.toString(array3));</span><br><span class="line">                    System.out.println(Arrays.toString(group3));</span><br><span class="line">                    System.out.println(p);</span><br><span class="line">                    System.out.println(groupSize);</span><br><span class="line">                    <span class="keyword">return</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println(<span class="string">&quot;Testcase: &quot;</span> + time + <span class="string">&quot; done!&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">&quot;Test done successfully !!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 算法 </category>
          
          <category> 问题 </category>
          
          <category> 归并排序相关 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 归并排序 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>数组逆序对个数问题【1】</title>
      <link href="/2022/10/26/ReversePairCount/"/>
      <url>/2022/10/26/ReversePairCount/</url>
      
        <content type="html"><![CDATA[<!-- toc --><h1 id="1-问题描述"><a href="#1-问题描述" class="headerlink" title="1. 问题描述"></a>1. 问题描述</h1><p>在一个数组中，如果存在两个下标i&lt;j，使得array[i] &gt; array[j]，那么称这是一个逆序对，求解数组中逆序对的个数。</p><p>例如：</p><p>array&#x3D;[1,2,3,1]，返回2，（2,1）,（3,1）</p><p>数组长度len范围$[1,5000]$。</p><p>测评链接：<a href="https://www.nowcoder.com/questionTerminal/bb06495cc0154e90bbb18911fd581df6">https://www.nowcoder.com/questionTerminal/bb06495cc0154e90bbb18911fd581df6</a></p><h1 id="2-暴力解法"><a href="#2-暴力解法" class="headerlink" title="2. 暴力解法"></a>2. 暴力解法</h1><p>遍历数组，对于每一个当下下标i，都在i的右边寻找有几个数小于array[i]，累加到答案中</p><p>代码：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ReversePairCount</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">count</span><span class="params">(<span class="type">int</span>[] array)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">len</span> <span class="operator">=</span> array.length, ans = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; len; ++i) &#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> i + <span class="number">1</span>; j &lt; len; ++j) &#123;</span><br><span class="line">                <span class="keyword">if</span>(array[i] &gt; array[j]) ++ans;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ans;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>时间复杂度$O(N^2)$，空间复杂度$O(1)$。</p><h1 id="3-最优解"><a href="#3-最优解" class="headerlink" title="3. 最优解"></a>3. 最优解</h1><h2 id="3-1-算法分析"><a href="#3-1-算法分析" class="headerlink" title="3.1. 算法分析"></a>3.1. 算法分析</h2><p>在merge sort的merge过程中，假设左右两组都是从小到大有序的，如果我们发现左组中的一个数a，大于右组中的一个数b，那么可以知道右组中从开始到b的数，都是小于a的，因此我们可以在线性时间内，求得左组中的任何一个数，在右组中有几个数小于它。因此我们有如下算法：</p><p>假设左组的当前下标是i，左组的结束位置是m，右组的当前下标是j，右组的结束位置是r，设置一个变量ans记录当前merge中产生的所有逆序对的个数，只要i&lt;&#x3D;m成立，执行如下步骤：</p><ol><li>只要j&lt;&#x3D;r &amp;&amp; array[j] &lt; array[i] 成立，++j;</li><li>收集答案，此时右组中有j-m-1个数小于array[i]，ans+&#x3D;j-m-1;</li><li>++i;</li></ol><p>然后执行merge操作。</p><p>上游的排序过程累加每次merge产生的逆序对的个数。</p><h2 id="3-2-代码"><a href="#3-2-代码" class="headerlink" title="3.2. 代码"></a>3.2. 代码</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ReversePairCount2</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">count</span><span class="params">(<span class="type">int</span>[] array)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">len</span> <span class="operator">=</span> array.length, ans = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">if</span>(len == <span class="number">1</span>) <span class="keyword">return</span> ans;</span><br><span class="line">        <span class="type">int</span> l, m, r, g = <span class="number">1</span>;</span><br><span class="line">        <span class="type">int</span>[] h = <span class="keyword">new</span> <span class="title class_">int</span>[len];</span><br><span class="line">        <span class="keyword">while</span>(g &lt; len) &#123;</span><br><span class="line">            l = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">while</span>(l &lt; len - <span class="number">1</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span>((m = l + g - <span class="number">1</span>) &gt;= len - <span class="number">1</span>) <span class="keyword">break</span>;</span><br><span class="line">                r = Math.min(len - <span class="number">1</span>, m + g);</span><br><span class="line">                ans += merge(array, l, m, r, h);</span><br><span class="line">                l = r + <span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(g &gt; (len &gt;&gt; <span class="number">1</span>)) <span class="keyword">break</span>;</span><br><span class="line">            g &lt;&lt;= <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ans;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">merge</span><span class="params">(<span class="type">int</span>[] array, <span class="type">int</span> l, <span class="type">int</span> m, <span class="type">int</span> r, <span class="type">int</span>[] h)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> l, j = m + <span class="number">1</span>, k = <span class="number">0</span>, ans = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span>(i &lt;= m) &#123;</span><br><span class="line">            <span class="keyword">while</span>(j &lt;= r &amp;&amp; array[j] &lt; array[i]) ++j;<span class="comment">// 只要满足条件，j一直跳下一个</span></span><br><span class="line">            ans += j - m - <span class="number">1</span>;<span class="comment">//此时右组一共有j-m-1个元素小于array[i]</span></span><br><span class="line">            ++i;</span><br><span class="line">        &#125;</span><br><span class="line">        i = l;</span><br><span class="line">        j = m + <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span>(i &lt;= m &amp;&amp; j &lt;= r) h[k++] = array[i] &lt;= array[j] ? array[i++] : array[j++];</span><br><span class="line">        <span class="keyword">while</span>(i &lt;= m) h[k++] = array[i++];</span><br><span class="line">        <span class="keyword">while</span>(j &lt;= r) h[k++] = array[j++];</span><br><span class="line">        System.arraycopy(h, <span class="number">0</span>, array, l, k);</span><br><span class="line">        <span class="keyword">return</span> ans;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>时间复杂度$O(N\log_2N)$，空间复杂度$O(N)$。</p><h1 id="4-测试程序"><a href="#4-测试程序" class="headerlink" title="4. 测试程序"></a>4. 测试程序</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ReversePairCountTest</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">time</span> <span class="operator">=</span> <span class="number">100_0000</span>, maxSize = <span class="number">5000</span>;</span><br><span class="line">        <span class="keyword">while</span>(time-- &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="type">Random</span> <span class="variable">r</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Random</span>();</span><br><span class="line">            <span class="type">int</span> <span class="variable">size</span> <span class="operator">=</span> r.nextInt(maxSize) + <span class="number">1</span>;</span><br><span class="line">            <span class="type">int</span>[] array1 = <span class="keyword">new</span> <span class="title class_">int</span>[size], array2 = <span class="keyword">new</span> <span class="title class_">int</span>[size], array3 = <span class="keyword">new</span> <span class="title class_">int</span>[size];</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; size; ++i) array1[i] = array2[i] = array3[i] = r.nextInt(<span class="number">101</span>);</span><br><span class="line">            <span class="type">int</span> <span class="variable">ans1</span> <span class="operator">=</span> ReversePairCount.count(array1), ans2 = ReversePairCount2.count(array2);</span><br><span class="line">            <span class="keyword">if</span>(ans1 != ans2) &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;Answer incorrect!, ans1: &quot;</span> + ans1 + <span class="string">&quot;, ans2: &quot;</span> + ans2);</span><br><span class="line">                System.out.println(Arrays.toString(array3));</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println(<span class="string">&quot;Testcase: &quot;</span> + time + <span class="string">&quot; success!&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">&quot;Test done successfully!!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 算法 </category>
          
          <category> 问题 </category>
          
          <category> 归并排序相关 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 归并排序 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>二倍不及问题</title>
      <link href="/2022/10/25/TwiceNotLargeThan/"/>
      <url>/2022/10/25/TwiceNotLargeThan/</url>
      
        <content type="html"><![CDATA[<!-- toc --><h1 id="1-问题描述"><a href="#1-问题描述" class="headerlink" title="1. 问题描述"></a>1. 问题描述</h1><p>给定一个数组，如果某一个元素x，对于它的右边的任何一个数p，只要满足2*p&lt;x，则认为此数达标，相对于x达标数的个数，记为函数$f(x)$，求数组中每一个数的f函数值的总和。</p><p>例如：array&#x3D;[1,2,3,1];</p><p>第0个数1的右边有0个满足要求，</p><p>第1个数2的右边有0个满足要求，</p><p>第2个数3的右边有1个满足要求，</p><p>最后一个数右边没有数，满足要求的数0个，</p><p>因此答案就是1。</p><p>数组长度len的范围$[1,10^6]$，数组元素范围$[-100,100]$。</p><h1 id="2-暴力解法"><a href="#2-暴力解法" class="headerlink" title="2. 暴力解法"></a>2. 暴力解法</h1><p>直接根据定义做，上代码：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TwiceNotGreater</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">tng</span><span class="params">(<span class="type">int</span>[] array)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">ans</span> <span class="operator">=</span> <span class="number">0</span>, len = array.length;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; len; ++i) &#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> i + <span class="number">1</span>; j &lt; len; ++j) &#123;</span><br><span class="line">                <span class="keyword">if</span>((array[j] &lt;&lt; <span class="number">1</span>) &lt; array[i]) ++ans;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ans;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>时间复杂度$O(N^2)$，空间复杂度$O(1)$。</p><h1 id="3-最优解"><a href="#3-最优解" class="headerlink" title="3. 最优解"></a>3. 最优解</h1><h2 id="3-1-算法分析"><a href="#3-1-算法分析" class="headerlink" title="3.1. 算法分析"></a>3.1. 算法分析</h2><p>在mergeSort的merge过程中，左右两组是有序的（假设从小到大），对于左组中的一个数a，我们发现右组中的一个数b，满足b*2&lt;a，那么根据右组数组有序，b前面的数都满足b*2&lt;a。因此我们可以设计如下算法：</p><p>对数组array进行merge sort，在merge的过程中，假设左组的位置下标i，左组结束位置m，右组下标j，右组结束位置r，设置一个变量ans记录merge过程中的产生的答案；只要 i&lt;&#x3D;m成立，进行如下步骤：</p><ol><li>只要 j&lt;&#x3D;r&amp;&amp; array[j] * 2 &lt; array[i] 成立，j++</li><li>收集答案，ans+&#x3D; j-m-1;</li><li>++i;</li></ol><p>然后进行数组的merge过程，最终merge方法返回ans;</p><p>上游的排序方法中收集每次merge的返回值，累加到总的答案中。</p><h2 id="3-2-代码"><a href="#3-2-代码" class="headerlink" title="3.2. 代码"></a>3.2. 代码</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TwiceNotGreater2</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">tng</span><span class="params">(<span class="type">int</span>[] array)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">len</span> <span class="operator">=</span> array.length, ans = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">if</span>(len == <span class="number">1</span>) <span class="keyword">return</span> ans;</span><br><span class="line">        <span class="type">int</span> l, m, r,g = <span class="number">1</span>;</span><br><span class="line">        <span class="type">int</span>[] help = <span class="keyword">new</span> <span class="title class_">int</span>[len];</span><br><span class="line">        <span class="keyword">while</span>(g &lt; len) &#123;</span><br><span class="line">            l = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">while</span>(l &lt; len - <span class="number">1</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span>((m = l + g - <span class="number">1</span>) &gt;= len - <span class="number">1</span>) <span class="keyword">break</span>;</span><br><span class="line">                r = Math.min(m + g, len - <span class="number">1</span>);</span><br><span class="line">                ans += merge(array, l, m, r, help);</span><br><span class="line">                l = r + <span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(g &gt; (len &gt;&gt; <span class="number">1</span>)) <span class="keyword">break</span>;</span><br><span class="line">            g &lt;&lt;= <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ans;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">merge</span><span class="params">(<span class="type">int</span>[] array, <span class="type">int</span> l, <span class="type">int</span> m, <span class="type">int</span> r, <span class="type">int</span>[] help)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> l, j = m + <span class="number">1</span>, ans = <span class="number">0</span>, k = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span>(i &lt;= m) &#123;</span><br><span class="line">            <span class="keyword">while</span>(j &lt;= r &amp;&amp; (array[j] &lt;&lt; <span class="number">1</span>) &lt; array[i]) ++j;</span><br><span class="line">            ans += j - m - <span class="number">1</span>;</span><br><span class="line">            ++i;</span><br><span class="line">        &#125;</span><br><span class="line">        i = l;</span><br><span class="line">        j = m + <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span>(i &lt;= m &amp;&amp; j &lt;= r) help[k++] = array[i] &lt;= array[j] ? array[i++] : array[j++];</span><br><span class="line">        <span class="keyword">while</span>(i &lt;= m) help[k++] = array[i++];</span><br><span class="line">        <span class="keyword">while</span>(j &lt;= r) help[k++] = array[j++];</span><br><span class="line">        System.arraycopy(help,<span class="number">0</span>,array,l,k);</span><br><span class="line">        <span class="keyword">return</span> ans;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>时间复杂度$O(N\log_2N)$，空间复杂度$O(N)$。</p><h1 id="4-测试程序"><a href="#4-测试程序" class="headerlink" title="4. 测试程序"></a>4. 测试程序</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TwiceNotGreaterTest</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">time</span> <span class="operator">=</span> <span class="number">100_0000</span>, maxArraySize = <span class="number">30</span>;</span><br><span class="line">        <span class="keyword">while</span>(time-- &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="type">Random</span> <span class="variable">r</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Random</span>();</span><br><span class="line">            <span class="type">int</span> <span class="variable">size</span> <span class="operator">=</span> r.nextInt(maxArraySize) + <span class="number">1</span>;</span><br><span class="line">            <span class="type">int</span>[] array1 = <span class="keyword">new</span> <span class="title class_">int</span>[size], array2 = <span class="keyword">new</span> <span class="title class_">int</span>[size], array3 = <span class="keyword">new</span> <span class="title class_">int</span>[size];</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; size; ++i) array1[i] = array2[i] = array3[i] = r.nextInt(<span class="number">201</span>) - <span class="number">100</span>;</span><br><span class="line">            <span class="type">int</span> <span class="variable">ans1</span> <span class="operator">=</span> TwiceNotGreater.tng(array1), ans2 = TwiceNotGreater2.tng(array2);</span><br><span class="line">            <span class="keyword">if</span>(ans1 != ans2) &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;Answer incorrect!!,  ans1: &quot;</span> + ans1 + <span class="string">&quot;, ans2: &quot;</span> + ans2);</span><br><span class="line">                System.out.println(Arrays.toString(array3));</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println(<span class="string">&quot;Testcase: &quot;</span> + time + <span class="string">&quot; done!&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">&quot;Test done successfully!!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 算法 </category>
          
          <category> 问题 </category>
          
          <category> 归并排序相关 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 归并排序 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>数组小和问题</title>
      <link href="/2022/10/25/SmallSum/"/>
      <url>/2022/10/25/SmallSum/</url>
      
        <content type="html"><![CDATA[<!-- toc --><h1 id="1-问题描述"><a href="#1-问题描述" class="headerlink" title="1. 问题描述"></a>1. 问题描述</h1><p>在一个数组中，对于任何一个元素x，它左边（如果有的话）的所有小于它的元素之和，叫做关于元素x的小和，那么数组中所有元素的小和的累加和就是数组的小和。</p><p>现在给定一个数组array，求解数组的小和。</p><p>例如：array&#x3D;[1,3,4,3,7]；</p><p>关于第0个元素1的小和：0，这是因为他是最左边的元素；</p><p>关于第1个元素3的小和：1；</p><p>关于第2个元素4的小和：1 + 3 &#x3D; 4；</p><p>关于第3个元素3的小和：1；</p><p>关于第4个元素7的小和：1 + 3 + 4 + 3 &#x3D; 11。</p><p>因此数组的小和：0 + 1 + 4 + 1 + 11 &#x3D; 17。因此返回17。</p><p>数组长度len范围：$[1,10^6]$，数组数组每一个元素范围：$[-100,100]$。</p><p>相关测评：</p><ol><li><a href="https://www.nowcoder.com/questionTerminal/8397609ba7054da382c4599d42e494f3">https://www.nowcoder.com/questionTerminal/8397609ba7054da382c4599d42e494f3</a></li><li><a href="https://www.nowcoder.com/questionTerminal/bb06495cc0154e90bbb18911fd581df6">https://www.nowcoder.com/questionTerminal/bb06495cc0154e90bbb18911fd581df6</a></li></ol><h1 id="2-暴力做法"><a href="#2-暴力做法" class="headerlink" title="2. 暴力做法"></a>2. 暴力做法</h1><p>按照定义，对于每一个元素x，我们遍历它的左边部分，累加所有小于它的元素，求得x的小和，累加所有元素的小和即可。</p><p>代码：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SmallSum</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">long</span> <span class="title function_">smallSum</span><span class="params">(<span class="type">int</span>[] array)</span> &#123;</span><br><span class="line">        <span class="type">long</span> <span class="variable">ans</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt; array.length; ++i) &#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; j &lt; i; ++j) &#123;</span><br><span class="line">                <span class="keyword">if</span>(array[j] &lt; array[i]) ans += array[j];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ans;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>时间复杂度$O(N^2)$，空间复杂度$O(1)$。</p><h1 id="3-最优解"><a href="#3-最优解" class="headerlink" title="3. 最优解"></a>3. 最优解</h1><h2 id="3-1-算法分析"><a href="#3-1-算法分析" class="headerlink" title="3.1. 算法分析"></a>3.1. 算法分析</h2><p>转换思路，我们不要直接求解在一个数组中，一个元素x的小和是什么。而是尝试看一下这个元素x对总的小和的贡献，如果在元素x的右边，有y个元素都大于x，那么在最终的答案中，元素x会贡献y*x这么多值。在mergeSort中，左右两组合并的时候，两组是已经有序的了，这样的有序性可以加速我们的求解过程。</p><p>假设我们发现左组中的一个数a，小于了右组中的某个数b，因为右组的有序性（假设从小到大），可以知道在右组中，所有b后面的数都是大于a的，因此我们可以根据这样的有序性快速的知道，右组有几个数大于左组的a。</p><p>因此就有如下的算法：</p><p>对整个数组进行merge sort，在merge的逻辑中，左组的指针记做i，右组的指针记做j，右组的结束位置是r，左组的结束位置记做m，设置一个变量ans记录merge过程产生的小和总贡献值，只要i&lt;&#x3D;m &amp;&amp; j &lt;&#x3D; r成立，那么执行如下步骤：</p><ol><li>如果array[i] &lt; array[j]，那么array[j] 后面的数都是大于array[i]的，因此array[i]贡献了array[i] * (r-j+1)的小和，把这个数加到ans中；</li><li>否则j++；</li></ol><p>返回ans。</p><p>在mergeSort的主过程中，收到merge返回的贡献值，累加到总答案中。</p><h2 id="3-2-代码"><a href="#3-2-代码" class="headerlink" title="3.2. 代码"></a>3.2. 代码</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SmallSum2</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">long</span> <span class="title function_">smallSum</span><span class="params">(<span class="type">int</span>[] array)</span> &#123;</span><br><span class="line">        <span class="type">long</span> <span class="variable">ans</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">len</span> <span class="operator">=</span> array.length;</span><br><span class="line">        <span class="keyword">if</span>(len == <span class="number">1</span>) <span class="keyword">return</span> ans;</span><br><span class="line">        <span class="type">int</span>[] help = <span class="keyword">new</span> <span class="title class_">int</span>[len];</span><br><span class="line">        <span class="type">int</span> <span class="variable">group</span> <span class="operator">=</span> <span class="number">1</span>, l = <span class="number">0</span>, r = len - <span class="number">1</span>, x, m, y;</span><br><span class="line">        <span class="keyword">while</span>(group &lt; len) &#123;</span><br><span class="line">            x = l;</span><br><span class="line">            <span class="keyword">while</span>(x &lt; r) &#123;</span><br><span class="line">                <span class="keyword">if</span>((m = x + group - <span class="number">1</span>) &gt;= r) <span class="keyword">break</span>;</span><br><span class="line">                y = Math.min(m + group, r);</span><br><span class="line">                ans += merge(array,x,m,y,help);</span><br><span class="line">                x = y + <span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(group &gt; (len &gt;&gt; <span class="number">1</span>)) <span class="keyword">break</span>;</span><br><span class="line">            group &lt;&lt;= <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ans;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">long</span> <span class="title function_">merge</span><span class="params">(<span class="type">int</span>[] array, <span class="type">int</span> l, <span class="type">int</span> m, <span class="type">int</span> r, <span class="type">int</span>[] help)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> l, j = m + <span class="number">1</span>, k = <span class="number">0</span>;</span><br><span class="line">        <span class="type">long</span> <span class="variable">ans</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span>(i &lt;= m &amp;&amp; j &lt;= r) &#123;</span><br><span class="line">            <span class="keyword">if</span>(array[i] &lt; array[j]) ans += array[i] * (r - j + <span class="number">1</span>);</span><br><span class="line">            help[k++] = array[i] &lt; array[j] ? array[i++] : array[j++];<span class="comment">// 相等的时候，拷贝右组，这是因为相等的时候，此时不知道右组中有几个数比array[i]要大，此时array[i]的贡献值还不能确定，如果i向下跳一个，那么如果j后面有大于array[i]的数，就错过了array[i]的贡献值了，因此只能j向下跳一个，继续比较。</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">while</span>(i &lt;= m) help[k++] = array[i++];</span><br><span class="line">        <span class="keyword">while</span>(j &lt;= r) help[k++] = array[j++];</span><br><span class="line">        System.arraycopy(help,<span class="number">0</span>,array,l,k);</span><br><span class="line">        <span class="keyword">return</span> ans;</span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>时间复杂度$O(N\log_2N)$，空间复杂度$O(N)$。</p><h1 id="4-测试程序"><a href="#4-测试程序" class="headerlink" title="4. 测试程序"></a>4. 测试程序</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SmallSumTest</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">testTimes</span> <span class="operator">=</span> <span class="number">100_0000</span>, maxArraySize = <span class="number">100_0000</span>;</span><br><span class="line">        <span class="keyword">while</span>(testTimes-- &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="type">Random</span> <span class="variable">r</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Random</span>();</span><br><span class="line">            <span class="type">int</span> <span class="variable">size</span> <span class="operator">=</span> r.nextInt(maxArraySize) + <span class="number">1</span>;</span><br><span class="line">            <span class="type">int</span>[] array1 = <span class="keyword">new</span> <span class="title class_">int</span>[size], array2 = <span class="keyword">new</span> <span class="title class_">int</span>[size];</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; size; ++i) array1[i] = array2[i] = r.nextInt(<span class="number">201</span>) - <span class="number">100</span>;</span><br><span class="line">            <span class="type">long</span> <span class="variable">ans1</span> <span class="operator">=</span> SmallSum.smallSum(array1), ans2 = SmallSum2.smallSum(array2);</span><br><span class="line">            <span class="keyword">if</span>(ans1 != ans2) &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;Oops!!,Not equals, ans1 = &quot;</span> + ans1 + <span class="string">&quot;, ans2 = &quot;</span> + ans2);</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println(<span class="string">&quot;Testcase: &quot;</span> + testTimes + <span class="string">&quot; pass!&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">&quot;Done successfully!!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 算法 </category>
          
          <category> 问题 </category>
          
          <category> 归并排序相关 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 归并排序 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>归并排序</title>
      <link href="/2022/10/24/MergeSort/"/>
      <url>/2022/10/24/MergeSort/</url>
      
        <content type="html"><![CDATA[<!-- toc --><h1 id="1-归并排序算法思想"><a href="#1-归并排序算法思想" class="headerlink" title="1. 归并排序算法思想"></a>1. 归并排序算法思想</h1><p>归并排序使用的是分治的思想，把问题拆分成子问题，逐个解决子问题，在把子问题的解合并，得到原问题的解。</p><h1 id="2-递归的归并排序"><a href="#2-递归的归并排序" class="headerlink" title="2. 递归的归并排序"></a>2. 递归的归并排序</h1><h2 id="2-1-算法描述"><a href="#2-1-算法描述" class="headerlink" title="2.1. 算法描述"></a>2.1. 算法描述</h2><p>对于一个数组array，数组的长度是size：</p><ol><li>如果size&#x3D;&#x3D;1，那么数组已经有序了，返回；否则进行下面的步骤，</li><li>把原数组拆分成长度近似相等的两个子数组（如果size是奇数，那么无法平均分配），递归调用归并排序的方法，对这两个子数组进行排序；</li><li>把排好序的两个子数组和并在一起。</li></ol><h2 id="2-2-代码"><a href="#2-2-代码" class="headerlink" title="2.2. 代码"></a>2.2. 代码</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MergeSortRecursively</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">sort</span><span class="params">(<span class="type">int</span>[] array)</span> &#123;</span><br><span class="line">        sort(array,<span class="number">0</span>,array.length - <span class="number">1</span>,<span class="keyword">new</span> <span class="title class_">int</span>[array.length]);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">sort</span><span class="params">(<span class="type">int</span>[] array, <span class="type">int</span> l, <span class="type">int</span> r,<span class="type">int</span>[] help)</span> &#123;</span><br><span class="line">        <span class="comment">// 对数组的[l..r]部分进行排序，使用辅助数组help</span></span><br><span class="line">        <span class="keyword">if</span>(l == r) <span class="keyword">return</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">m</span> <span class="operator">=</span> (l + r) &gt;&gt;&gt; <span class="number">1</span>;<span class="comment">// 获取中点位置，使用&gt;&gt;&gt;是为了防止溢出</span></span><br><span class="line">        sort(array,l,m,help);</span><br><span class="line">        sort(array,m + <span class="number">1</span>,r,help);</span><br><span class="line">        merge(array,l,m,r,help);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">merge</span><span class="params">(<span class="type">int</span>[] array, <span class="type">int</span> l, <span class="type">int</span> m ,<span class="type">int</span> r, <span class="type">int</span>[] help)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> l, j = m + <span class="number">1</span>, k = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span>(i &lt;= m &amp;&amp; j &lt;= r) help[k++] = array[i] &lt;= array[j] ? array[i++] : array[j++];<span class="comment">// 谁小拷贝谁，相等的时候，优先考虑左组（保证排序算法的稳定性）</span></span><br><span class="line">        <span class="keyword">while</span>(i &lt;= m) help[k++] = array[i++];</span><br><span class="line">        <span class="keyword">while</span>(j &lt;= r) help[k++] = array[j++];</span><br><span class="line">        System.arraycopy(help,<span class="number">0</span>,array,l,k);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>时间复杂度$O(N\log_2N)$，空间复杂度$O(N)$的合并辅助空间以及$O(\log_2N)$的递归栈空间。</p><h1 id="3-迭代的归并排序"><a href="#3-迭代的归并排序" class="headerlink" title="3. 迭代的归并排序"></a>3. 迭代的归并排序</h1><p>递归版本的是从上往下的方法，大数组不断拆分成小数组。迭代的方法是从下往上的方法，先考虑合并最小的分组，然后逐渐增加分组的长度，直到整个数组变成一个分组的时候，数组就排好序了。</p><h2 id="3-1-算法描述"><a href="#3-1-算法描述" class="headerlink" title="3.1. 算法描述"></a>3.1. 算法描述</h2><p>数组待排序部分的长度记为len，分组长度groupLen初始化为1；数组待排序部分开始下标l，末尾下标r；</p><p>只要groupLen&lt;len，就执行下面的步骤：</p><ol><li>使用一个变量x表示当前分组的开始位置，x初始化为l；只要x&lt;r，执行下面的步骤；<ol><li>如果数组剩余部分刚好够左分组的长度，或者不够左分组的长度，那么此时是没有右分组的，因此直接退出内循环；</li><li>否则，有右分组，那么确定右分组的结束位置y，以及左分组的结束位置mid；</li><li>执行merge操作</li><li>开始位置x &#x3D; y+1；</li></ol></li><li>如果分组长度groupLen已经超过了数组的长度了，那么退出外循环，排序结束，</li><li>否则groupLen *&#x3D; 2</li></ol><h2 id="3-2-代码"><a href="#3-2-代码" class="headerlink" title="3.2. 代码"></a>3.2. 代码</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MergeSortIteratively</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">sort</span><span class="params">(<span class="type">int</span>[] array)</span> &#123;</span><br><span class="line">        sort(array,<span class="number">0</span>,array.length - <span class="number">1</span>,<span class="keyword">new</span> <span class="title class_">int</span>[array.length]);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">sort</span><span class="params">(<span class="type">int</span>[] array, <span class="type">int</span> l, <span class="type">int</span> r, <span class="type">int</span>[] help)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(l == r) <span class="keyword">return</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">len</span> <span class="operator">=</span> r - l + <span class="number">1</span>, groupLen = <span class="number">1</span>, x, m, y;</span><br><span class="line">        <span class="keyword">while</span>(groupLen &lt; len) &#123;</span><br><span class="line">            x = l;</span><br><span class="line">            <span class="keyword">while</span>(x &lt; r) &#123;</span><br><span class="line">                </span><br><span class="line">                <span class="keyword">if</span>((m = x + groupLen - <span class="number">1</span>) &gt;= r) <span class="keyword">break</span>;<span class="comment">// m是左组的结束位置，如果m不小于r，则说明此时没有右组了，因此结束</span></span><br><span class="line">                y = Math.min(m + groupLen, r);<span class="comment">// 有右组，但是右组不一定是满的，因此右组的结束位置是r和m+groupLen的二者的最小值。</span></span><br><span class="line">                merge(array,x,m,y,help);</span><br><span class="line">                x = y + <span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(groupLen &gt; (len &gt;&gt; <span class="number">1</span>)) <span class="keyword">break</span>; <span class="comment">// 这里不能使用 if((groupLen &lt;&lt; 1) &gt; len)，因为groupLen 乘以2以后可能会溢出。</span></span><br><span class="line">            groupLen &lt;&lt;= <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">merge</span><span class="params">(<span class="type">int</span>[] array, <span class="type">int</span> l, <span class="type">int</span> m, <span class="type">int</span> r, <span class="type">int</span>[] help)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> l, j = m + <span class="number">1</span>, k = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span>(i &lt;= m &amp;&amp; j &lt;= r) help[k++] = array[i] &lt;= array[j] ? array[i++] : array[j++];</span><br><span class="line">        <span class="keyword">while</span>(i &lt;= m) help[k++] = array[i++];</span><br><span class="line">        <span class="keyword">while</span>(j &lt;= r) help[k++] = array[j++];</span><br><span class="line">        System.arraycopy(help,<span class="number">0</span>,array,l,k);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>时间复杂度$O(N\log_2N)$，空间复杂度$O(N)$。没有过多的系统堆栈空间。</p><h1 id="4-测试程序"><a href="#4-测试程序" class="headerlink" title="4. 测试程序"></a>4. 测试程序</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MergeSortTest</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">testTimes</span> <span class="operator">=</span> <span class="number">100_0000</span>, maxArraySize = <span class="number">30</span>;</span><br><span class="line">        <span class="keyword">while</span>(testTimes-- &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="type">Random</span> <span class="variable">r</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Random</span>();</span><br><span class="line">            <span class="type">int</span> <span class="variable">size</span> <span class="operator">=</span> r.nextInt(maxArraySize) + <span class="number">1</span>;</span><br><span class="line">            <span class="type">int</span>[] array1 = <span class="keyword">new</span> <span class="title class_">int</span>[size], array2 = <span class="keyword">new</span> <span class="title class_">int</span>[size], array3 = <span class="keyword">new</span> <span class="title class_">int</span>[size];</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; size; ++i) array1[i] = array2[i] = array3[i] = r.nextInt(<span class="number">5000</span>);</span><br><span class="line">            Arrays.sort(array1);</span><br><span class="line">            MergeSortRecursively.sort(array2);</span><br><span class="line">            MergeSortIteratively.sort(array3);</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; size; ++i) &#123;</span><br><span class="line">                <span class="keyword">if</span>(array1[i] != array2[i] || array1[i] != array3[i]) &#123;</span><br><span class="line">                    System.out.println(<span class="string">&quot;Oops!!, Not equals&quot;</span>);</span><br><span class="line">                    System.out.println(<span class="string">&quot;array:&quot;</span>);</span><br><span class="line">                    System.out.println(Arrays.toString(array1));</span><br><span class="line">                    System.out.println(<span class="string">&quot;array2:&quot;</span>);</span><br><span class="line">                    System.out.println(Arrays.toString(array2));</span><br><span class="line">                    System.out.println(<span class="string">&quot;array3:&quot;</span>);</span><br><span class="line">                    System.out.println(Arrays.toString(array3));</span><br><span class="line">                    <span class="keyword">return</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println(<span class="string">&quot;Test case: &quot;</span> + testTimes + <span class="string">&quot; pass&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">&quot;Done Successfully!!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 算法 </category>
          
          <category> 排序 </category>
          
          <category> 归并排序 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 归并排序 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>分解质因数</title>
      <link href="/2022/10/24/PrimeNumberDecomposition/"/>
      <url>/2022/10/24/PrimeNumberDecomposition/</url>
      
        <content type="html"><![CDATA[<!-- toc --><h1 id="1-问题描述"><a href="#1-问题描述" class="headerlink" title="1. 问题描述"></a>1. 问题描述</h1><p>编写一个程序，给定一个正整数n（n&gt;&#x3D;2），分解质因数，返回分解结果。</p><p>例如：</p><ol><li>n&#x3D;6，返回：[2,3]；</li><li>n&#x3D;18，返回[2,3,3]；</li><li>n&#x3D;3，返回[3]</li></ol><h1 id="2-算法描述"><a href="#2-算法描述" class="headerlink" title="2. 算法描述"></a>2. 算法描述</h1><p>准备一个答案列表ans，设置一个循环遍历i从2开始，循环条件是i&lt;&#x3D;n；对于每一个i：</p><ol><li>如果i&#x3D;&#x3D;n，那么把i加入ans，返回；</li><li>只要n%i&#x3D;&#x3D;0，那么就把i加入ans；n&#x2F;&#x3D;i;</li><li>如果n是质数，那么就把n加入ans，返回，否则i++</li></ol><h1 id="3-代码"><a href="#3-代码" class="headerlink" title="3. 代码"></a>3. 代码</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PrimeNumberDecomposition</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> List&lt;Integer&gt; <span class="title function_">decomposition</span><span class="params">(<span class="type">int</span> n)</span> &#123;</span><br><span class="line">        List&lt;Integer&gt; ans = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">2</span>; i &lt;= n; ) &#123;</span><br><span class="line">            <span class="keyword">if</span>(i == n) &#123;</span><br><span class="line">                ans.add(i);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">while</span>(n % i == <span class="number">0</span>) &#123;</span><br><span class="line">                ans.add(i);</span><br><span class="line">                n /= i;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(primeNum(n)) &#123;</span><br><span class="line">                ans.add(n);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            ++i;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ans;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">boolean</span> <span class="title function_">primeNum</span><span class="params">(<span class="type">int</span> n)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(n &lt;= <span class="number">3</span>) <span class="keyword">return</span> n != <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span>(n % <span class="number">6</span> != <span class="number">1</span> &amp;&amp; n % <span class="number">6</span> != <span class="number">5</span>) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">5</span>, limit = (<span class="type">int</span>)Math.sqrt(n); i &lt;= limit; i += <span class="number">6</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span>(n % i == <span class="number">0</span> || n % (i + <span class="number">2</span>) == <span class="number">0</span>) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Scanner</span> <span class="variable">sc</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Scanner</span>(System.in);</span><br><span class="line">        System.out.println(<span class="string">&quot;Input your number please:&quot;</span>);</span><br><span class="line">        <span class="type">int</span> <span class="variable">num</span> <span class="operator">=</span> sc.nextInt();</span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;Result is: &quot;</span> + decomposition(num));</span><br><span class="line">            System.out.println(<span class="string">&quot;Input your number please:&quot;</span>);</span><br><span class="line">            num = sc.nextInt();</span><br><span class="line">        &#125;<span class="keyword">while</span>(num != <span class="number">1</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;Bye~~&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 算法 </category>
          
          <category> 问题 </category>
          
          <category> 数学相关 </category>
          
          <category> 素数 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 数学 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>筛选素数</title>
      <link href="/2022/10/20/getPrimeNums/"/>
      <url>/2022/10/20/getPrimeNums/</url>
      
        <content type="html"><![CDATA[<!-- toc --><h1 id="1-问题描述"><a href="#1-问题描述" class="headerlink" title="1. 问题描述"></a>1. 问题描述</h1><p>给定一个正整数n，返回$[1,n]$之间的所有素数。结果按照从小到大的顺序排列。</p><p>相关测评：<a href="https://leetcode-cn.com/problems/count-primes/">https://leetcode-cn.com/problems/count-primes/</a></p><h1 id="2-暴力解法"><a href="#2-暴力解法" class="headerlink" title="2. 暴力解法"></a>2. 暴力解法</h1><h2 id="2-1-算法描述"><a href="#2-1-算法描述" class="headerlink" title="2.1. 算法描述"></a>2.1. 算法描述</h2><p>遍历$[1,n]$之间的所有数字，对于每一个判断其是不是素数，是的话就加入列表。</p><h2 id="2-2-代码"><a href="#2-2-代码" class="headerlink" title="2.2. 代码"></a>2.2. 代码</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GetPrimeNums</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> List&lt;Integer&gt; <span class="title function_">getPrimeNums</span><span class="params">(<span class="type">int</span> n)</span> &#123;</span><br><span class="line">        List&lt;Integer&gt; ans = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">if</span>(n == <span class="number">1</span>)<span class="keyword">return</span> ans;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt;= n; ++i) &#123;</span><br><span class="line">            <span class="keyword">if</span>(isPrime(i)) ans.add(i);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ans;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">boolean</span> <span class="title function_">isPrime</span><span class="params">(<span class="type">int</span> n)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(n == <span class="number">1</span>) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">2</span>, limit = (<span class="type">int</span>)Math.sqrt(n); i &lt;= limit; ++i) &#123;</span><br><span class="line">            <span class="keyword">if</span>(n % i == <span class="number">0</span>) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>时间复杂度$O(N\sqrt{N})$，额外空间复杂度$O(1)$。</p><h1 id="3-埃氏筛"><a href="#3-埃氏筛" class="headerlink" title="3. 埃氏筛"></a>3. 埃氏筛</h1><h2 id="3-1-算法分析"><a href="#3-1-算法分析" class="headerlink" title="3.1. 算法分析"></a>3.1. 算法分析</h2><p>任何一合数都可以表示成几个素数的乘积，即一个合数一定是素数的倍数，因此我们只需要把素数的倍数筛掉，剩下的都是素数了。</p><p>因此我们需要一个标记数组prime来表示哪些数字是素数，初始化全部为true，表示都是素数。</p><p>i从2开始到n，遍历数组</p><ol><li>如果当前位置是true，那么从$2i$开始，步长是$i$，到$n$，把这些数字设置为false。</li><li>如果当前位置是false，表示当前位置已经是一个合数了，因此跳过。</li><li>最后遍历一次数组（从2开始），收集为true的数即可。</li></ol><blockquote><p>证明：</p><ol><li>当i&gt;2的时候，如果此时prime[i]是true，那么说明$[2,i-1]$之间的所有素数的倍数，都不是i，这是因为如果i是$[2,i-1]$之间某个素数x的倍数的话，那么当我们在遍历x的时候，i一定会被设置为false。因此如果prime[i]是true，那么就代表它不能被$[2,i-1]$之间的任何一个素数整除，那么i就是素数。</li><li>当i&#x3D;&#x3D;2的时候，2本身是素数</li></ol><p>因此上面的方法是正确的。</p></blockquote><h2 id="3-2-代码"><a href="#3-2-代码" class="headerlink" title="3.2. 代码"></a>3.2. 代码</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GetPrimeNumsEratosthenes</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> List&lt;Integer&gt; <span class="title function_">getPrimeNums</span><span class="params">(<span class="type">int</span> n)</span> &#123;</span><br><span class="line">        List&lt;Integer&gt; ans = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">if</span>(n == <span class="number">1</span>) <span class="keyword">return</span> ans;</span><br><span class="line">        <span class="type">boolean</span>[] prime = <span class="keyword">new</span> <span class="title class_">boolean</span>[n + <span class="number">1</span>];</span><br><span class="line">        Arrays.fill(visit,<span class="literal">true</span>);</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">2</span>; i &lt;= n; ++i) &#123;</span><br><span class="line">            <span class="keyword">if</span>(visit[i]) &#123;</span><br><span class="line">                <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> i &lt;&lt; <span class="number">1</span>; j &lt;= n; j += i) visit[j] = <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">2</span>; i &lt;= n; ++i) &#123;</span><br><span class="line">            <span class="keyword">if</span>(visit[i]) ans.add(i);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ans;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>编码技巧：</p><ol><li>可以设置一个notPrime数组，即非素数数组，标记为true的都是非素数，由于java语言的特性，数组初始化的时候全部都是false，因此就省掉了第9行的代码，减少常数时间。</li><li>最后不用再次遍历一遍数组收集答案，可以在第一次遍历的时候，一边遍历，一边收集答案，代码更精简。</li></ol></blockquote><blockquote><p>算法优化点：</p><ol><li>第12行代码的j不需要从$2i$开始，可以从$i<em>i$开始，这是因为，当我们要把$x</em>i(x&lt;i)$设置为false的时候，其实在我们遍历x的时候，$x*i$已经设置过了，因此不需要重复设置。</li></ol></blockquote><p>于是优化后的代码：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GetPrimeNumsEratosthenes</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> List&lt;Integer&gt; <span class="title function_">getPrimeNums</span><span class="params">(<span class="type">int</span> n)</span> &#123;</span><br><span class="line">        List&lt;Integer&gt; ans = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">if</span>(n == <span class="number">1</span>) <span class="keyword">return</span> ans;</span><br><span class="line">        <span class="type">boolean</span>[] notPrime = <span class="keyword">new</span> <span class="title class_">boolean</span>[n + <span class="number">1</span>];</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">2</span>; i &lt;= n; ++i) &#123;</span><br><span class="line">            <span class="keyword">if</span>(!notPrime[i]) &#123;</span><br><span class="line">                ans.add(i);</span><br><span class="line">                <span class="keyword">for</span>(<span class="type">long</span> <span class="variable">j</span> <span class="operator">=</span> (<span class="type">long</span>)i * i; j &lt;= n; j += i) notPrime[(<span class="type">int</span>)j] = <span class="literal">true</span>;<span class="comment">// 用long类型防止因为i太大导致溢出</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ans;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>空间复杂度$O(N)$，时间复杂度$O(N\log_2(\log_2N))$，时间复杂度证明参考：<a href="https://www.cnblogs.com/alfayoung/p/16154640.html">https://www.cnblogs.com/alfayoung/p/16154640.html</a></p><h1 id="4-欧拉筛"><a href="#4-欧拉筛" class="headerlink" title="4. 欧拉筛"></a>4. 欧拉筛</h1><h2 id="4-1-算法分析"><a href="#4-1-算法分析" class="headerlink" title="4.1. 算法分析"></a>4.1. 算法分析</h2><p>埃氏筛是遇到一个素数，就筛掉这个素数的倍数，但是这样会存在重复筛掉一个数的情况，例如当遇到素数2的时候，筛掉2的6倍，即$2<em>6&#x3D;12$，当我们们遇到3的时候，会筛掉3的4倍，即$3</em>4&#x3D;12$，但是12在遇到2的时候已经被筛掉了，这是一个重复操作。</p><p>实际上，假设一个合数X有N个不同的素约数，那么他就会被筛掉N次，那么如何才能避免这样的重复操作呢？</p><p>我们先说明欧拉筛的算法，然后再说明欧拉筛是如何避免重复筛选的。</p><p>准备一个标记数组isPrime，长度是n+1，和一个素数列表primeList，刚开始标记数组都初始化为true，认为从$[2,n]$都是素数；</p><ol><li><p>对$[2,n]$中的每一个数字x，如果isPrime[x]是true，即x是素数，那么把这个数加入primeList；</p></li><li><p>遍历已经得到的primeList，对于其中的任何一个数字p；</p><ul><li>如果$p<em>x &gt; n$，退出遍历；否则设置isPrime[$p</em>x$] &#x3D; false;</li><li>如果x能被p整除，那么退出遍历；</li></ul></li></ol><p>最后primeList中的数就是结果；</p><blockquote><p>证明：</p><ol><li>对于任何一个合数X，都可以分解成$X &#x3D; p_{xmin} * B$，其中$p_{xmin}$是$X$的最小素约数，也正是因为是最小素约数，所以B的最小素约数$p_{bmin}$，不会超过$p_{xmin}$（这是因为B是X的一个约数，如果B的最小素约数比$p_{xmin}$还小，那么$p_{xmin}$就不是X的最小素约数了，因此和假设矛盾），而且显然的，B&lt;X，$p_{xmin}&lt;&#x3D;B$，因此B比X先被外层循环遍历到，$p_{xmin}$比B先被遍历到，当遍历到B的时候，$p_{xmin}$已经被处理过了，因此在遍历到B进入内层循环的时候，$p_{xmin}$已经在素数列表中了，又因为B的最小素约数不小于$p_{xmin}$，因此在内循环中，遍历到素数$p_{bmin}$的时候。一定可以遍历到$p_{xmin}$，因此isPrime[X]一定会被设置为false；因此这个方法可以保证任何一个合数都能被筛掉；</li><li>那么合数X没有可能被X的其他素约数筛掉呢？不可能。假设X还有另一个素约数$p_{xother}$，那么就有$X&#x3D;p_{xmin}*B&#x3D;p_{xother}*C$成立，即$C&#x3D;p_{xmin}*\frac{B}{p_{xother}}$成立，因为C是个整数，因此$\frac{B}{p_{xother}}$也是整数，此时$p_{xmin}$就是$C$的素约数；因此当最外层循环遍历到$C$的时候，内层循环是从小到大遍历已经得到的素数表的，因此一定会先遇到$p_{xmin}$，而此时$p_{xmin}$是$C$的素约数，因此内层循环直接退出，B没有机会和$p_{xother}$结合再次筛掉X。</li></ol><p>因此一个合数X一定且只会被他的最小素约数筛掉，如果他没有被之前的素数筛掉，那么X就是一个素数。</p><p>证明参考：<a href="https://blog.csdn.net/qaqwqaqwq/article/details/123587336">https://blog.csdn.net/qaqwqaqwq/article/details/123587336</a></p></blockquote><h2 id="4-2-代码"><a href="#4-2-代码" class="headerlink" title="4.2. 代码"></a>4.2. 代码</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GetPrimeNumsEuler</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> List&lt;Integer&gt; <span class="title function_">getPrimeNums</span><span class="params">(<span class="type">int</span> n)</span> &#123;</span><br><span class="line">        List&lt;Integer&gt; ans = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">if</span>(n == <span class="number">1</span>) <span class="keyword">return</span> ans;</span><br><span class="line">        <span class="type">boolean</span>[] notPrime = <span class="keyword">new</span> <span class="title class_">boolean</span>[n + <span class="number">1</span>];</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">2</span>; i &lt;= n; ++i) &#123;</span><br><span class="line">            <span class="keyword">if</span>(!notPrime[i]) ans.add(i);<span class="comment">// 如果i是素数，就加入素数列表</span></span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>, limit = ans.size(); j &lt; limit &amp;&amp; (<span class="type">long</span>)i * ans.get(j) &lt;= n; ++j) &#123;</span><br><span class="line">                notPrime[i * ans.get(j)] = <span class="literal">true</span>;</span><br><span class="line">                <span class="keyword">if</span>(i % ans.get(j) == <span class="number">0</span>) <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ans;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>一因为一个合数最多只会被筛掉1次，n个数中合数的个数不会超过n，因此12行代码执行最多不会超过n次，因此时间复杂度$O(N)$，空间复杂度$O(N)$。</p><h1 id="5-测试程序"><a href="#5-测试程序" class="headerlink" title="5. 测试程序"></a>5. 测试程序</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GetPrimeNumsTest</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt;= <span class="number">100_0000</span>; ++i) &#123;</span><br><span class="line">            <span class="type">long</span> <span class="variable">start</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">            List&lt;Integer&gt; ans = GetPrimeNums.getPrimeNums(i);</span><br><span class="line">            <span class="type">long</span> <span class="variable">ansTimeCost</span> <span class="operator">=</span> System.currentTimeMillis() - start;</span><br><span class="line">            start = System.currentTimeMillis();</span><br><span class="line">            List&lt;Integer&gt; ans2 = GetPrimeNumsEratosthenes.getPrimeNums(i);</span><br><span class="line">            <span class="type">long</span> <span class="variable">ans2TimeCost</span> <span class="operator">=</span> System.currentTimeMillis() - start;</span><br><span class="line">            start = System.currentTimeMillis();</span><br><span class="line">            List&lt;Integer&gt; ans3 = GetPrimeNumsEuler.getPrimeNums(i);</span><br><span class="line">            <span class="type">long</span> <span class="variable">ans3TimeCost</span> <span class="operator">=</span> System.currentTimeMillis() - start;</span><br><span class="line">            System.out.println(<span class="string">&quot;i is: &quot;</span> + i + <span class="string">&quot;, GetPrimeNums method time cost: &quot;</span> + ansTimeCost + <span class="string">&quot;ms, GetPrimeNumsEratosthenes method time cost: &quot;</span> + ans2TimeCost + <span class="string">&quot;ms, GetPrimeNumsEuler method time cost： &quot;</span> + ans3TimeCost + <span class="string">&quot;ms&quot;</span>);</span><br><span class="line">            <span class="keyword">if</span>(ans.size() != ans2.size() || ans.size() != ans3.size()) &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;answer size is not equal! ans size is: &quot;</span> + ans.size() + <span class="string">&quot;, ans2 size is: &quot;</span> + ans2.size() + <span class="string">&quot;ans3 size is: &quot;</span> + ans3.size() + <span class="string">&quot;, i is: &quot;</span> + i);</span><br><span class="line">                System.out.println(<span class="string">&quot;Oops!!&quot;</span>);</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>, limit = ans.size(); j &lt; limit; ++j) &#123;</span><br><span class="line">                <span class="keyword">if</span>(!ans.get(j).equals(ans2.get(j)) || !ans.get(j).equals(ans3.get(j))) &#123;</span><br><span class="line">                    System.out.println(<span class="string">&quot;Not equals!, j is: &quot;</span> + j + <span class="string">&quot;, ans[&quot;</span> + j + <span class="string">&quot;] is: &quot;</span> + ans.get(j) + <span class="string">&quot;, ans2[&quot;</span> + j + <span class="string">&quot;] is: &quot;</span> + ans2.get(j) + <span class="string">&quot;, ans3[&quot;</span> + j + <span class="string">&quot;] is: &quot;</span> + ans3.get(j));</span><br><span class="line">                    System.out.println(<span class="string">&quot;Oops!!&quot;</span>);</span><br><span class="line">                    <span class="keyword">return</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">&quot;Done successfully !!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="6-相关阅读"><a href="#6-相关阅读" class="headerlink" title="6. 相关阅读"></a>6. 相关阅读</h1><p><a href="https://blog.csdn.net/m0_54123999/article/details/126103903">https://blog.csdn.net/m0_54123999/article/details/126103903</a></p><p><a href="https://zhuanlan.zhihu.com/p/385530517">https://zhuanlan.zhihu.com/p/385530517</a></p><p><a href="https://blog.csdn.net/Gavin_Nicholas/article/details/88974079">https://blog.csdn.net/Gavin_Nicholas/article/details/88974079</a></p>]]></content>
      
      
      <categories>
          
          <category> 算法 </category>
          
          <category> 问题 </category>
          
          <category> 数学相关 </category>
          
          <category> 素数 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 数学 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>素数判断</title>
      <link href="/2022/10/20/judgePrimeNum/"/>
      <url>/2022/10/20/judgePrimeNum/</url>
      
        <content type="html"><![CDATA[<!-- toc --><p>给定一个正整数n，判断它是不是素数。</p><h1 id="1-算法分析"><a href="#1-算法分析" class="headerlink" title="1. 算法分析"></a>1. 算法分析</h1><ol><li><p>如果n是1，返回false；</p></li><li><p>否则，从2到$\lfloor\sqrt{n}\rfloor$，逐个尝试，如果能被整除，那么返回false</p><blockquote><p>按照定义我们是要枚举$[2,n-1]$之间的所有的数字，如果都没有找到一个可以证除n的数，那么n是素数。</p><p>因为一个数的约数a，b是成对存在的，且一定有一个不超过$\lfloor\sqrt{n}\rfloor$，有一个不小于$\lfloor\sqrt{n}\rfloor$，那么我们只需要在$[2,\lfloor\sqrt{n}\rfloor]$这个区间寻找就可以了，如果没有发现一个可以整除n的数，那么n就是素数。</p></blockquote></li><li><p>返回true</p></li></ol><h1 id="2-代码"><a href="#2-代码" class="headerlink" title="2. 代码"></a>2. 代码</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JudgePrimeNum</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">boolean</span> <span class="title function_">isPrime</span><span class="params">(<span class="type">int</span> n)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(n == <span class="number">1</span>) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">2</span>, limit = (<span class="type">int</span>)Math.sqrt(n); i &lt;= limit; ++i) &#123;</span><br><span class="line">            <span class="keyword">if</span>(n % i == <span class="number">0</span>) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        System.out.println(isPrime(<span class="number">1</span>));<span class="comment">// false</span></span><br><span class="line">        System.out.println(isPrime(<span class="number">2</span>));<span class="comment">// true</span></span><br><span class="line">        System.out.println(isPrime(<span class="number">3</span>));<span class="comment">// true</span></span><br><span class="line">        System.out.println(isPrime(<span class="number">4</span>));<span class="comment">// false</span></span><br><span class="line">        System.out.println(isPrime(<span class="number">7</span>));<span class="comment">// true</span></span><br><span class="line">        System.out.println(isPrime(<span class="number">91</span>));<span class="comment">// false 13 * 7</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>时间复杂度$O(\sqrt{N})$</p><h1 id="3-进一步优化"><a href="#3-进一步优化" class="headerlink" title="3. 进一步优化"></a>3. 进一步优化</h1><p>可以先怕判断一下n是不是偶数，否则，我们可以只枚举奇数因子，降低常数时间。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JudgePrimeNum2</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">boolean</span> <span class="title function_">isPrime</span><span class="params">(<span class="type">int</span> n)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(n &lt;= <span class="number">2</span>) <span class="keyword">return</span> n == <span class="number">2</span>;</span><br><span class="line">        <span class="keyword">if</span>((n &amp; <span class="number">1</span>) == <span class="number">0</span>) <span class="keyword">return</span> <span class="literal">false</span>;<span class="comment">// 排除偶数</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">3</span>, limit = (<span class="type">int</span>)Math.sqrt(n); i &lt;= limit; i += <span class="number">2</span>) &#123;<span class="comment">// 只枚举奇数因子</span></span><br><span class="line">            <span class="keyword">if</span>(n % i == <span class="number">0</span>) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="4-再次优化"><a href="#4-再次优化" class="headerlink" title="4. 再次优化"></a>4. 再次优化</h1><p>有一个性质，大于3的素数，一定可以写成$6k-1$和$6k+1$的形式（k&gt;&#x3D;1），即大于3的素数，都和6的倍数紧邻。且这样的素数的约数，只有可能是$6k-1$和$6k+1$的形式。</p><blockquote><p>这是因为$6k+2$，$6k+3$，$6k+4$都是合数，只有$6k+1$，$6k+5 &#x3D; 6k-1$有可能是素数。因此如果一个数是素数，那么一定是写成$6k-1$和$6k+1$的形式（k&gt;&#x3D;1）。</p><p>除了2的素数，都是奇数，因此大于3的素数，他们也只能是奇数，因此他们不可能被形如$6k+2$，$6k+4$这样的数整除，因为$6k+2$，$6k+4$都是偶数。</p><p>那么$6k+1$能否被$6k+3$整除呢？不可能，这是因为，如果$6k+1$能被$6k+3$整除的话，那么一定有$6k+1 &#x3D; p(6m+3)$p是正整数成立，即$6k+1 &#x3D; 3p(2m+1)$成立，那么$6k+1$可以被3整除。但实际上很显然，$6k+1$是不可能被3整除的，$6k-1$也是如此。</p><p>那么能整除大于3的素数的，只有可能是$6k-1$和$6k+1$的形式的数了。</p><p>参考文章：<a href="https://blog.csdn.net/weixin_41423494/article/details/84200612">https://blog.csdn.net/weixin_41423494/article/details/84200612</a></p></blockquote><p>所以对于素数2和3我们只需特殊判断一下，对于大于3的素数，我们只需枚举其形如$6k-1$和$6k+1$的约数即可，如果只要有一个可以整除，那么不是素数。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JudgePrimeNum3</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">boolean</span> <span class="title function_">isPrime</span><span class="params">(<span class="type">int</span> n)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(n &lt;= <span class="number">3</span>) <span class="keyword">return</span> n != <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span>(n % <span class="number">6</span> != <span class="number">1</span> &amp;&amp; n % <span class="number">6</span> != <span class="number">5</span>) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">5</span>, limit = (<span class="type">int</span>)Math.sqrt(n); i &lt;= limit; i += <span class="number">6</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span>(n % i == <span class="number">0</span> || n % (i + <span class="number">2</span>) == <span class="number">0</span>) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="5-测试程序"><a href="#5-测试程序" class="headerlink" title="5. 测试程序"></a>5. 测试程序</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JudgePrimeNumTest</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">testTimes</span> <span class="operator">=</span> <span class="number">100_0000</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; testTimes; ++i) &#123;</span><br><span class="line">            <span class="type">boolean</span> <span class="variable">ans</span> <span class="operator">=</span> JudgePrimeNum.isPrime(i);</span><br><span class="line">            <span class="type">boolean</span> <span class="variable">ans2</span> <span class="operator">=</span> JudgePrimeNum2.isPrime(i);</span><br><span class="line">            <span class="type">boolean</span> <span class="variable">ans3</span> <span class="operator">=</span> JudgePrimeNum3.isPrime(i);</span><br><span class="line">            <span class="keyword">if</span>((ans ^ ans2) || (ans ^ ans3)) &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;Oops! i is: &quot;</span> + i + <span class="string">&quot;, ans :&quot;</span> + ans + <span class="string">&quot;, ans2: &quot;</span> + ans2 + <span class="string">&quot;, ans3: &quot;</span> + ans3);</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">&quot;Done successfully!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 算法 </category>
          
          <category> 问题 </category>
          
          <category> 数学相关 </category>
          
          <category> 素数 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 数学 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>出现最频繁的K个单词</title>
      <link href="/2022/10/19/TopKFrequentWords/"/>
      <url>/2022/10/19/TopKFrequentWords/</url>
      
        <content type="html"><![CDATA[<!-- toc --><h1 id="1-问题描述"><a href="#1-问题描述" class="headerlink" title="1. 问题描述"></a>1. 问题描述</h1><p>给定一个单词流，单词个数未知的。现在需要设计一种结构，它可以接收一个单词，也可以返回到目前为止，出现次数最多的K个单词。用户会在某些时候要求查询出现次数最多的K个单词，按照出现次数升序，字典序降序的顺序输出。</p><p>K通过构造方法传入，K&gt;0</p><p>测评链接：<a href="https://www.lintcode.com/problem/550/">https://www.lintcode.com/problem/550/</a></p><h1 id="2-暴力解法"><a href="#2-暴力解法" class="headerlink" title="2. 暴力解法"></a>2. 暴力解法</h1><h2 id="2-1-算法分析"><a href="#2-1-算法分析" class="headerlink" title="2.1. 算法分析"></a>2.1. 算法分析</h2><ol><li>使用list存储每一个单词及其出现次数</li><li>使用哈希表存储每一个单词内容和单词本身的映射。</li><li>对于每次添加的操作，先在哈希表中查找是否存在单词，如果存在则获取其引用，增加其出现从次数，如果不存在，则新建一个单词的引用，出现次数是1，添加到list和哈希表。</li><li>对于每次获取topk操作，先对list按照出现次数从大到小，字典序从大到小排序，取前K个单词即可。</li></ol><h2 id="2-2-代码"><a href="#2-2-代码" class="headerlink" title="2.2. 代码"></a>2.2. 代码</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">KFrequentWords</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">int</span> k;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> ArrayList&lt;WordInfo&gt; data;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> HashMap&lt;String,WordInfo&gt; wordMap;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Comparator&lt;WordInfo&gt; cmp = (a,b) -&gt; a.cnt != b.cnt ? b.cnt - a.cnt : b.word.compareTo(a.word); </span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">KFrequentWords</span><span class="params">(<span class="type">int</span> k)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.k = k;</span><br><span class="line">        data = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        wordMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">add</span><span class="params">(String word)</span> &#123;</span><br><span class="line">        <span class="type">WordInfo</span> <span class="variable">wi</span> <span class="operator">=</span> wordMap.get(word);</span><br><span class="line">        <span class="keyword">if</span>(wi == <span class="literal">null</span>) &#123;</span><br><span class="line">            wi = <span class="keyword">new</span> <span class="title class_">WordInfo</span>(word);</span><br><span class="line">            wordMap.put(word,wi);</span><br><span class="line">            data.add(wi);</span><br><span class="line">        &#125;<span class="keyword">else</span> ++wi.cnt;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> List&lt;String&gt; <span class="title function_">getTopKWords</span><span class="params">()</span> &#123;</span><br><span class="line">        data.sort(cmp);</span><br><span class="line">        <span class="type">int</span> <span class="variable">end</span> <span class="operator">=</span> Math.min(k,data.size()) - <span class="number">1</span>;</span><br><span class="line">        List&lt;String&gt; ans = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;(end + <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt;= end; ++i)</span><br><span class="line">            ans.add(data.get(i).word);</span><br><span class="line">        <span class="keyword">return</span> ans;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">WordInfo</span> &#123;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">private</span> <span class="type">int</span> cnt;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">private</span> String word;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">public</span> <span class="title function_">WordInfo</span><span class="params">(String word)</span> &#123;</span><br><span class="line">            cnt = <span class="number">1</span>;</span><br><span class="line">            <span class="built_in">this</span>.word = word;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">KFrequentWords</span> <span class="variable">kfw</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">KFrequentWords</span>(<span class="number">3</span>);</span><br><span class="line">        kfw.add(<span class="string">&quot;hello&quot;</span>);</span><br><span class="line">        kfw.add(<span class="string">&quot;yes&quot;</span>);</span><br><span class="line">        kfw.add(<span class="string">&quot;C++&quot;</span>);</span><br><span class="line">        System.out.println(kfw.getTopKWords());<span class="comment">// yes,hello,C++</span></span><br><span class="line">        kfw.add(<span class="string">&quot;yes&quot;</span>);</span><br><span class="line">        kfw.add(<span class="string">&quot;yes&quot;</span>);</span><br><span class="line">        kfw.add(<span class="string">&quot;yes&quot;</span>);</span><br><span class="line">        System.out.println(kfw.getTopKWords());<span class="comment">// yes,hello,C++</span></span><br><span class="line">        kfw.add(<span class="string">&quot;C++&quot;</span>);</span><br><span class="line">        kfw.add(<span class="string">&quot;C++&quot;</span>);</span><br><span class="line">        kfw.add(<span class="string">&quot;C++&quot;</span>);</span><br><span class="line">        System.out.println(kfw.getTopKWords());<span class="comment">// yes,C++,hello</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="3-最优解"><a href="#3-最优解" class="headerlink" title="3. 最优解"></a>3. 最优解</h1><h2 id="3-1-算法分析"><a href="#3-1-算法分析" class="headerlink" title="3.1. 算法分析"></a>3.1. 算法分析</h2><ol><li><p>还是使用哈希表存储每一个单词内容和其本身的映射；</p></li><li><p>使用一个长度为K的小根堆结构，维护出现次数最多且字典序最大的K个单词；还需要一个哈希表，告诉一个元素是否在堆上；</p></li><li><p>当新来一个单词的时候，如果不在map中那么新建出来，加入map，否则当前单词的出现次数++；</p><ul><li>如果当前单词在堆上，那么调整堆（此时只需要heapify，因为出现次数增加，又是小根堆）</li><li>如果当前单词不在堆上，<ul><li>如果堆size没有达到K，那么加入堆中，调整堆（heapInsert），</li><li>如果堆size达到K，然后看看它能否替换堆顶，如果可以则替换堆顶，调整堆</li></ul></li></ul></li><li><p>当需要获取topK的时候，只需要取出堆中的所有元素，排序即可。</p></li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">KFrequentWords2</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">int</span> k;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> WordInfo[] heap, help;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> HashMap&lt;String,WordInfo&gt; wordMap;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> HashMap&lt;WordInfo,Integer&gt; indexMap;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> size;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Comparator&lt;WordInfo&gt; heapCmp = (a,b) -&gt; a.cnt != b.cnt ? a.cnt - b.cnt : a.word.compareTo(b.word);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Comparator&lt;WordInfo&gt; sortCmp = (a,b) -&gt; a.cnt != b.cnt ? b.cnt - a.cnt : b.word.compareTo(a.word);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">KFrequentWords2</span><span class="params">(<span class="type">int</span> k)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.k = k;</span><br><span class="line">        heap = <span class="keyword">new</span> <span class="title class_">WordInfo</span>[k];</span><br><span class="line">        help = <span class="keyword">new</span> <span class="title class_">WordInfo</span>[k];</span><br><span class="line">        wordMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        indexMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">add</span><span class="params">(String word)</span> &#123;</span><br><span class="line">        <span class="type">WordInfo</span> <span class="variable">wi</span> <span class="operator">=</span> wordMap.get(word);</span><br><span class="line">        <span class="keyword">if</span>(wi == <span class="literal">null</span>) &#123;<span class="comment">// 不在Map则新建</span></span><br><span class="line">            wi = <span class="keyword">new</span> <span class="title class_">WordInfo</span>(word);</span><br><span class="line">            wordMap.put(word,wi);</span><br><span class="line">        &#125;<span class="keyword">else</span> ++wi.cnt;</span><br><span class="line">        <span class="type">Integer</span> <span class="variable">index</span> <span class="operator">=</span> indexMap.get(wi);</span><br><span class="line">        <span class="keyword">if</span>(index == <span class="literal">null</span>) &#123;<span class="comment">// 不在堆上</span></span><br><span class="line">            <span class="keyword">if</span>(size &lt; k) &#123;<span class="comment">// 堆不满，则放入堆中</span></span><br><span class="line">                heap[size] = wi;</span><br><span class="line">                indexMap.put(wi,size);</span><br><span class="line">                heapInsert(size++);</span><br><span class="line">            &#125;<span class="keyword">else</span> &#123;<span class="comment">// 堆满，则看看能否替换堆顶</span></span><br><span class="line">                <span class="keyword">if</span>(heapCmp.compare(heap[<span class="number">0</span>],wi) &lt; <span class="number">0</span>) &#123;</span><br><span class="line">                    indexMap.put(wi,<span class="number">0</span>);</span><br><span class="line">                    indexMap.remove(heap[<span class="number">0</span>]);</span><br><span class="line">                    heap[<span class="number">0</span>] = wi;</span><br><span class="line">                    heapIfy(<span class="number">0</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;<span class="keyword">else</span> heapIfy(index); <span class="comment">// 在堆上，则调整堆</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> List&lt;String&gt; <span class="title function_">getTopKWords</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">len</span> <span class="operator">=</span> Math.min(k,size);</span><br><span class="line">        List&lt;String&gt; ans = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;(len);</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; len; ++i) help[i] = heap[i];</span><br><span class="line">        Arrays.sort(help,<span class="number">0</span>,len,sortCmp);</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; len; ++i) ans.add(help[i].word);</span><br><span class="line">        <span class="keyword">return</span> ans;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">heapInsert</span><span class="params">(<span class="type">int</span> index)</span> &#123;</span><br><span class="line">        <span class="type">int</span> parent;</span><br><span class="line">        <span class="keyword">while</span>(heapCmp.compare(heap[index],heap[parent = (index - <span class="number">1</span>) / <span class="number">2</span>]) &lt; <span class="number">0</span>) &#123;</span><br><span class="line">            swap(index,parent);</span><br><span class="line">            index = parent;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">heapIfy</span><span class="params">(<span class="type">int</span> index)</span> &#123;</span><br><span class="line">        <span class="type">int</span> child, bnd = size &gt;&gt; <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span>(index &lt; bnd) &#123;</span><br><span class="line">            child = (index &lt;&lt; <span class="number">1</span>) | <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">if</span>(child + <span class="number">1</span> &lt; size &amp;&amp; heapCmp.compare(heap[child],heap[child+<span class="number">1</span>]) &gt; <span class="number">0</span>) ++child;</span><br><span class="line">            <span class="keyword">if</span>(heapCmp.compare(heap[index],heap[child]) &lt;= <span class="number">0</span>) <span class="keyword">break</span>;</span><br><span class="line">            swap(index,child);</span><br><span class="line">            index = child;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">              </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">swap</span><span class="params">(<span class="type">int</span> i, <span class="type">int</span> j)</span> &#123;</span><br><span class="line">        <span class="type">WordInfo</span> <span class="variable">wi</span> <span class="operator">=</span> heap[i], wj = heap[j];</span><br><span class="line">        indexMap.put(wi,j);</span><br><span class="line">        indexMap.put(wj,i);</span><br><span class="line">        heap[i] = wj;</span><br><span class="line">        heap[j] = wi;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">WordInfo</span> &#123;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">private</span> String word;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">private</span> <span class="type">int</span> cnt;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">public</span> <span class="title function_">WordInfo</span><span class="params">(String word)</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.word = word;</span><br><span class="line">            cnt = <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">              </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">KFrequentWords2</span> <span class="variable">kfw</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">KFrequentWords2</span>(<span class="number">3</span>);</span><br><span class="line">        kfw.add(<span class="string">&quot;hello&quot;</span>);</span><br><span class="line">        kfw.add(<span class="string">&quot;yes&quot;</span>);</span><br><span class="line">        kfw.add(<span class="string">&quot;C++&quot;</span>);</span><br><span class="line">        System.out.println(kfw.getTopKWords());<span class="comment">// yes,hello,C++</span></span><br><span class="line">        kfw.add(<span class="string">&quot;yes&quot;</span>);</span><br><span class="line">        kfw.add(<span class="string">&quot;yes&quot;</span>);</span><br><span class="line">        kfw.add(<span class="string">&quot;yes&quot;</span>);</span><br><span class="line">        System.out.println(kfw.getTopKWords());<span class="comment">// yes,hello,C++</span></span><br><span class="line">        kfw.add(<span class="string">&quot;C++&quot;</span>);</span><br><span class="line">        kfw.add(<span class="string">&quot;C++&quot;</span>);</span><br><span class="line">        kfw.add(<span class="string">&quot;C++&quot;</span>);</span><br><span class="line">        System.out.println(kfw.getTopKWords());<span class="comment">// yes,C++,hello</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="4-测试程序"><a href="#4-测试程序" class="headerlink" title="4. 测试程序"></a>4. 测试程序</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">KFrequentWordsTest</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">testTimes</span> <span class="operator">=</span> <span class="number">100_0000</span>, maxWordCnt = <span class="number">20</span>,maxK = <span class="number">5</span>;</span><br><span class="line">        <span class="keyword">while</span>(testTimes-- &gt; <span class="number">0</span>) &#123;<span class="comment">// 测试testTimes次</span></span><br><span class="line">            <span class="type">Random</span> <span class="variable">r</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Random</span>();</span><br><span class="line">            <span class="type">int</span> <span class="variable">k</span> <span class="operator">=</span> r.nextInt(maxK) + <span class="number">1</span>;</span><br><span class="line">            <span class="type">int</span> <span class="variable">wc</span> <span class="operator">=</span> r.nextInt(maxWordCnt) + <span class="number">1</span>;</span><br><span class="line">            String[] words = <span class="keyword">new</span> <span class="title class_">String</span>[wc];</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; wc; ++i) words[i] = getWord(r);<span class="comment">// 生成wc个单词</span></span><br><span class="line">            <span class="type">KFrequentWords2</span> <span class="variable">kfw2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">KFrequentWords2</span>(k);</span><br><span class="line">            <span class="type">KFrequentWords</span> <span class="variable">kfw</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">KFrequentWords</span>(k);</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; wc; ++i) &#123;</span><br><span class="line">                kfw2.add(words[i]);</span><br><span class="line">                kfw.add(words[i]);</span><br><span class="line">                <span class="keyword">if</span>(r.nextInt(<span class="number">2</span>) == <span class="number">0</span>) &#123;<span class="comment">// 一半的概率获取topK</span></span><br><span class="line">                    List&lt;String&gt; ans2 = kfw2.getTopKWords(), ans =  kfw.getTopKWords();</span><br><span class="line">                    <span class="keyword">if</span>(ans2.size() != ans.size()) &#123;</span><br><span class="line">                        System.out.println(<span class="string">&quot;Oops!! ans2.size:&quot;</span> + ans2.size() + <span class="string">&quot; ans.size:&quot;</span> + ans.size());</span><br><span class="line">                        System.out.println(<span class="string">&quot;All words:&quot;</span>);</span><br><span class="line">                        <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; j &lt; wc; ++j) &#123;</span><br><span class="line">                            System.out.print(words[j]);</span><br><span class="line">                            System.out.print(<span class="string">&quot; &quot;</span>);</span><br><span class="line">                        &#125;</span><br><span class="line">                        System.out.println();</span><br><span class="line">                        System.out.println(<span class="string">&quot;ans2:&quot;</span>);</span><br><span class="line">                        <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; j &lt; ans2.size(); ++j) &#123;</span><br><span class="line">                            System.out.print(ans2.get(j));</span><br><span class="line">                            System.out.print(<span class="string">&quot; &quot;</span>);</span><br><span class="line">                        &#125;</span><br><span class="line">                        System.out.println();</span><br><span class="line">                        System.out.println(<span class="string">&quot;ans:&quot;</span>);</span><br><span class="line">                        <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; j &lt; ans.size(); ++j) &#123;</span><br><span class="line">                            System.out.print(ans.get(j));</span><br><span class="line">                            System.out.print(<span class="string">&quot; &quot;</span>);</span><br><span class="line">                        &#125;</span><br><span class="line">                        System.out.println();</span><br><span class="line">                        <span class="keyword">return</span>;</span><br><span class="line">                    &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">                        <span class="type">int</span> <span class="variable">ansSize</span> <span class="operator">=</span> ans.size();</span><br><span class="line">                        <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">kk</span> <span class="operator">=</span> <span class="number">0</span>; kk &lt; ansSize; ++kk) &#123;</span><br><span class="line">                            <span class="keyword">if</span>(!ans.get(kk).equals(ans2.get(kk))) &#123;</span><br><span class="line">                                System.out.println(<span class="string">&quot;Oops!! Not equals at:&quot;</span> + kk + <span class="string">&quot;ans[&quot;</span> + kk +<span class="string">&quot;]:&quot;</span> + ans.get(kk) + <span class="string">&quot;, ans2[&quot;</span> + kk + <span class="string">&quot;]:&quot;</span> + ans2.get(kk));</span><br><span class="line">                                </span><br><span class="line">                                System.out.println(<span class="string">&quot;All words:&quot;</span>);</span><br><span class="line">                        <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; j &lt; wc; ++j) &#123;</span><br><span class="line">                            System.out.print(words[j]);</span><br><span class="line">                            System.out.print(<span class="string">&quot; &quot;</span>);</span><br><span class="line">                        &#125;</span><br><span class="line">                        System.out.println();</span><br><span class="line">                        System.out.println(<span class="string">&quot;ans2:&quot;</span>);</span><br><span class="line">                        <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; j &lt; ans2.size(); ++j) &#123;</span><br><span class="line">                            System.out.print(ans2.get(j));</span><br><span class="line">                            System.out.print(<span class="string">&quot; &quot;</span>);</span><br><span class="line">                        &#125;</span><br><span class="line">                        System.out.println();</span><br><span class="line">                        System.out.println(<span class="string">&quot;ans:&quot;</span>);</span><br><span class="line">                        <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; j &lt; ans.size(); ++j) &#123;</span><br><span class="line">                            System.out.print(ans.get(j));</span><br><span class="line">                            System.out.print(<span class="string">&quot; &quot;</span>);</span><br><span class="line">                        &#125;</span><br><span class="line">                        System.out.println();</span><br><span class="line">                        <span class="keyword">return</span>;</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">&quot;Done successfully!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String <span class="title function_">getWord</span><span class="params">(Random r)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">len</span> <span class="operator">=</span> r.nextInt(<span class="number">20</span>) + <span class="number">1</span>;</span><br><span class="line">        <span class="type">StringBuilder</span> <span class="variable">sb</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; len; ++i) sb.append((<span class="type">char</span>)(<span class="string">&#x27;a&#x27;</span>+r.nextInt(<span class="number">26</span>)));</span><br><span class="line">        <span class="keyword">return</span> sb.toString();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 算法 </category>
          
          <category> 问题 </category>
          
          <category> 堆相关 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 堆 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>最大线段重合问题</title>
      <link href="/2022/10/16/MaxLineCoincide/"/>
      <url>/2022/10/16/MaxLineCoincide/</url>
      
        <content type="html"><![CDATA[<!-- toc --><h1 id="1-问题描述"><a href="#1-问题描述" class="headerlink" title="1. 问题描述"></a>1. 问题描述</h1><p>给定一些整数对（a，b）代表数轴上的两个点，且a&lt;&#x3D;b，这两个点表示一个线段。请返回最多几个线段重叠在一起。</p><p>例如：</p><ol><li>[[1,3],[2,5],[7,9]]，因为[1,3]和[2,5]重叠在一起，返回2；</li><li>[[1,2],[2,3]]，返回2；</li><li>[[1,2],[2,3],[1,3]]，返回3</li><li>[[1,2]]，返回1</li></ol><p>数组长度至少是1，不超过100_0000；</p><h1 id="2-暴力解法"><a href="#2-暴力解法" class="headerlink" title="2. 暴力解法"></a>2. 暴力解法</h1><h2 id="2-1-算法分析"><a href="#2-1-算法分析" class="headerlink" title="2.1. 算法分析"></a>2.1. 算法分析</h2><p>我们可以用笔画几条线段发现，任何重叠的部分的左端点，都是某一个线段的左端点。比如[1,3]，和[2,4]重叠的部分是[2,3]，其中2就是第二个线段的左端点；又比如：[1,5]，[3,7]，[4,6]，重叠的部分是[4,5]，其中4就是[4,6]的左端点。既然任何一个重叠的部分都满足这个性质，那么重叠线段最多的那一部分，也满足。</p><p>因此我们只需要看一下，哪个左端点下经过的线段数目最多即可。</p><p>因此我们可以枚举所有线段的左端点，对于每一个左端点，再次枚举有几条线段经过当前点，返回最大值。</p><p>线段[a,b]经过当前点x的充要条件是：a&lt;&#x3D;x&lt;&#x3D;b</p><h2 id="2-2-代码"><a href="#2-2-代码" class="headerlink" title="2.2. 代码"></a>2.2. 代码</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"> <span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MaxLineCoincide</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">maxLineCoincide</span><span class="params">(<span class="type">int</span>[][] lines)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">len</span> <span class="operator">=</span> lines.length;</span><br><span class="line">        <span class="keyword">if</span>(len == <span class="number">1</span>) <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">ans</span> <span class="operator">=</span> <span class="number">1</span>, t, leftPoint;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; len; ++i) &#123;</span><br><span class="line">            t=<span class="number">0</span>;</span><br><span class="line">            leftPoint = lines[i][<span class="number">0</span>];</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">0</span>; j&lt;len; ++j) &#123; </span><br><span class="line">                <span class="keyword">if</span>(lines[j][<span class="number">0</span>] &lt;= leftPoint &amp;&amp; leftPoint &lt;= lines[j][<span class="number">1</span>]) ++t;</span><br><span class="line">            &#125;</span><br><span class="line">            ans = Math.max(t,ans);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ans;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">int</span>[][] lines = &#123;</span><br><span class="line">                &#123;<span class="number">1</span>,<span class="number">3</span>&#125;,</span><br><span class="line">                &#123;<span class="number">3</span>,<span class="number">4</span>&#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        System.out.println(maxLineCoincide(lines));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>时间复杂度$O(N^2)$</p><h1 id="3-最优解"><a href="#3-最优解" class="headerlink" title="3. 最优解"></a>3. 最优解</h1><h2 id="3-1-算法分析"><a href="#3-1-算法分析" class="headerlink" title="3.1. 算法分析"></a>3.1. 算法分析</h2><p>上述的解答中，最耗时的部分在于对于每一个左端点，找有几条线段通过这个点？因为给定的线段列表是杂乱的，因此我们只能遍历去找，浪费了时间。</p><p>如果我们把所有的线段，按照左端点从小到大排序，那么我们在确定一个左端点有几条线段通过它的时候，就可以排除一些不必要的遍历。</p><p><strong><font color=red>即对于一个左端点leftx，能通过它的线段，只可能是左端点不超过leftx的线段，如果一个线段的左端点都超过了leftx，那么这个线段是不会通过leftx的。</font></strong></p><p>左端点不超过leftx的线段中，不都是满足条件的，只有那些右端点不小于leftx的线段，才是通过leftx的。因此我们还要知道这些线段的所有右端点信息，我们可以把这些线段的右端点都放在小跟堆中，不断从堆顶弹出一个右端点rightx，如果发现一个线段的右端点rightx，小于leftx，那么这个线段是不会计入leftx的答案的，当然在计算leftx的下一个（如果有的话）左端点nextLeftx的时候，更不会计入nextLeftx的答案，因此这个右端点rightx就丢弃了，直到某一个rightx不小于leftx的时候，因为是小跟堆，堆中所有的元素都是不小于leftx的，此时堆的size就是当前leftx的答案。</p><p>因此整体的算法如下：</p><ol><li>把所有的线段，按照左端点从小到大排序</li><li>设置一个小跟堆，遍历每一个线段，对于每一个线段line：<ul><li>把line的右端点rightx放入小跟堆；</li><li>只要堆顶元素小于当前线段的左端点leftx，则弹出</li><li>把堆此时的size作为子问题的答案，和全局答案pk</li></ul></li></ol><h2 id="3-2-代码"><a href="#3-2-代码" class="headerlink" title="3.2. 代码"></a>3.2. 代码</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MaxLineCoincide2</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">maxLineCoincide</span><span class="params">(<span class="type">int</span>[][] lines)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">len</span> <span class="operator">=</span> lines.length;</span><br><span class="line">        <span class="keyword">if</span>(len == <span class="number">1</span>) <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">ans</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">        Arrays.sort(lines,(a,b)-&gt;a[<span class="number">0</span>]-b[<span class="number">0</span>]);</span><br><span class="line">        PriorityQueue&lt;Integer&gt; q = <span class="keyword">new</span> <span class="title class_">PriorityQueue</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; len; ++i) &#123;</span><br><span class="line">            q.offer(lines[i][<span class="number">1</span>]);</span><br><span class="line">            <span class="keyword">while</span>(!q.isEmpty() &amp;&amp; q.peek() &lt; lines[i][<span class="number">0</span>]) q.poll();</span><br><span class="line">            ans = Math.max(ans,q.size());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ans;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">int</span>[][] lines = &#123;</span><br><span class="line">                &#123;<span class="number">1</span>,<span class="number">3</span>&#125;,</span><br><span class="line">                &#123;<span class="number">3</span>,<span class="number">4</span>&#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        System.out.println(maxLineCoincide(lines));</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>时间复杂度$O(N\log_2N)$</p><h1 id="4-测试程序"><a href="#4-测试程序" class="headerlink" title="4. 测试程序"></a>4. 测试程序</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MaxLineCoincideTest</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">testTimes</span> <span class="operator">=</span> <span class="number">100_0000</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">maxArraySize</span> <span class="operator">=</span> <span class="number">100</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">maxPoint</span> <span class="operator">=</span> <span class="number">10_0000</span>;</span><br><span class="line">        <span class="keyword">while</span>(testTimes-- &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="type">Random</span> <span class="variable">r</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Random</span>();</span><br><span class="line">            <span class="type">int</span> <span class="variable">size</span> <span class="operator">=</span> r.nextInt(maxArraySize) + <span class="number">1</span>;</span><br><span class="line">            <span class="type">int</span>[][] data = <span class="keyword">new</span> <span class="title class_">int</span>[size][<span class="number">2</span>], data2 = <span class="keyword">new</span> <span class="title class_">int</span>[size][<span class="number">2</span>];</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; size; ++i) &#123;</span><br><span class="line">                data[i][<span class="number">0</span>] = r.nextInt(maxPoint);</span><br><span class="line">                <span class="comment">//保证data[i][1]不小于data[i][0]</span></span><br><span class="line">                data[i][<span class="number">1</span>] = data[i][<span class="number">0</span>] + r.nextInt(Integer.MAX_VALUE - data[i][<span class="number">0</span>]);</span><br><span class="line">                data2[i][<span class="number">0</span>] = data[i][<span class="number">0</span>];</span><br><span class="line">                data2[i][<span class="number">1</span>] = data[i][<span class="number">1</span>];</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="type">int</span> <span class="variable">ans0</span> <span class="operator">=</span> MaxLineCoincide.maxLineCoincide(data);</span><br><span class="line">            <span class="type">int</span> <span class="variable">ans1</span> <span class="operator">=</span> MaxLineCoincide2.maxLineCoincide(data2);</span><br><span class="line">            <span class="keyword">if</span>(ans0 != ans1) &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;ans0: &quot;</span> + ans0 + <span class="string">&quot; ans1: &quot;</span> + ans1);</span><br><span class="line">                <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; size; ++i) &#123;</span><br><span class="line">                    System.out.println(Arrays.toString(data[i]));</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;Oops&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">&quot;Done successfully!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 算法 </category>
          
          <category> 问题 </category>
          
          <category> 堆相关 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 堆 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>抽奖系统问题</title>
      <link href="/2022/10/14/Lottery/"/>
      <url>/2022/10/14/Lottery/</url>
      
        <content type="html"><![CDATA[<!-- toc --><h1 id="1-问题描述"><a href="#1-问题描述" class="headerlink" title="1. 问题描述"></a>1. 问题描述</h1><p>有一个抽奖系统，规则如下：</p><p>给定两个整数数组，ids代表用户ID列表，ops代表操作，二者等长。对于每一个位置i，如果ops[i]=&#x3D;0，代表ID为ids[i]的用户退了一件货物，ops[i]&#x3D;&#x3D;1代表他购买了一件货物。有两个区域，一个是获奖区域，一个是候选区域，最多k个人获奖。</p><p>如果一个用户购买了一件货物，此时：</p><ul><li>如果获奖区域人数没满，且他没进入过获奖区域的话，那么他直接进入获奖区域，以前进入过就不做任何操作。</li><li>如果获奖区域的人数满了，那么如果他以前没进入过候选区域，则直接进入候选区域，以前进入过候选区域就不做任何操作。</li></ul><p>此时如果发现候选区域的某个人X的购买数量大于获奖区域的某个人（或者某些人）的购买数量的话，则候选区域这个人进入获奖区域，原来获奖区域的人被替换，进入候选区域。如果原来获奖区域多个人的购买数量都小于X的购买数量的话，则替换掉最先进入获奖区域的那个用户。</p><p>如果一个用户退了一件货物，此时：</p><ul><li>如果他的购买数量已经是0了，抽奖系统不允许购买数量是负数，因此跳过这种情况</li><li>如果用户只有最后一件货物了，退了以后，用户的购买数量就是0了， 那么不管他原来在那个区域，都退出原来的区域；</li></ul><p>如果他退了一件货物以后，发现获奖区域Y某个人购买数量已经小于候选区域某个人（或者某些人）的购买数量的话，则Y退出获奖区域进入候选区域，候选区域的人进入获奖区域，如果候选区域有多个人的购买数量都大于Y的购买数量的话，那么最早进入候选区域的那个用户进入获奖区域。</p><p>总结来说就是，一个抽奖系统，在获奖区域还没满的时候，只要购买数量大于0的用户，都可以直接进入获奖区域；获奖区域满了的话，购买数量大于0的用户则进入候选区域，每一次购买或者退货事件发生的时候，凭着购买数量多，且先到先得的原则，去更新获奖区域。</p><p>现在给定这两个数组，编写代码计算每一次购买退货事件发生的时候，获奖区域的用户ID列表。</p><p>ops[i]只有0和1两个值</p><p>ids[i]可以是任意整数。</p><p>k&gt;0</p><h1 id="2-暴力做法"><a href="#2-暴力做法" class="headerlink" title="2. 暴力做法"></a>2. 暴力做法</h1><h2 id="2-1-算法分析"><a href="#2-1-算法分析" class="headerlink" title="2.1. 算法分析"></a>2.1. 算法分析</h2><ol><li>使用一个结构保存用户的id，购买数量和进入每个区域的时刻；</li><li>使用哈希表记录每一个id的用户；</li><li>使用list保存获奖区域和候选区域的用户</li><li>每次事件发生的时候，如果还没有更新获奖区域，且候选区域还有人的情况下，按照购买数量升序，到达时间降序对候选区域进行排序，按照按照购买数量降序，到达时间降序对获奖区域排序，用候选区域的最后一个替换获奖区域的最后一个即可。</li><li>收集答案</li></ol><h2 id="2-2-代码"><a href="#2-2-代码" class="headerlink" title="2.2. 代码"></a>2.2. 代码</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LotteryGameMethod1</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> List&lt;List&lt;Integer&gt;&gt; <span class="title function_">getLotteryUidList</span><span class="params">(<span class="type">int</span>[] ids, <span class="type">int</span>[] ops, <span class="type">int</span> k)</span>&#123;</span><br><span class="line">        HashMap&lt;Integer,User&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();<span class="comment">// 这里保存的是购买数量大于0的id和用户的映射。</span></span><br><span class="line">        ArrayList&lt;User&gt; lotteryArea = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;(),</span><br><span class="line">                candidateArea = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="type">int</span> i;</span><br><span class="line">        Comparator&lt;User&gt; cntUpTimeDown = (a,b)-&gt; a.cnt!=b.cnt?a.cnt-b.cnt:b.time-a.time,</span><br><span class="line">                cntDownTimeDown = (a,b)-&gt;a.cnt!=b.cnt?b.cnt-a.cnt:b.time-a.time;</span><br><span class="line">        List&lt;List&lt;Integer&gt;&gt; ans = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;(ids.length);</span><br><span class="line">        <span class="keyword">for</span>(i=<span class="number">0</span>; i&lt;ids.length; ++i)&#123;</span><br><span class="line">            <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> map.get(ids[i]);</span><br><span class="line">            <span class="keyword">if</span>(!(user == <span class="literal">null</span> &amp;&amp; ops[i] == <span class="number">0</span>))&#123;</span><br><span class="line">                <span class="comment">// user == null 表示用户还没买过货物，或者用户买的货物都退了。此时如果还发生退货事件，那么不用理会了</span></span><br><span class="line">                <span class="keyword">if</span>(user == <span class="literal">null</span>) &#123;</span><br><span class="line">                    user = <span class="keyword">new</span> <span class="title class_">User</span>(ids[i],i);</span><br><span class="line">                    map.put(ids[i],user);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span>(ops[i] == <span class="number">0</span>)--user.cnt;</span><br><span class="line">                <span class="keyword">else</span> ++user.cnt;</span><br><span class="line">                <span class="keyword">if</span>(user.cnt == <span class="number">0</span>)&#123;</span><br><span class="line">                    map.remove(ids[i]);</span><br><span class="line">                    lotteryArea.remove(user);</span><br><span class="line">                    candidateArea.remove(user);</span><br><span class="line">                    <span class="keyword">if</span>(lotteryArea.size() &lt; k &amp;&amp; !candidateArea.isEmpty())&#123;</span><br><span class="line">                        <span class="comment">// 如果移除的是获奖区域的用户，且候选区域还有人的情况下，需要从候选区域选择一个最好的，放入获奖区域</span></span><br><span class="line">                        candidateArea.sort(cntUpTimeDown);</span><br><span class="line">                        <span class="type">User</span> <span class="variable">candidate</span> <span class="operator">=</span> candidateArea.remove(candidateArea.size() - <span class="number">1</span>);</span><br><span class="line">                        candidate.time = i;</span><br><span class="line">                        lotteryArea.add(candidate);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                    <span class="keyword">if</span>(lotteryArea.size() &lt; k)&#123;</span><br><span class="line">                        <span class="keyword">if</span>(!lotteryArea.contains(user)) lotteryArea.add(user);</span><br><span class="line">                    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                        <span class="keyword">if</span>(!candidateArea.contains(user) &amp;&amp; !lotteryArea.contains(user))&#123;</span><br><span class="line">                            <span class="comment">// 获奖区域已经满了。如果他既不在获奖区域也不在候选区域，那么加入候选区域</span></span><br><span class="line">                            candidateArea.add(user);</span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="comment">// 排序后，把候选区域购买数量最大的 且来的最早的 和 获奖区域购买数量最小的 且来的最早的，互换</span></span><br><span class="line">                        <span class="keyword">if</span>(!candidateArea.isEmpty())&#123;</span><br><span class="line">                            candidateArea.sort(cntUpTimeDown);</span><br><span class="line">                            lotteryArea.sort(cntDownTimeDown);</span><br><span class="line">                            <span class="type">User</span> <span class="variable">user1</span> <span class="operator">=</span> candidateArea.get(candidateArea.size() - <span class="number">1</span>);</span><br><span class="line">                            <span class="type">User</span> <span class="variable">user2</span> <span class="operator">=</span> lotteryArea.get(lotteryArea.size() - <span class="number">1</span>);</span><br><span class="line">                            <span class="keyword">if</span>(user1.cnt &gt; user2.cnt)&#123;</span><br><span class="line">                                user1.time = user2.time = i;</span><br><span class="line">                                candidateArea.set(candidateArea.size() - <span class="number">1</span>,user2);</span><br><span class="line">                                lotteryArea.set(lotteryArea.size()-<span class="number">1</span>,user1);</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            ArrayList&lt;Integer&gt; ansItem = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;(lotteryArea.size());</span><br><span class="line">            <span class="keyword">for</span> (User lotteryUser : lotteryArea) &#123;</span><br><span class="line">                ansItem.add(lotteryUser.id);</span><br><span class="line">            &#125;</span><br><span class="line">            ans.add(ansItem);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ans;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">int</span>[] ids = &#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">3</span>,<span class="number">2</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">7</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">2</span>&#125;,</span><br><span class="line">                ops=&#123;<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>&#125;;</span><br><span class="line">        <span class="type">int</span> <span class="variable">k</span> <span class="operator">=</span> <span class="number">2</span>;</span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">        1</span></span><br><span class="line"><span class="comment">        1,2</span></span><br><span class="line"><span class="comment">        1,2</span></span><br><span class="line"><span class="comment">        2,3</span></span><br><span class="line"><span class="comment">        2,3</span></span><br><span class="line"><span class="comment">        2,3</span></span><br><span class="line"><span class="comment">        2,3</span></span><br><span class="line"><span class="comment">        2,3</span></span><br><span class="line"><span class="comment">        2,3</span></span><br><span class="line"><span class="comment">        2,3</span></span><br><span class="line"><span class="comment">        2,3</span></span><br><span class="line"><span class="comment">        3,4</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">        * */</span></span><br><span class="line">        List&lt;List&lt;Integer&gt;&gt; lotteryUidList = getLotteryUidList(ids, ops, k);</span><br><span class="line">        <span class="keyword">for</span> (List&lt;Integer&gt; integers : lotteryUidList) &#123;</span><br><span class="line">            System.out.println(integers);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">User</span>&#123;</span><br><span class="line">        <span class="type">int</span> id,cnt,time;</span><br><span class="line">        <span class="keyword">public</span> <span class="title function_">User</span><span class="params">(<span class="type">int</span> id, <span class="type">int</span> t)</span>&#123;</span><br><span class="line">            <span class="built_in">this</span>.id = id;</span><br><span class="line">            time = t;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>时间复杂度$O(N^2)$，因为ArrayList删除的时候，时间复杂的是平方级别。</p><h1 id="3-最优解"><a href="#3-最优解" class="headerlink" title="3. 最优解"></a>3. 最优解</h1><h2 id="3-1-算法分析"><a href="#3-1-算法分析" class="headerlink" title="3.1. 算法分析"></a>3.1. 算法分析</h2><p>上面的平凡解中在每一次事件发生的时候，需要在候选区域中寻找购买数量最多，且来的最早的用户。每次使用排序的方式，效率较低。</p><p>我们可以使用堆维护候选区域和获奖区域，候选区域组成 按照购买数量升序，进入时间降序的大顶堆，同时获奖区域 按照购买数量降序，进入时间降序的大顶堆；</p><p>则候选区域堆顶就是购买数量最多且来的最早的，获奖区域堆顶就是购买数量最少，且来的最早的。同时堆可以随着元素的添加删除动态调整。</p><p>可以在堆结构中加一个contains方法，来判断一个元素是否在堆中。</p><h2 id="3-2-代码"><a href="#3-2-代码" class="headerlink" title="3.2. 代码"></a>3.2. 代码</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.Comparator;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LotteryGameMethod2</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> List&lt;List&lt;Integer&gt;&gt; <span class="title function_">getLotteryUidList</span><span class="params">(<span class="type">int</span>[] ids, <span class="type">int</span>[] ops, <span class="type">int</span> k)</span>&#123;</span><br><span class="line">        HashMap&lt;Integer,User&gt; map  = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        MyHeap&lt;User&gt; lotteryArea = <span class="keyword">new</span> <span class="title class_">MyHeap</span>&lt;&gt;((a,b)-&gt;a.cnt!= b.cnt?b.cnt-a.cnt:b.time-a.time),</span><br><span class="line">                candidateArea = <span class="keyword">new</span> <span class="title class_">MyHeap</span>&lt;&gt;((a,b)-&gt;a.cnt!=b.cnt?a.cnt-b.cnt:b.time-a.time);</span><br><span class="line">        List&lt;List&lt;Integer&gt;&gt; ans = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="type">int</span> i=<span class="number">0</span>,len=ids.length;</span><br><span class="line">        <span class="keyword">for</span>(;i&lt;len;++i)&#123;</span><br><span class="line">            <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> map.get(ids[i]);</span><br><span class="line">            <span class="keyword">if</span>(!(user==<span class="literal">null</span> &amp;&amp; ops[i] ==<span class="number">0</span> ))&#123;</span><br><span class="line">                <span class="keyword">if</span>(user == <span class="literal">null</span>)&#123;</span><br><span class="line">                    user = <span class="keyword">new</span> <span class="title class_">User</span>(ids[i],i);</span><br><span class="line">                    map.put(ids[i],user);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span>(ops[i]==<span class="number">0</span>)--user.cnt;</span><br><span class="line">                <span class="keyword">else</span> ++user.cnt;</span><br><span class="line">                <span class="keyword">if</span>(user.cnt == <span class="number">0</span>)&#123;</span><br><span class="line">                    map.remove(ids[i]);</span><br><span class="line">                    lotteryArea.remove(user);</span><br><span class="line">                    candidateArea.remove(user);</span><br><span class="line">                    <span class="keyword">if</span> (lotteryArea.size()&lt;k &amp;&amp; candidateArea.size() &gt;<span class="number">0</span>) &#123;</span><br><span class="line">                        <span class="type">User</span> <span class="variable">poll</span> <span class="operator">=</span> candidateArea.poll();</span><br><span class="line">                        poll.time = i;</span><br><span class="line">                        lotteryArea.add(poll);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                    <span class="keyword">if</span>(lotteryArea.size()&lt;k)&#123;</span><br><span class="line">                        <span class="keyword">if</span>(!lotteryArea.contains(user))lotteryArea.add(user);</span><br><span class="line">                        <span class="keyword">else</span> lotteryArea.update(user);</span><br><span class="line">                    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                        <span class="keyword">if</span>(!lotteryArea.contains(user) &amp;&amp; !candidateArea.contains(user))&#123;</span><br><span class="line">                            candidateArea.add(user);</span><br><span class="line">                        &#125;</span><br><span class="line">                        candidateArea.update(user);</span><br><span class="line">                        lotteryArea.update(user);</span><br><span class="line">                        <span class="keyword">if</span>(candidateArea.size() &gt; <span class="number">0</span> &amp;&amp; candidateArea.peek().cnt &gt; lotteryArea.peek().cnt)&#123;</span><br><span class="line">                            <span class="type">User</span> <span class="variable">candidate</span> <span class="operator">=</span> candidateArea.poll();</span><br><span class="line">                            <span class="type">User</span> <span class="variable">lottery</span> <span class="operator">=</span> lotteryArea.poll();</span><br><span class="line">                            candidate.time = lottery.time = i;</span><br><span class="line">                            candidateArea.add(lottery);</span><br><span class="line">                            lotteryArea.add(candidate);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            List&lt;Integer&gt; ansItem = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;(lotteryArea.size());</span><br><span class="line">            <span class="keyword">for</span> (User lotteryUser : lotteryArea.getAll()) &#123;</span><br><span class="line">                ansItem.add(lotteryUser.id);</span><br><span class="line">            &#125;</span><br><span class="line">            ans.add(ansItem);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ans;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">User</span>&#123;</span><br><span class="line">        <span class="type">int</span> id, cnt,time;</span><br><span class="line">        <span class="keyword">public</span> <span class="title function_">User</span><span class="params">(<span class="type">int</span> id,<span class="type">int</span> t)</span>&#123;</span><br><span class="line">            <span class="built_in">this</span>.id=id;</span><br><span class="line">            time=t;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">MyHeap</span>&lt;T&gt;&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> ArrayList&lt;T&gt; arrayList;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> HashMap&lt;T,Integer&gt; indexMap;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> Comparator&lt;T&gt; comparator;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> <span class="type">int</span> size;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="title function_">MyHeap</span><span class="params">(Comparator&lt;T&gt; comparator)</span>&#123;</span><br><span class="line">            <span class="built_in">this</span>.comparator = comparator;</span><br><span class="line">            arrayList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">            indexMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">add</span><span class="params">(T data)</span>&#123;</span><br><span class="line">            indexMap.put(data,size);</span><br><span class="line">            arrayList.add(data);</span><br><span class="line">            heapInsert(size++);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">remove</span><span class="params">(T data)</span>&#123;</span><br><span class="line">            <span class="type">Integer</span> <span class="variable">index</span> <span class="operator">=</span> indexMap.get(data);</span><br><span class="line">            <span class="keyword">if</span>(index!=<span class="literal">null</span>)&#123;</span><br><span class="line">                <span class="keyword">if</span>(index == size-<span class="number">1</span>)&#123;</span><br><span class="line">                    arrayList.remove(--size);</span><br><span class="line">                &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">                    swap(arrayList.get(index),arrayList.get(--size));</span><br><span class="line">                    resign(index);</span><br><span class="line">                    arrayList.remove(size);</span><br><span class="line">                &#125;</span><br><span class="line">                indexMap.remove(data);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> T <span class="title function_">poll</span><span class="params">()</span>&#123;</span><br><span class="line">            <span class="type">T</span> <span class="variable">data</span> <span class="operator">=</span> arrayList.get(<span class="number">0</span>);</span><br><span class="line">            --size;</span><br><span class="line">            <span class="keyword">if</span>(size==<span class="number">0</span>)&#123;</span><br><span class="line">                arrayList.remove(<span class="number">0</span>);</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                swap(arrayList.get(<span class="number">0</span>),arrayList.get(size));</span><br><span class="line">                resign(<span class="number">0</span>);</span><br><span class="line">                arrayList.remove(size);</span><br><span class="line">            &#125;</span><br><span class="line">            indexMap.remove(data);</span><br><span class="line">            <span class="keyword">return</span> data;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> T <span class="title function_">peek</span><span class="params">()</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> arrayList.get(<span class="number">0</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">contains</span><span class="params">(T data)</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> indexMap.containsKey(data);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">update</span><span class="params">(T data)</span>&#123;</span><br><span class="line">            <span class="type">Integer</span> <span class="variable">index</span> <span class="operator">=</span> indexMap.get(data);</span><br><span class="line">            <span class="keyword">if</span>(index!=<span class="literal">null</span>)resign(index);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">size</span><span class="params">()</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> size;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> ArrayList&lt;T&gt; <span class="title function_">getAll</span><span class="params">()</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> arrayList;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">resign</span><span class="params">(<span class="type">int</span> index)</span>&#123;</span><br><span class="line">            heapInsert(index);</span><br><span class="line">            heapify(index);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">heapInsert</span><span class="params">(<span class="type">int</span> index)</span>&#123;</span><br><span class="line">            <span class="type">int</span> parent;</span><br><span class="line">            <span class="keyword">while</span>(comparator.compare(arrayList.get(index),arrayList.get(parent = (index-<span class="number">1</span>)/<span class="number">2</span>)) &gt; <span class="number">0</span>)&#123;</span><br><span class="line">                swap(arrayList.get(index),arrayList.get(parent));</span><br><span class="line">                index = parent;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">heapify</span><span class="params">(<span class="type">int</span> index)</span>&#123;</span><br><span class="line">            <span class="type">int</span> child, bnd = size&gt;&gt;<span class="number">1</span>;</span><br><span class="line">            <span class="keyword">while</span>(index&lt;bnd)&#123;</span><br><span class="line">                child = (index&lt;&lt;<span class="number">1</span>)|<span class="number">1</span>;</span><br><span class="line">                <span class="keyword">if</span>(child+<span class="number">1</span>&lt;size &amp;&amp; comparator.compare(arrayList.get(child),arrayList.get(child+<span class="number">1</span>)) &lt; <span class="number">0</span>)++child;</span><br><span class="line">                <span class="keyword">if</span>(comparator.compare(arrayList.get(index),arrayList.get(child)) &lt; <span class="number">0</span>)&#123;</span><br><span class="line">                    swap(arrayList.get(index),arrayList.get(child));</span><br><span class="line">                    index = child;</span><br><span class="line">                &#125;<span class="keyword">else</span> <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">swap</span><span class="params">(T t1, T t2)</span>&#123;</span><br><span class="line">            <span class="type">Integer</span> <span class="variable">index1</span> <span class="operator">=</span> indexMap.get(t1),</span><br><span class="line">                    index2 = indexMap.get(t2);</span><br><span class="line">            arrayList.set(index1,t2);</span><br><span class="line">            arrayList.set(index2,t1);</span><br><span class="line">            indexMap.put(t1,index2);</span><br><span class="line">            indexMap.put(t2,index1);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">int</span>[] ids = &#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">3</span>,<span class="number">2</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">7</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">2</span>&#125;,</span><br><span class="line">                ops=&#123;<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>&#125;;</span><br><span class="line">        <span class="type">int</span> <span class="variable">k</span> <span class="operator">=</span> <span class="number">2</span>;</span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">        1</span></span><br><span class="line"><span class="comment">        1,2</span></span><br><span class="line"><span class="comment">        1,2</span></span><br><span class="line"><span class="comment">        2,3</span></span><br><span class="line"><span class="comment">        2,3</span></span><br><span class="line"><span class="comment">        2,3</span></span><br><span class="line"><span class="comment">        2,3</span></span><br><span class="line"><span class="comment">        2,3</span></span><br><span class="line"><span class="comment">        2,3</span></span><br><span class="line"><span class="comment">        2,3</span></span><br><span class="line"><span class="comment">        2,3</span></span><br><span class="line"><span class="comment">        3,4</span></span><br><span class="line"><span class="comment">        3,4</span></span><br><span class="line"><span class="comment">        * */</span></span><br><span class="line">        List&lt;List&lt;Integer&gt;&gt; lotteryUidList = getLotteryUidList(ids, ops, k);</span><br><span class="line">        <span class="keyword">for</span> (List&lt;Integer&gt; integers : lotteryUidList) &#123;</span><br><span class="line">            System.out.println(integers);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>时间复杂的$O(N\log_2N)$</p><h1 id="4-测试程序"><a href="#4-测试程序" class="headerlink" title="4. 测试程序"></a>4. 测试程序</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Random;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LotteryGameMethodTest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">times</span> <span class="operator">=</span> <span class="number">100_0000</span>,maxArrayLen = <span class="number">100</span>;</span><br><span class="line">        <span class="type">LotteryGameMethod1</span> <span class="variable">lotteryGameMethod1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">LotteryGameMethod1</span>();</span><br><span class="line">        <span class="type">LotteryGameMethod2</span> <span class="variable">lotteryGameMethod2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">LotteryGameMethod2</span>();</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;times;++i)&#123;</span><br><span class="line">            <span class="type">Random</span> <span class="variable">random</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Random</span>();</span><br><span class="line">            <span class="type">int</span> <span class="variable">len</span> <span class="operator">=</span> random.nextInt(maxArrayLen)+<span class="number">1</span>;</span><br><span class="line">            <span class="type">int</span>[] ids = <span class="keyword">new</span> <span class="title class_">int</span>[len], ops = <span class="keyword">new</span> <span class="title class_">int</span>[len];</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span><span class="number">0</span>;j&lt;len;++j)&#123;</span><br><span class="line">                ids[j] = random.nextInt(<span class="number">100</span>);</span><br><span class="line">                ops[j] = random.nextInt(<span class="number">2</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="type">int</span> <span class="variable">k</span> <span class="operator">=</span> random.nextInt(<span class="number">20</span>)+<span class="number">1</span>;</span><br><span class="line">            List&lt;List&lt;Integer&gt;&gt; lotteryUidList1 = LotteryGameMethod1.getLotteryUidList(ids, ops, k);</span><br><span class="line">            List&lt;List&lt;Integer&gt;&gt; lotteryUidList2 = LotteryGameMethod2.getLotteryUidList(ids, ops, k);</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>;j&lt;len;++j)&#123;</span><br><span class="line">                List&lt;Integer&gt; integers1 = lotteryUidList1.get(j);</span><br><span class="line">                List&lt;Integer&gt; integers2 = lotteryUidList2.get(j);</span><br><span class="line">                <span class="keyword">if</span>(integers1.size()!=integers2.size())&#123;</span><br><span class="line">                    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;Oops&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                integers1.sort(Integer::compare);</span><br><span class="line">                integers2.sort(Integer::compare);</span><br><span class="line">                <span class="keyword">for</span>(<span class="type">int</span> m=<span class="number">0</span>;m&lt;integers1.size();++m)&#123;</span><br><span class="line">                    <span class="keyword">if</span>(!integers1.get(m).equals(integers2.get(m)))&#123;</span><br><span class="line">                        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;Oops&quot;</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">&quot;Test done&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 算法 </category>
          
          <category> 问题 </category>
          
          <category> 堆相关 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 堆 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>堆</title>
      <link href="/2022/10/10/enhanced-heap/"/>
      <url>/2022/10/10/enhanced-heap/</url>
      
        <content type="html"><![CDATA[<!-- toc --><h1 id="1-数据结构介绍"><a href="#1-数据结构介绍" class="headerlink" title="1. 数据结构介绍"></a>1. 数据结构介绍</h1><p>要求实现一种堆数据结构，具有如下操作：</p><ol><li>可以动态添加元素</li><li>可以修改给定元素</li><li>可以动态删除元素，可以删除指定位置的元素，以及删除给定的元素</li><li>获取堆顶元素</li><li>弹出堆顶</li><li>获取堆中的元素个数</li><li>用户可以指定比较策略</li></ol><h1 id="2-算法"><a href="#2-算法" class="headerlink" title="2. 算法"></a>2. 算法</h1><ul><li>对于可以动态增删元素，可以使用动态数组ArrayList来实现；</li><li>如果需要对给定的元素进行操作，我们需要知道这个元素在堆数组中的下标，因此需要一个查找表记录每一个元素及其在堆数组中的下标；</li><li>对于修改元素，我们只需要将修改后的元素同时做一次heapInsert和heapify即可，因为修改后，元素的排序指标可能变大也可能变小，或者不变，因此heapInsert和heapify最多只会发生一个；这个叫做元素的resign（重新分配）</li><li>对于删除元素，我们只需要把最后一个元素last和被删除的元素交换，堆的大小减少1，然后resign这个last元素，如果被删除的刚好是最后一个，直接删除即可。</li><li>可以使用比较器让比较策略灵活指定。</li></ul><h1 id="3-代码"><a href="#3-代码" class="headerlink" title="3. 代码"></a>3. 代码</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.Comparator;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EnhancedHeap</span>&lt;T&gt; &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> ArrayList&lt;T&gt; arrayList;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> HashMap&lt;T,Integer&gt; indexMap;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Comparator&lt;T&gt; comparator;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> size;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">EnhancedHeap</span><span class="params">(Comparator&lt;T&gt; comparator)</span>&#123;</span><br><span class="line">        <span class="built_in">this</span>.comparator = comparator;</span><br><span class="line">        arrayList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        indexMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">size</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> size;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">add</span><span class="params">(T data)</span>&#123;</span><br><span class="line">        arrayList.add(data);</span><br><span class="line">        indexMap.put(data,size);</span><br><span class="line">        heapInsert(size++);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">remove</span><span class="params">(T data)</span>&#123;</span><br><span class="line">        <span class="type">Integer</span> <span class="variable">index</span> <span class="operator">=</span> indexMap.get(data);</span><br><span class="line">        <span class="keyword">if</span>(index != <span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="keyword">if</span>(index == size -<span class="number">1</span>)&#123;</span><br><span class="line">                arrayList.remove(--size);</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                swap(arrayList.get(index),arrayList.get(--size));</span><br><span class="line">                arrayList.remove(size);</span><br><span class="line">                resign(index);</span><br><span class="line">            &#125;</span><br><span class="line">            indexMap.remove(data);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">update</span><span class="params">(T data)</span>&#123;</span><br><span class="line">        <span class="type">Integer</span> <span class="variable">index</span> <span class="operator">=</span> indexMap.get(data);</span><br><span class="line">        <span class="keyword">if</span> (index != <span class="literal">null</span>)resign(index);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> T <span class="title function_">poll</span><span class="params">()</span>&#123;</span><br><span class="line">         <span class="type">T</span> <span class="variable">ret</span>  <span class="operator">=</span> arrayList.get(<span class="number">0</span>);</span><br><span class="line">         swap(ret,arrayList.get(size - <span class="number">1</span>));</span><br><span class="line">         arrayList.remove(--size);</span><br><span class="line">         heapify(<span class="number">0</span>);</span><br><span class="line">         indexMap.remove(ret);</span><br><span class="line">         <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> T <span class="title function_">peek</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> arrayList.get(<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">resign</span><span class="params">(<span class="type">int</span> index)</span>&#123;</span><br><span class="line">        heapInsert(index);</span><br><span class="line">        heapify(index);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">heapInsert</span><span class="params">(<span class="type">int</span> index)</span>&#123;</span><br><span class="line">        <span class="type">int</span> parent;</span><br><span class="line">        <span class="keyword">while</span>(comparator.compare(arrayList.get(index),arrayList.get(parent = (index-<span class="number">1</span>) / <span class="number">2</span> )) &gt; <span class="number">0</span>)&#123;</span><br><span class="line">            swap(arrayList.get(index), arrayList.get(parent));</span><br><span class="line">            index = parent;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">heapify</span><span class="params">(<span class="type">int</span> index)</span>&#123;</span><br><span class="line">        <span class="type">int</span> child, bound = size &gt;&gt; <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span>(index &lt; bound)&#123;</span><br><span class="line">            child = (index &lt;&lt; <span class="number">1</span>) | <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">if</span>(child + <span class="number">1</span> &lt; size &amp;&amp; comparator.compare(arrayList.get(child),arrayList.get(child+<span class="number">1</span>)) &lt; <span class="number">0</span>) ++child;</span><br><span class="line">            <span class="keyword">if</span>(comparator.compare(arrayList.get(index),arrayList.get(child)) &lt; <span class="number">0</span>)&#123;</span><br><span class="line">                swap(arrayList.get(index),arrayList.get(child));</span><br><span class="line">                index = child;</span><br><span class="line">            &#125;<span class="keyword">else</span> <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">swap</span><span class="params">(T t1, T t2)</span>&#123;</span><br><span class="line">        <span class="type">Integer</span> <span class="variable">index1</span> <span class="operator">=</span> indexMap.get(t1), index2 = indexMap.get(t2);</span><br><span class="line">        arrayList.set(index1,t2);</span><br><span class="line">        arrayList.set(index2,t1);</span><br><span class="line">        indexMap.put(t1,index2);</span><br><span class="line">        indexMap.put(t2,index1);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// 测试程序</span></span><br><span class="line">        EnhancedHeap&lt;Info&gt; enhancedHeap = <span class="keyword">new</span> <span class="title class_">EnhancedHeap</span>&lt;&gt;((a,b)-&gt; a.value - b.value);</span><br><span class="line">        <span class="type">Info</span> <span class="variable">a</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Info</span>(<span class="number">1</span>), b = <span class="keyword">new</span> <span class="title class_">Info</span>(<span class="number">2</span>), c = <span class="keyword">new</span> <span class="title class_">Info</span>(<span class="number">3</span>);</span><br><span class="line">        enhancedHeap.add(a);</span><br><span class="line">        System.out.println(<span class="string">&quot;size: &quot;</span>+enhancedHeap.size+<span class="string">&quot;  top: &quot;</span>+enhancedHeap.peek());</span><br><span class="line">        enhancedHeap.add(b);</span><br><span class="line">        System.out.println(<span class="string">&quot;size: &quot;</span>+enhancedHeap.size+<span class="string">&quot;  top: &quot;</span>+enhancedHeap.peek());</span><br><span class="line">        enhancedHeap.add(c);</span><br><span class="line">        System.out.println(<span class="string">&quot;size: &quot;</span>+enhancedHeap.size+<span class="string">&quot;  top: &quot;</span>+enhancedHeap.peek());</span><br><span class="line">        c.value = <span class="number">7</span>;</span><br><span class="line">        enhancedHeap.update(c);</span><br><span class="line">        System.out.println(<span class="string">&quot;size: &quot;</span>+enhancedHeap.size+<span class="string">&quot;  top: &quot;</span>+enhancedHeap.peek());</span><br><span class="line">        enhancedHeap.remove(a);</span><br><span class="line">        System.out.println(<span class="string">&quot;size: &quot;</span>+enhancedHeap.size+<span class="string">&quot;  top: &quot;</span>+enhancedHeap.peek());</span><br><span class="line">        System.out.println(<span class="string">&quot;top: &quot;</span>+enhancedHeap.poll());</span><br><span class="line">        System.out.println(<span class="string">&quot;size: &quot;</span>+enhancedHeap.size+<span class="string">&quot;  top: &quot;</span>+enhancedHeap.peek());</span><br><span class="line">        enhancedHeap.add(<span class="keyword">new</span> <span class="title class_">Info</span>(<span class="number">8</span>));</span><br><span class="line">        System.out.println(<span class="string">&quot;size: &quot;</span>+enhancedHeap.size+<span class="string">&quot;  top: &quot;</span>+enhancedHeap.peek());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Info</span>&#123;</span><br><span class="line">        <span class="type">int</span> value;</span><br><span class="line">        <span class="keyword">public</span> <span class="title function_">Info</span><span class="params">(<span class="type">int</span> v)</span>&#123;</span><br><span class="line">            value = v;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> value+<span class="string">&quot;&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 算法 </category>
          
          <category> 数据结构 </category>
          
          <category> 堆 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>堆排序</title>
      <link href="/2022/10/03/heapSort/"/>
      <url>/2022/10/03/heapSort/</url>
      
        <content type="html"><![CDATA[<!-- toc --><h1 id="1-整体思路"><a href="#1-整体思路" class="headerlink" title="1. 整体思路"></a>1. 整体思路</h1><p>和选择排序是一样的，首先在所有元素中选出最大的元素放在最后的位置，然后在剩下的元素中选出最大的放在倒数第二的位置，……，以此类推，直到剩下一个与元素为止。</p><h1 id="2-算法过程"><a href="#2-算法过程" class="headerlink" title="2. 算法过程"></a>2. 算法过程</h1><ol><li><p>首先把待排序的数组原地调整成一个堆结构，什么？不知道堆数据结构，可以看<a href="https://blog.csdn.net/qq_37684467/article/details/117229493">这篇文章</a>；</p></li><li><p>假设数组需要从小到大排序，我们使用大顶堆来完成。数组调整成堆可以使用heapify，线性时间复杂度。</p></li><li><p>只要堆中的元素个数（size）大于1，执行下面的逻辑</p><p>3.1. 把堆顶元素和数组中下标为size-1的元素做交换；</p><p>3.2. size–；</p><p>3.3. 对堆顶元素做heapify操作，调整堆。</p></li></ol><h1 id="3-代码"><a href="#3-代码" class="headerlink" title="3. 代码"></a>3. 代码</h1><p>Java</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HeapSort</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">times</span> <span class="operator">=</span> <span class="number">100_0000</span>, maxArraySize = <span class="number">1000</span>;</span><br><span class="line">        <span class="type">Random</span> <span class="variable">r</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Random</span>();</span><br><span class="line">        <span class="keyword">while</span>(times-- &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">len</span> <span class="operator">=</span> r.nextInt(maxArraySize);</span><br><span class="line">            <span class="type">int</span>[] arr1 = <span class="keyword">new</span> <span class="title class_">int</span>[len], arr2 = <span class="keyword">new</span> <span class="title class_">int</span>[len];</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; len; ++i) arr1[i] = arr2[i] = r.nextInt(<span class="number">21</span>) - <span class="number">10</span>;</span><br><span class="line">            Arrays.sort(arr1);</span><br><span class="line">            heapSort(arr2);</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; len; ++i) &#123;</span><br><span class="line">                <span class="keyword">if</span>(arr1[i] != arr2[i]) &#123;</span><br><span class="line">                    <span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; len; ++i) System.out.print(arr1[i] + <span class="string">&quot;,&quot;</span>);</span><br><span class="line">                    System.out.println();</span><br><span class="line">                    <span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; len; ++i) System.out.print(arr2[i] + <span class="string">&quot;,&quot;</span>);</span><br><span class="line">                    System.out.println();</span><br><span class="line">                    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">heapSort</span><span class="params">(<span class="type">int</span>[] arr)</span> &#123;</span><br><span class="line">    <span class="type">int</span> i,len = arr.length;</span><br><span class="line">        <span class="keyword">for</span>(i = (len &gt;&gt; <span class="number">1</span>) - <span class="number">1</span>; i &gt; -<span class="number">1</span>; --i) heapIfy(arr,len,i); <span class="comment">// 创建大顶堆</span></span><br><span class="line">        <span class="keyword">for</span>(i = len; i &gt; <span class="number">1</span>;) &#123;<span class="comment">// i就是堆的size</span></span><br><span class="line">            swap(arr,<span class="number">0</span>,--i);</span><br><span class="line">            heapIfy(arr,i,<span class="number">0</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">heapIfy</span><span class="params">(<span class="type">int</span>[] heap, <span class="type">int</span> size, <span class="type">int</span> index)</span> &#123;</span><br><span class="line">        <span class="comment">// 堆的元素个数是size，对下标为index的元素做heapify操作</span></span><br><span class="line">        <span class="type">int</span> child, bound = size &gt;&gt; <span class="number">1</span>, v = heap[index];</span><br><span class="line">        <span class="keyword">while</span>(index &lt; bound) &#123;</span><br><span class="line">            child = (index &lt;&lt; <span class="number">1</span>) + <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">if</span>(child + <span class="number">1</span> &lt; size &amp;&amp; heap[child + <span class="number">1</span>] &gt; heap[child]) ++child;</span><br><span class="line">            <span class="keyword">if</span>(v &gt;= heap[child]) <span class="keyword">break</span>;</span><br><span class="line">            heap[index] = heap[child];</span><br><span class="line">            index = child;</span><br><span class="line">        &#125;</span><br><span class="line">        heap[index] = v;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">swap</span><span class="params">(<span class="type">int</span>[] arr, <span class="type">int</span> i, <span class="type">int</span> j)</span>&#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">t</span> <span class="operator">=</span> arr[i];</span><br><span class="line">        arr[i] = arr[j];</span><br><span class="line">        arr[j] = t;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 算法 </category>
          
          <category> 排序 </category>
          
          <category> 堆排序 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>ls</title>
      <link href="/2022/09/20/ls/"/>
      <url>/2022/09/20/ls/</url>
      
        <content type="html"><![CDATA[<!-- toc --><h1 id="1-命令作用"><a href="#1-命令作用" class="headerlink" title="1. 命令作用"></a>1. 命令作用</h1><p>显示目录中的文件信息。</p><h1 id="2-命令格式"><a href="#2-命令格式" class="headerlink" title="2. 命令格式"></a>2. 命令格式</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">ls</span> [options]... [file]...</span><br></pre></td></tr></table></figure><h1 id="3-命令解释"><a href="#3-命令解释" class="headerlink" title="3. 命令解释"></a>3. 命令解释</h1><ol><li>ls程序可以显示目录中的任何文件信息（包括目录的信息），选项和参数和随意混合使用，后来的选项可以覆盖前面与之不兼容的选项；</li><li>ls命令不带任何选项和参数的情况下，相当于ls . ，显示当前目录的文件信息。对于非选项的命令行参数，例如ls xxx，如果xxx是一个目录的话，那么ls程序就会显示这个目录内的文件信息（非递归，且忽略以.（点号）开头的文件），如果xxx是一个文件的话，那么只是显示它的名称。</li></ol><h1 id="4-选项"><a href="#4-选项" class="headerlink" title="4. 选项"></a>4. 选项</h1><h2 id="4-1-a-–all"><a href="#4-1-a-–all" class="headerlink" title="4.1. -a,–all"></a>4.1. -a,–all</h2><p>不忽略名称以.（点）开头的文件</p><h2 id="4-2-A-–almost-all"><a href="#4-2-A-–almost-all" class="headerlink" title="4.2. -A, –almost-all"></a>4.2. -A, –almost-all</h2><p>不忽略名称以.（点）开头的文件，除了.（当前目录）和..（上一级目录），-a,–all可以覆盖此选项。</p><h2 id="4-3-B"><a href="#4-3-B" class="headerlink" title="4.3. -B"></a>4.3. -B</h2><p>忽略名称以’~‘结尾的，这些文件一般是文本编辑器的备份文件。–ignore&#x3D;’*<del>‘ –ignore&#x3D;’.*</del>‘具有相同的效果。</p><h2 id="4-4-d-–directory"><a href="#4-4-d-–directory" class="headerlink" title="4.4. -d,–directory"></a>4.4. -d,–directory</h2><p>当ls file的时候，如果file是一个目录，那么会显示它立里面的内容，如果想显示目录本身的内容的话，需要使用</p><p>-d选项。</p><h2 id="4-5-–group-directories-first"><a href="#4-5-–group-directories-first" class="headerlink" title="4.5. –group-directories-first"></a>4.5. –group-directories-first</h2><p>会把目录全部显示在文件的前面，文件和目录单独排序。</p><h2 id="4-6-–hide-x3D-PATTERN"><a href="#4-6-–hide-x3D-PATTERN" class="headerlink" title="4.6. –hide&#x3D;PATTERN"></a>4.6. –hide&#x3D;PATTERN</h2><p>隐藏文件名称匹配pattern的文件，如该–all,-a 或者 –almost-all,-A 这些选项在的时候，–hide&#x3D;PATTERN就不起作用了。–ignore&#x3D;PATTERN可以起到相同的作用，但是–all,-a 或者 –almost-all,-A 这些选项对–ignore&#x3D;PATTERN不起作用。</p><p>例如当前目录中有一个文件README<del>，使用ls –hide&#x3D;’*</del>‘ -A，不能隐藏掉README<del>，但是ls –ignore&#x3D;’*</del>‘ -A 就可以。</p><h2 id="4-7-I-pattern-–ignore-x3D-pattern"><a href="#4-7-I-pattern-–ignore-x3D-pattern" class="headerlink" title="4.7. -I pattern, –ignore&#x3D;pattern"></a>4.7. -I pattern, –ignore&#x3D;pattern</h2><p>忽略文件名称和shell 模式匹配的文件。这里的pattern不是正则，是shell的glob表达式。例如：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">ls</span> --ignore=<span class="string">&#x27;.??*&#x27;</span> --ignore=<span class="string">&#x27;.[^.]&#x27;</span> --ignore=<span class="string">&#x27;#*&#x27;</span></span><br></pre></td></tr></table></figure><p>第一个选项表示忽略文件名称以.开头的，且文件名称长度至少是三个字符的文件；</p><p>第二个选项表示忽略文件名称以.开头的，且名称不是..的文件；</p><p>第三个选项表示忽略文件名称是以’#’开头的文件；</p><h2 id="4-8-R-–recursive"><a href="#4-8-R-–recursive" class="headerlink" title="4.8. -R, –recursive"></a>4.8. -R, –recursive</h2><p>递归显示目录的内容。</p><h2 id="4-9-i-–inode"><a href="#4-9-i-–inode" class="headerlink" title="4.9 -i, –inode"></a>4.9 -i, –inode</h2><p>在文件名称的左边显示inode信息，inode在一个文件系统中是唯一的。</p><h2 id="4-10-h-–human-readable"><a href="#4-10-h-–human-readable" class="headerlink" title="4.10  -h, –human-readable"></a>4.10  -h, –human-readable</h2><p>以人类可读的方式显示文件的size，文件大小是以字节数显示的，这个选项可以在适当的时候，显示KB，MB等，这里的M默认是2的10次方（1048576）。这个选项与--block-size&#x3D;human-reabable是等价的。</p><p>如果需要让单位以10为基数，即M是10的三次方，可以使用 --si选项。</p><h2 id="4-11-l-–format-x3D-long-–format-x3D-verbose"><a href="#4-11-l-–format-x3D-long-–format-x3D-verbose" class="headerlink" title="4.11. -l, –format&#x3D;long, –format&#x3D;verbose"></a>4.11. -l, –format&#x3D;long, –format&#x3D;verbose</h2><p>长格式显示。除了每一个文件的文件名称，还会显示文件的类型，文件模式位，硬链接的数目，属主，属组，文件size，时间戳（修改时间）。</p><p>在显示每一个目录信息的开头，显示total blocks信息，代表文件系统为这个目录下的所有文件分配的磁盘块的个数<a href="%E5%85%B6%E5%AE%9E%E5%AE%83%E7%BB%9F%E8%AE%A1%E7%9A%84%E6%98%AF%E6%AF%8F%E4%B8%80%E4%B8%AA%E7%A1%AC%E9%93%BE%E6%8E%A5%E7%9A%84%E7%A3%81%E7%9B%98%E5%9D%97%E6%80%BB%E6%95%B0%EF%BC%8C%E5%8D%B3%E5%A6%82%E6%9E%9C%E4%B8%80%E4%B8%AA%E6%96%87%E4%BB%B6%E5%8D%A0%E7%94%A84%E4%B8%AA%E7%A3%81%E7%9B%98%E5%9D%97%EF%BC%8C%E4%B8%94%E5%AE%83%E6%9C%89%E4%B8%A4%E4%B8%AA%E7%A1%AC%E9%93%BE%E6%8E%A5%EF%BC%8C%E9%82%A3%E4%B9%88%E5%AE%83%E7%9A%84%E7%A3%81%E7%9B%98%E5%9D%97%E4%BC%9A%E8%AE%A1%E7%AE%97%E4%B8%A4%E6%AC%A1%EF%BC%8C%E8%BF%99%E6%9C%89%E5%8F%AF%E8%83%BD%E6%98%AF%E4%B8%AAbug">^1</a>。磁盘块默认1024字节。</p><p>文件类型都有：</p><table><thead><tr><th>文件类型代号</th><th>文件类型</th></tr></thead><tbody><tr><td>-</td><td>普通文件</td></tr><tr><td>b</td><td>块设备文件，例如硬盘</td></tr><tr><td>c</td><td>字符设备文件，例如键盘</td></tr><tr><td>C</td><td>high performance (“contiguous data”) file</td></tr><tr><td>d</td><td>目录</td></tr><tr><td>D</td><td>door (Solaris)</td></tr><tr><td>l</td><td>符号链接，软链接</td></tr><tr><td>M</td><td>off-line (“migrated”) file (Cray DMF)</td></tr><tr><td>n</td><td>network special file (HP-UX)</td></tr><tr><td>p</td><td>FIFO，命名管道</td></tr><tr><td>P</td><td>port (Solaris)</td></tr><tr><td>s</td><td>套接字文件</td></tr><tr><td>?</td><td>其他文件类型</td></tr><tr><td>D</td><td>door (Solaris)</td></tr><tr><td>l</td><td>符号链接，软链接</td></tr><tr><td>M</td><td>off-line (“migrated”) file (Cray DMF)</td></tr><tr><td>n</td><td>network special file (HP-UX)</td></tr></tbody></table><h2 id="4-12-n-–numeric-uid-gid"><a href="#4-12-n-–numeric-uid-gid" class="headerlink" title="4.12. -n, –numeric-uid-gid"></a>4.12. -n, –numeric-uid-gid</h2><p>以长格式显示文件信息，但文件的所有者和所在组使用右对齐的数字ID显示，而不是使用左对齐的名称显示。</p><h2 id="4-13-–author"><a href="#4-13-–author" class="headerlink" title="4.13. –author"></a>4.13. –author</h2><p>用于长格式显示的情况下，需要与-l配合使用。显示文件的作者。在GNU&#x2F;Hurd系统中，文件的作者和拥有者可以是不一样的，对其他系统来说，他们俩是一个意思。</p>]]></content>
      
      
      <categories>
          
          <category> 操作系统 </category>
          
          <category> Linux </category>
          
          <category> shell </category>
          
          <category> 常用命令 </category>
          
          <category> 目录操作 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>pwd</title>
      <link href="/2022/09/19/pwd/"/>
      <url>/2022/09/19/pwd/</url>
      
        <content type="html"><![CDATA[<!-- toc --><h1 id="1-命令作用"><a href="#1-命令作用" class="headerlink" title="1. 命令作用"></a>1. 命令作用</h1><p>显示shell的当前工作目录中的绝对路径。</p><h1 id="2-选项"><a href="#2-选项" class="headerlink" title="2. 选项"></a>2. 选项</h1><h2 id="2-1-L"><a href="#2-1-L" class="headerlink" title="2.1. -L"></a>2.1. -L</h2><p>默认选项，打印出的路径包含符号链接。</p><h2 id="2-2-P"><a href="#2-2-P" class="headerlink" title="2.2. -P"></a>2.2. -P</h2><p>打印出的路径不包含符号链接。</p>]]></content>
      
      
      <categories>
          
          <category> 操作系统 </category>
          
          <category> Linux </category>
          
          <category> shell </category>
          
          <category> 常用命令 </category>
          
          <category> shell内建命令 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>cd</title>
      <link href="/2022/09/19/ShellExecEnv-cd/"/>
      <url>/2022/09/19/ShellExecEnv-cd/</url>
      
        <content type="html"><![CDATA[<!-- toc --><h1 id="1-命令作用"><a href="#1-命令作用" class="headerlink" title="1. 命令作用"></a>1. 命令作用</h1><p>切换当前shell的工作目录。</p><h1 id="2-命令格式"><a href="#2-命令格式" class="headerlink" title="2. 命令格式"></a>2. 命令格式</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> [-L] [-P [-e]] [<span class="built_in">dir</span>]</span><br></pre></td></tr></table></figure><h1 id="3-命令解释"><a href="#3-命令解释" class="headerlink" title="3. 命令解释"></a>3. 命令解释</h1><h2 id="3-1-特殊参数"><a href="#3-1-特殊参数" class="headerlink" title="3.1. 特殊参数"></a>3.1. 特殊参数</h2><p>cd命令后面一般跟一个目录的路径，可以使用绝对路径或者相对路径。如果不提供目录参数，那么默认$HOME，会被使用，即切换到用户的家目录。如果目录参参数是-，那么-会被替换为$OLDPWD，表示切换到上一次shell的工作目录。</p><p>如果你在dir后面提供了多余的参数，那么会被忽略，比如你执行</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /root foo bar</span><br></pre></td></tr></table></figure><p>foo bar会被忽略。（经过测试，某些版本的shell会打印出错误消息，例如：“bash: cd: too many arguments”）</p><p> 如果一个文件夹的名称叫做“-”，那么使用cd -是不能切换进去的，可以使用cd .&#x2F;- 实现。</p><h2 id="3-2-CDPATH"><a href="#3-2-CDPATH" class="headerlink" title="3.2. CDPATH"></a>3.2. CDPATH</h2><p>如果环境变量CDPATH不为空，当我们直接输入cd dir的时候，如果dir在CDPATH中的某个目录中的时候，cd命令就会直接切换到这个目录。</p><p>例如：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">zk@zk:~$ <span class="built_in">pwd</span></span><br><span class="line">/home/zk</span><br><span class="line">zk@zk:~$ <span class="built_in">ls</span></span><br><span class="line">Desktop    Downloads  Pictures  Public     Tools        Videos</span><br><span class="line">Documents  Music      Projects  Templates  usrlocalbin</span><br><span class="line">zk@zk:~$ CDPATH=/home/zk</span><br><span class="line">zk@zk:~$ <span class="built_in">cd</span> /</span><br><span class="line">zk@zk:/$ <span class="built_in">cd</span> Tools/</span><br><span class="line">/home/zk/Tools</span><br><span class="line">zk@zk:~/Tools$ </span><br></pre></td></tr></table></figure><p>&#x2F;home&#x2F;zk目录下有Tools，Projects等目录，当把CDPATH设置成&#x2F;home&#x2F;zk的时候，此时直接输入cd Tools的时候，cd发现Tools在&#x2F;home&#x2F;zk中，那么就会之际切换到&#x2F;home&#x2F;zk&#x2F;Tools中。</p><p>CDPATH中可以设置不止一个路径，多个路径使用：（冒号）分隔。</p><p>如该cd dir中dir是一个绝对路径，那么CDPATH将被禁用。如该CDPATH中的目录或者-参数指定的目录被成功切换，那么这个目录的绝对路径会被打印到标准输出。</p><h2 id="3-3-的使用"><a href="#3-3-的使用" class="headerlink" title="3.3 $_的使用"></a>3.3 $_的使用</h2><p>$_指的是上一个命令的最后一个参数，利用这个我们可以使用一条命令，新建一个目录的同时，并cd进入这个目录。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> aa &amp;&amp; <span class="built_in">cd</span> <span class="variable">$_</span></span><br></pre></td></tr></table></figure><p>或者</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> aa ; <span class="built_in">cd</span> <span class="variable">$_</span></span><br></pre></td></tr></table></figure><h1 id="4-选项"><a href="#4-选项" class="headerlink" title="4. 选项"></a>4. 选项</h1><h2 id="4-1-L选项"><a href="#4-1-L选项" class="headerlink" title="4.1. -L选项"></a>4.1. -L选项</h2><p>这是个默认的选项，使用这个选项的时候，当cd dir的时候，如果dir是符号链接的话，cd会切换到符号链接，而不是符号链接指向的目录。例如，</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">zk@zk:~$ <span class="built_in">ls</span> -lh</span><br><span class="line">total 40K</span><br><span class="line">drwxr-xr-x 2 zk zk 4.0K Sep 17 15:02 Desktop</span><br><span class="line">drwxr-xr-x 3 zk zk 4.0K Sep 16 13:29 Documents</span><br><span class="line">drwxr-xr-x 4 zk zk 4.0K Sep 18 22:26 Downloads</span><br><span class="line">drwxr-xr-x 2 zk zk 4.0K Sep 14 16:45 Music</span><br><span class="line">drwxr-xr-x 2 zk zk 4.0K Sep 15 12:37 Pictures</span><br><span class="line">drwxrwxr-x 6 zk zk 4.0K Sep 18 22:27 Projects</span><br><span class="line">drwxr-xr-x 2 zk zk 4.0K Sep 14 16:45 Public</span><br><span class="line">drwxr-xr-x 2 zk zk 4.0K Sep 14 16:45 Templates</span><br><span class="line">drwxrwxr-x 3 zk zk 4.0K Sep 19 15:44 Tools</span><br><span class="line">lrwxrwxrwx 1 zk zk   15 Sep 19 00:26 usrlocalbin -&gt; /usr/local/bin/</span><br><span class="line">drwxr-xr-x 2 zk zk 4.0K Sep 14 16:45 Videos</span><br><span class="line">zk@zk:~$ <span class="built_in">cd</span> usrlocalbin</span><br><span class="line">/home/zk/usrlocalbin</span><br><span class="line">zk@zk:~/usrlocalbin$ <span class="built_in">pwd</span></span><br><span class="line">/home/zk/usrlocalbin</span><br><span class="line">zk@zk:~/usrlocalbin$ </span><br></pre></td></tr></table></figure><p>在&#x2F;home&#x2F;zk目录下，有一个usrlocalbin目录，它是一个指向&#x2F;usr&#x2F;local&#x2F;bin的符号链接，cd到这个目录以后，发现当前工作目录在&#x2F;home&#x2F;zk&#x2F;usrlocalbin，而不是在&#x2F;usr&#x2F;local&#x2F;bin。</p><p>如果cd dir中的dir包含..（父目录）和符号链接，那么-L选项会使得先处理..，再处理符号链接。例如</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /home/zk/usrlocalbin/../Tools</span><br></pre></td></tr></table></figure><p>这个命令会使得切换到&#x2F;home&#x2F;zk&#x2F;Tools，可见在符号链接usrlocalbin展开之前，已经处理了..</p><h2 id="4-2-P选项"><a href="#4-2-P选项" class="headerlink" title="4.2. -P选项"></a>4.2. -P选项</h2><p>这个选项和-L选项刚好相反，他会在切换到符号链接的时候，真正进入符号链接所指向的目录，并且如果..和符号链接同时出现在目录路径中的时候，会先展开符号链接，再处理..,例如：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">zk@zk:~$ <span class="built_in">pwd</span> ; <span class="built_in">ls</span> -lh</span><br><span class="line">/home/zk</span><br><span class="line">total 40K</span><br><span class="line">drwxr-xr-x 2 zk zk 4.0K Sep 17 15:02 Desktop</span><br><span class="line">drwxr-xr-x 3 zk zk 4.0K Sep 16 13:29 Documents</span><br><span class="line">drwxr-xr-x 4 zk zk 4.0K Sep 18 22:26 Downloads</span><br><span class="line">drwxr-xr-x 2 zk zk 4.0K Sep 14 16:45 Music</span><br><span class="line">drwxr-xr-x 2 zk zk 4.0K Sep 15 12:37 Pictures</span><br><span class="line">drwxrwxr-x 6 zk zk 4.0K Sep 18 22:27 Projects</span><br><span class="line">drwxr-xr-x 2 zk zk 4.0K Sep 14 16:45 Public</span><br><span class="line">drwxr-xr-x 2 zk zk 4.0K Sep 14 16:45 Templates</span><br><span class="line">drwxrwxr-x 3 zk zk 4.0K Sep 19 15:44 Tools</span><br><span class="line">lrwxrwxrwx 1 zk zk   15 Sep 19 00:26 usrlocalbin -&gt; /usr/local/bin/</span><br><span class="line">drwxr-xr-x 2 zk zk 4.0K Sep 14 16:45 Videos</span><br><span class="line">zk@zk:~$ <span class="built_in">cd</span> -P usrlocalbin</span><br><span class="line">zk@zk:/usr/local/bin$ <span class="built_in">cd</span> </span><br><span class="line">zk@zk:~$ <span class="built_in">cd</span> /home/zk/usrlocalbin/../T</span><br><span class="line">Templates/ Tools/     </span><br><span class="line">zk@zk:~$ <span class="built_in">cd</span> -P /home/zk/usrlocalbin/../Tools/</span><br><span class="line">bash: <span class="built_in">cd</span>: /home/zk/usrlocalbin/../Tools/: No such file or directory</span><br><span class="line">zk@zk:~$ </span><br></pre></td></tr></table></figure><p>可见cd到usrlocalbin的时候，shell的工作目录进入了usrlocalbin指向真实目录&#x2F;usr&#x2F;local&#x2F;bin，当我们使用cd -P &#x2F;home&#x2F;zk&#x2F;usrlocalbin&#x2F;..&#x2F;Tools&#x2F;的时候，由于使用了-P选项，usrlocalbin会在解析..之前被展开，由于&#x2F;usr&#x2F;local&#x2F;bin目录的上一级目录中没有Tools目录，因此就会报错。</p><h1 id="4-3-e选项"><a href="#4-3-e选项" class="headerlink" title="4.3. -e选项"></a>4.3. -e选项</h1><p>这个选项和-P选项一起使用，暂时不清楚作用是啥。</p>]]></content>
      
      
      <categories>
          
          <category> 操作系统 </category>
          
          <category> Linux </category>
          
          <category> shell </category>
          
          <category> 常用命令 </category>
          
          <category> shell内建命令 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>od</title>
      <link href="/2022/09/07/LinuxTextShowCommand-od/"/>
      <url>/2022/09/07/LinuxTextShowCommand-od/</url>
      
        <content type="html"><![CDATA[<!-- toc --><h1 id="1-命令作用"><a href="#1-命令作用" class="headerlink" title="1. 命令作用"></a>1. 命令作用</h1><p>od命令可以把文件的内容以字节块的形式展示，可以让我们看到文件的二进制数据。</p><h1 id="2-展示格式"><a href="#2-展示格式" class="headerlink" title="2. 展示格式"></a>2. 展示格式</h1><p>od命令是一行一行展示文件内容的，每一行的展示格式如下：</p><p>偏移量  字节块1 字节块2 字节块3……</p><p>偏移量是使用8进制表示的整数，代表当前展示的是文件中第几个字节开始的，默认偏移量是从0开始</p><p>每一个字节块的长度默认是C语言short int类型的字节长度，一般是两个字节，用8进制数表示，默认一行展示16个字节。</p><h1 id="3-选项"><a href="#3-选项" class="headerlink" title="3. 选项"></a>3. 选项</h1><h2 id="3-1-w-n-或-width-n"><a href="#3-1-w-n-或-width-n" class="headerlink" title="3.1. -w[n] 或 --width[-n]"></a>3.1. -w[n] 或 --width[-n]</h2><p>设置od命令一行展示的字节个数，默认是16，如果指定了选项，但是没有给出n，那么是32字节</p><h2 id="3-2-endian-x3D-order"><a href="#3-2-endian-x3D-order" class="headerlink" title="3.2. --endian&#x3D;order"></a>3.2. --endian&#x3D;order</h2><p>当od命令一个字节块包含多个字节的时候，字节展示的顺序，order有大端方式（big）和小断方式（little）。</p><h2 id="3-3-A-radix-或-address-radix-x3D-radix"><a href="#3-3-A-radix-或-address-radix-x3D-radix" class="headerlink" title="3.3. -A radix 或 --address-radix&#x3D;radix"></a>3.3. -A radix 或 --address-radix&#x3D;radix</h2><p>设置偏移量的显示格式，radix有如下选择：</p><ul><li>d：十进制</li><li>o：8进制（默认）</li><li>x：十六进制</li><li>n：不显示偏移量</li></ul><h2 id="3-4-t-type-或-format-x3D-type"><a href="#3-4-t-type-或-format-x3D-type" class="headerlink" title="3.4. -t type 或 --format&#x3D;type"></a>3.4. -t type 或 --format&#x3D;type</h2><p>指定字节块的展示样式，od是按照字节块展示数据的，那么一个字节块是展示成字符，十进制数字，还是浮点数呢？需要我们指定。</p><p>type的取值：</p><ul><li>a：以字符形式展示数据，一个字节一组，且只看低7位组成的ASCII的值，如果是可打印的字符，那么对应的字符，有些字符会换成字符的名称展示，例如如果是空格，打印sp，如果是换行打印nl，是0字节则打印nul；</li><li>c：一个字节一组，如果是可打印的字符，那么打印其ASCII的值，否则如果可以表示成使用反斜杠转义的C语言风格的字符，则转义后打印（例如换行就打印为\n），否则使用3位8进制数字表示这个字节。</li><li>d：有符号十进制整数，4个字节一组。</li><li>u：无符号十进制整数，4字节一组。</li><li>f：浮点数，8个字节一组</li><li>o：8进制整数，4字节一组</li><li>x：十六进制，4个字节一组。</li></ul><p>除了a和c以外，剩下的type取值的中字节块包含的字节数可以使用一个是进制数来指定，例如我想让文件内容显示为十进制，但是想一个字节一组，即一个字节显示为一个十进制整数，可以使用-t d1，其中1个字节，刚好数C语言中的char类型的字节长度，也可以写成-t dc</p><p>其他情况类似，字节个数和对应的替换字符如下：</p><ul><li>c：char 1字节</li><li>s：short 2字节</li><li>I： int 4字节</li><li>L： long  8&#x2F;4字节</li><li>F：float 4字节</li><li>D： double 8字节</li><li>L：long double 10&#x2F;12字节</li></ul><p>还有一些快捷选项：</p><ul><li>-a，等于 -t a</li><li>-b，等于 -t o1</li><li>-c，等于 -t c</li><li>-d，等于 -t u2</li><li>-f，等于 -t fF</li><li>-i，等于 -t dI</li><li>-l，等于 -t dL</li><li>-o，等于-t o2</li><li>-s，等于 -t d2</li><li>-x，等于 -t x2</li></ul>]]></content>
      
      
      <categories>
          
          <category> 操作系统 </category>
          
          <category> Linux </category>
          
          <category> shell </category>
          
          <category> 常用命令 </category>
          
          <category> 文件展示命令 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> shell </tag>
            
            <tag> linux </tag>
            
            <tag> 操作系统 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>nl</title>
      <link href="/2022/09/05/LinuxTextShowCommand-nl/"/>
      <url>/2022/09/05/LinuxTextShowCommand-nl/</url>
      
        <content type="html"><![CDATA[<!-- toc --><h1 id="1-命令作用"><a href="#1-命令作用" class="headerlink" title="1. 命令作用"></a>1. 命令作用</h1><p>nl命令允许可以把文本内容打印出来，同时可以给内容加上行号，相比cat命令，你可以控制行号的很多细节（比如对齐方式，显示字符宽度等），同时nl命令可以让你通过几个标号定义逻辑页，可以作为文本的格式化输出工具。</p><h1 id="2-命令格式"><a href="#2-命令格式" class="headerlink" title="2. 命令格式"></a>2. 命令格式</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">nl</span> [options]... [file]...</span><br></pre></td></tr></table></figure><p>当没有给出文件名称，或者使用-作为文件名称的时候，则nl显示标准输入的内容。</p><h1 id="3-原理解释"><a href="#3-原理解释" class="headerlink" title="3. 原理解释"></a>3. 原理解释</h1><p>nl命令把所有的文件内容看作一整个文档显示，根据分隔标记，把整个文档标记成页的不同部分，即header，body，footer。</p><p>header的分隔符是“:::”，body分割符“::”，footer的分割符是“:”，如果组成footer分割符的两个字符分别是ab的话，那么header的分割符就是ababab，body的就是abab。</p><p>分割符独占一行，即紧跟着每一种分割符的内容被认为是对应的页的部分，直到遇到其他分割符。例如一个文本的内容如下：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">aaa</span><br><span class="line">\:\:\:</span><br><span class="line">bbb</span><br><span class="line">\:\:</span><br><span class="line">ccc</span><br><span class="line">123</span><br><span class="line">\:</span><br><span class="line">ddd</span><br></pre></td></tr></table></figure><ul><li>bbb属于header</li><li>ccc 123属于body</li><li>ddd属于footer</li></ul><p>第一个分隔符之前的内容也属于body，即aaa是body部分。当然header，body，footer可以在不同文件中。nl在显示文本的时候，会把分隔符替换为空行，默认只会对body添加行号。</p><h1 id="4-选项"><a href="#4-选项" class="headerlink" title="4. 选项"></a>4. 选项</h1><h2 id="4-1-b或-body-numbering-style"><a href="#4-1-b或-body-numbering-style" class="headerlink" title="4.1. -b或 --body-numbering-style"></a>4.1. -b或 --body-numbering-style</h2><p>指定body部分的行号添加策略，style有如下几个选择：</p><ul><li>a：为所有行添加行号</li><li>b：只为非空行添加行号，body默认是这个</li><li>n：不添加行号</li></ul><p>类似的，也可以指定header和footer的行号策略，选项分别如下：</p><ul><li>-f style 或 --footer-numbering&#x3D;style 指定footer的行号策略；</li><li>-h style 或 --header-numbering&#x3D;style 指定header的行号策略</li></ul><h2 id="4-2-d-cd或-section-delimiter-x3D-cd"><a href="#4-2-d-cd或-section-delimiter-x3D-cd" class="headerlink" title="4.2. -d cd或 --section-delimiter&#x3D;cd"></a>4.2. -d cd或 --section-delimiter&#x3D;cd</h2><p>这个选项指定分隔符，注意cd是两个字符，这样的话，cdcdcd后面的部分是header，cdcd后面的部分是body，cd后面的部分是footer了。默认情况下c&#x3D;‘\’，d&#x3D;‘:’，一般来说分隔符只能指定两个字符，当使用GNU扩展的时候，可以指定多个字符，也可以指定为空字符串（此时将禁用页分区的功能了）。</p><h2 id="4-3-i-number或-line-increment-x3D-number"><a href="#4-3-i-number或-line-increment-x3D-number" class="headerlink" title="4.3. -i number或--line-increment&#x3D;number"></a>4.3. -i number或--line-increment&#x3D;number</h2><p>这个选项指定行号的增量，例如初始行号是1，那么下一行是2，此时增量为1（默认是1），也可以指定负数。</p><h2 id="4-4-l-number或-join-blank-lines-x3D-number"><a href="#4-4-l-number或-join-blank-lines-x3D-number" class="headerlink" title="4.4. -l number或--join-blank-lines&#x3D;number"></a>4.4. -l number或--join-blank-lines&#x3D;number</h2><p>当有至少number个连续的空行的时候，只为最后一个空行设置行号，当连续空行个数小于number的时候，不为这些空行设置行号。空行指的是这一行，除了换行符以外，没有其他字符。</p><h2 id="4-5-n-format-或-number-format-x3D-format"><a href="#4-5-n-format-或-number-format-x3D-format" class="headerlink" title="4.5. -n format 或 --number-format&#x3D;format"></a>4.5. -n format 或 --number-format&#x3D;format</h2><p>指定行编号的样式，format有如下几个可选的值：</p><ul><li>ln：左对齐，没有前导0</li><li>rn：右对齐，没有前导0（默认）</li><li>rz：右对齐，右前导0</li></ul><p>nl输出的每一行的格式可以描述为这样：</p><p>行号区域 行号和内容的分隔区域 内容其区域</p><p>其中行号区域默认是6字符宽度，当我们的行号从一个比较小的数开始的时候，比如1，那么这个1是如何放置？</p><p>其中左对齐即（x表示空出来的字符）：</p><p>1xxxxx 行号和内容的分隔区域 内容其区域</p><p>右对齐是：</p><p>xxxxx1 行号和内容的分隔区域 内容其区域,</p><p>右对齐，有前导0，即：</p><p>000001 行号和内容的分隔区域 内容其区域,</p><h2 id="4-6-p-或-no-renumber"><a href="#4-6-p-或-no-renumber" class="headerlink" title="4.6. -p 或 --no-renumber"></a>4.6. -p 或 --no-renumber</h2><p>这个选项指定了当一个新的页开始的时候，行号不要从新开始。一般来说，我们可以定义多个header，body和footer，当上一个footer结束，下一个header开始的时候，即为新的一页，新的页开始的时候，行号从新开始的。</p><h2 id="4-7-s-string-或-number-separator-x3D-string"><a href="#4-7-s-string-或-number-separator-x3D-string" class="headerlink" title="4.7. -s string 或 --number-separator&#x3D;string"></a>4.7. -s string 或 --number-separator&#x3D;string</h2><p>上面说了，nl输出的每一行的行号和内容之间有分隔区域，这个选项设置行号和行内容之间的分隔区域，默认是TAB，可以指定任何字符串。</p><h2 id="4-8-v-number-或-starting-line-number-x3D-number"><a href="#4-8-v-number-或-starting-line-number-x3D-number" class="headerlink" title="4.8. -v number 或 --starting-line-number&#x3D;number"></a>4.8. -v number 或 --starting-line-number&#x3D;number</h2><p>设置行号的初始值，默认是1</p><h2 id="4-9-w-number-或-number-width-x3D-number"><a href="#4-9-w-number-或-number-width-x3D-number" class="headerlink" title="4.9. -w number 或 --number-width&#x3D;number"></a>4.9. -w number 或 --number-width&#x3D;number</h2><p>上面说了，nl输出的每一行的行号区域默认是6字符宽度，这个选项用来设置行号区域的字符宽度。</p>]]></content>
      
      
      <categories>
          
          <category> 操作系统 </category>
          
          <category> Linux </category>
          
          <category> shell </category>
          
          <category> 常用命令 </category>
          
          <category> 文件展示命令 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> shell </tag>
            
            <tag> linux </tag>
            
            <tag> 操作系统 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>tac</title>
      <link href="/2022/09/03/LinuxTextShowCommand-tac/"/>
      <url>/2022/09/03/LinuxTextShowCommand-tac/</url>
      
        <content type="html"><![CDATA[<!-- toc --><h1 id="1-命令作用"><a href="#1-命令作用" class="headerlink" title="1. 命令作用"></a>1. 命令作用</h1><p>tac命令和cat命令功能差不多，都是读取文件或者标准输入的文本，然后显示在标准输出，只不过tac是按行反序输出的，即先打印最后一行，然后倒数第二行，。。</p><p>例如有一个文件，它的内容如下：</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">123</span><br><span class="line">456</span><br><span class="line">789</span><br></pre></td></tr></table></figure><p>那么使用tac输出的结果就是</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">789</span><br><span class="line">456</span><br><span class="line">123</span><br></pre></td></tr></table></figure><h1 id="2-命令格式"><a href="#2-命令格式" class="headerlink" title="2. 命令格式"></a>2. 命令格式</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">tac</span> [options]... [file]...</span><br></pre></td></tr></table></figure><p>如果没有文件名称，或者文件名称是-，那么代表标准输入。</p><h1 id="3-命令原理"><a href="#3-命令原理" class="headerlink" title="3. 命令原理"></a>3. 命令原理</h1><p>tac命令的工作原理是根据一个字符串把整个文本切分成分组，然后先打印最后一个分组，再倒数第二个，。。。，最后打印第一个分组，用来拆分的分割字符串默认被附加在每一个分组末尾，tac默认使用换行符作为分割字符串。</p><p>这可能不太好理解，下面我们结合-b选项，讲解一下tac的工作原理。</p><h1 id="4-选项"><a href="#4-选项" class="headerlink" title="4. 选项"></a>4. 选项</h1><h2 id="4-1-b，-before"><a href="#4-1-b，-before" class="headerlink" title="4.1. -b，--before"></a>4.1. -b，--before</h2><p>这个选项可以把分割字符串附加在每一个分组的前面，假设上面的文件每一行都有一个换行符，换行符使用$表示，</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">123$</span><br><span class="line">456$</span><br><span class="line">789$</span><br></pre></td></tr></table></figure><p>因此整个文本被换行符分割成“123” “456” “789”，由于使用-b选项，因此换行符会被附加在每一个分组前面，因此每一个完整的分组如下：</p><p>“123” “$456”  “$789”，“$”，反着打印结果如下：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line">789</span><br><span class="line">456123</span><br></pre></td></tr></table></figure><p>即：</p><ol><li>先打印换行符</li><li>打印$789（此时789前面有个换行）</li><li>打印$456</li><li>最后在456后面打印123，456和123之间没有换行</li></ol><h2 id="4-2-s，-separator-x3D-str"><a href="#4-2-s，-separator-x3D-str" class="headerlink" title="4.2. -s，--separator&#x3D;str"></a>4.2. -s，--separator&#x3D;str</h2><p>这个选项可以修改分割字符串，例如我们使用-s “ww”，那么我们使用这个选项打印如下文本 “aaawwbwswwdd$”（$代表换行），即</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&quot;aaawwbwswwdd&quot;</span> &gt; test.txt</span><br><span class="line"><span class="built_in">tac</span> -s <span class="string">&quot;ww&quot;</span> test.txt</span><br></pre></td></tr></table></figure><p>熟悉根据分割字符串“ww”，原始文本被分割成“aaaww”，“bwsww”，“dd$”，那么打印出来的结果就是</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">dd</span><br><span class="line">bwswwaaaww</span><br></pre></td></tr></table></figure><p>如果此时加上-b选项，</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">tac</span> -b -s <span class="string">&quot;ww&quot;</span> test.txt</span><br></pre></td></tr></table></figure><p>熟悉根据分割字符串“ww”，原始文本被分割成“aaa”，“wwbws”，“wwdd$”，那么打印出来的结果就是</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">wwdd</span><br><span class="line">wwbwsaaa</span><br></pre></td></tr></table></figure><h2 id="4-3-r，-regex"><a href="#4-3-r，-regex" class="headerlink" title="4.3. -r，--regex"></a>4.3. -r，--regex</h2><p>把分割字符串当成正则表达式来解析</p><h2 id="4-4-help和-version"><a href="#4-4-help和-version" class="headerlink" title="4.4. --help和--version"></a>4.4. --help和--version</h2><p>这两个选项会被大部分GNU coreutils 工具包中的程序支持，分别是打印帮助信息和打印当前工具命令的版本号。</p>]]></content>
      
      
      <categories>
          
          <category> 操作系统 </category>
          
          <category> Linux </category>
          
          <category> shell </category>
          
          <category> 常用命令 </category>
          
          <category> 文件展示命令 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> shell </tag>
            
            <tag> linux </tag>
            
            <tag> 操作系统 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>cat</title>
      <link href="/2022/09/02/LinuxTextShowCommand-cat/"/>
      <url>/2022/09/02/LinuxTextShowCommand-cat/</url>
      
        <content type="html"><![CDATA[<!-- toc --><h1 id="1-命令作用"><a href="#1-命令作用" class="headerlink" title="1. 命令作用"></a>1. 命令作用</h1><p>这个命令主要的作用是把文件（或者标准输入）的内容显示在标准输出。</p><h1 id="2-命令格式"><a href="#2-命令格式" class="headerlink" title="2. 命令格式"></a>2. 命令格式</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> [options] [file]...</span><br></pre></td></tr></table></figure><p>当没有给出文件名称，或者使用-作为文件名称的时候，则cat显示标准输入的内容。</p><h1 id="3-选项"><a href="#3-选项" class="headerlink" title="3. 选项"></a>3. 选项</h1><table><thead><tr><th>短选项</th><th>长选项</th><th>含义</th></tr></thead><tbody><tr><td></td><td>--help</td><td>打印帮助信息</td></tr><tr><td></td><td>--version</td><td>打印版本号</td></tr><tr><td>-n</td><td>--number</td><td>给输出的行编号，从1开始</td></tr><tr><td>-b</td><td>--number-nonblank</td><td>给输出的行编号，从1开始，跳过所有的空行，如果这个选项生效，那么-n被忽略</td></tr><tr><td>-s</td><td>--squeeze-blank</td><td>合并相邻的多个空行为一个空行</td></tr><tr><td>-v</td><td>--show-nonprinting</td><td>展示除了LFD（换行）和TAB（水平制表符）以外的所有控制字符，展示方式是使用^标记，例如ASCII码中的NUL字符可以使用CTRL+@表示，那么NUL字符就展示为^@。<br/>-v选项使得cat命令一个字节一个字节的展示文件的数据，cat会默认把一个字节的低7位当作ASCII码来展示，如果是可打印字符就展示对应的字符，如果不是可打印的，就使用^+xxx来展示，例如当这个字节是0的时候，就是展示成^@，如果这个字节的最高位是1，那么就在展示的字符前面加上前导的M-，例如-128，就展示为M-^@</td></tr><tr><td>-E</td><td>--show-ends</td><td>把换行符LFD（Line Feed）展示为$，如果在换行符前面有回车符，即\r\n，则一起展示为^M$</td></tr><tr><td>-T</td><td>--show-tabs</td><td>把TAB符展示为^I（爱）</td></tr><tr><td>-e</td><td></td><td>等于-vE</td></tr><tr><td>-t</td><td></td><td>等于-vT</td></tr><tr><td>-A</td><td></td><td>等于-vET</td></tr></tbody></table><h1 id="4-其他使用介绍"><a href="#4-其他使用介绍" class="headerlink" title="4. 其他使用介绍"></a>4. 其他使用介绍</h1><p>借助重定向的操作，可以创建新文件并写入初始化的内容，即：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> &gt; NewFile.txt</span><br></pre></td></tr></table></figure><p>或者</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> - &gt; NewFile.txt</span><br></pre></td></tr></table></figure><p>此时cat会从标准输入读取字符，直到输入结束（CTRL+D）。</p>]]></content>
      
      
      <categories>
          
          <category> 操作系统 </category>
          
          <category> Linux </category>
          
          <category> shell </category>
          
          <category> 常用命令 </category>
          
          <category> 文件展示命令 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> shell </tag>
            
            <tag> linux </tag>
            
            <tag> 操作系统 </tag>
            
        </tags>
      
    </entry>
    
    
  
  
    
    
    <entry>
      <title>about</title>
      <link href="/about/index.html"/>
      <url>/about/index.html</url>
      
        <content type="html"><![CDATA[]]></content>
      
    </entry>
    
    
    
    <entry>
      <title>friends</title>
      <link href="/friends/index.html"/>
      <url>/friends/index.html</url>
      
        <content type="html"><![CDATA[]]></content>
      
    </entry>
    
    
    
    <entry>
      <title>tags</title>
      <link href="/tags/index.html"/>
      <url>/tags/index.html</url>
      
        <content type="html"><![CDATA[]]></content>
      
    </entry>
    
    
    
    <entry>
      <title>文章分类</title>
      <link href="/categories/index.html"/>
      <url>/categories/index.html</url>
      
        <content type="html"><![CDATA[]]></content>
      
    </entry>
    
    
  
</search>
